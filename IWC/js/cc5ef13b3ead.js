if(typeof console!="object"){console={log:function(){}}}
var GLOBAL_EASING='easeInOutQuad';var opacitySupport=$.support.opacity;var makeQueryString=function(dict){var queryString='';var length=0;for(var key in dict){queryString+='&'+key+'='+dict[key];length++;}
if(length==0){return'';}
else{queryString='?'+queryString.substring(1);return queryString;}}
var triggerGAEvents=function(dataset){if(dataset.event=="_trackEvent"){_gaq.push([dataset.event,dataset.category,dataset.action,dataset.label]);}}
var triggerMediaMindEvents=function(dataset){var ebRand=Math.random()+'';ebRand=ebRand*1000000;$('<script/>').attr('src','http://bs.serving-sys.com/BurstingPipe/ActivityServer.bs?cn=as&ActivityID='+dataset.id+'&rnd='+ebRand).appendTo('body');}
var getForm=function(options){var settings=$.extend({'form':undefined,'method':undefined,'successCallback':undefined},options);var theUrl=settings.url;var theForm=settings.form;var theType=settings.method;var successCallback=settings.successCallback;var theData=theForm?theForm.serialize():false;var postType;var theSpinner=$("<div/>",{"class":"spinner dark"}).css({"display":"none","position":"fixed","top":"50%","left":"50%","zIndex":'999'}).append($("<span/>")).appendTo('body');if(opacitySupport){theSpinner.clearQueue().hide().fadeIn(200);}else{theSpinner.show();}
if(theType){postType=theType;}else{postType='GET';}
$.ajax({url:theUrl,dataType:'html',type:postType,data:theData,success:function(data,textStatus,xhr){if(xhr.getResponseHeader("X-Location")){location.href=xhr.getResponseHeader("X-Location");}
var theContent=$('.modal',data);var theWidth=693;var trackingData=theContent.data("ga");if(theContent.length){if(theContent.data("ga")){triggerGAEvents(trackingData);}
if(theContent.data("mediamind")){triggerMediaMindEvents(theContent.data("mediamind"));}
if(theContent.hasClass('contact')){theWidth=900;}else if(theContent.hasClass('emailForm')){theContent.find('textarea').text(document.location.href);}}else{if(theContent.data("ga")){if((trackingData.category=="Registration")||(trackingData.category=="MCBE")){trackingData.label="Start: Form Retrieval Error";triggerGAEvents(trackingData);}}
theContent=$('<div class="modal regConfirm"><h2>'+string_ERROR+'</h2><p>'+string_PROBLEM_COMPLETING_REQUEST+'</p></div>');}
var theReply=theContent.buildOverlayGeneric({width:theWidth});if(theContent.find('form').length){modifyFormForJapanese(theContent);theContent.find('form').validateForm({callback:function(){var thisForm=theContent.find('form');thisForm.find('input[type=submit]').attr('disabled','disabled').fadeTo(0,.5).addClass('disabled');getForm({url:thisForm.attr('action'),form:thisForm,method:'POST'});}});}
if(opacitySupport){theSpinner.show().delay(10).fadeOut(200,function(){theSpinner.remove();});}else{theSpinner.remove();}
theReply.open();if(successCallback){successCallback.apply();}},error:function(xhr,textStatus,errorThrown){}});}
var initialize_siderale_calc=function(){var href=$('a[href^="'+url_SIDERALE_WIDGET+'"]').attr('href');getForm({url:href});$.getScript(MEDIA_URL+'/chrome/js/jquery-ui-1.8.21.custom.min.js',function(){initialize_siderale_widget(false);});}
var initFormLinks=function(){$('a[href^="'+url_SIGNIN+'"]').live('click',function(e){e.preventDefault();getForm({url:$(this).attr('href')});});$('a[href^="'+url_REGISTER+'"]').live('click',function(e){e.preventDefault();getForm({url:$(this).attr('href')});});$('a[href^="'+url_WI_SUBSCRIBE+'"]').live('click',function(e){e.preventDefault();getForm({url:$(this).attr('href')});});$('a[href^="'+url_CONTACT+'"]').live('click',function(e){e.preventDefault();getForm({url:$(this).attr('href'),successCallback:function(){$('.modal.contact .conciergeLocationBar').each(function(i){new ConciergeLocationBar($(this));});}});});$('a[href^="'+url_CONCIERGE_CALL_ME_BACK+'"]').live('click',function(e){e.preventDefault();var querystring='';var variation=$('body.detail li.variation.selected').attr('data-variation');if(variation){querystring='?variation='+variation;}
getForm({url:$(this).attr('href')+querystring});});$('a[href^="'+url_CONCIERGE_EMAIL_ME+'"]').live('click',function(e){e.preventDefault();var querystringParams={};var chosenCountry=$(this).parents('.conciergeBarContent').eq(0).find('.countrySelect .selectionList li.selected a');var variation=$('body.detail li.variation.selected').attr('data-variation');if(variation){querystringParams['variation']=variation;}
var querystring=makeQueryString(querystringParams);getForm({url:$(this).attr('href')+querystring});});$('a[href^="/subscribe/"]').live('click',function(e){e.preventDefault();getForm({url:url_WI_SUBSCRIBE});});$('a[href^="'+url_FORGOT_PASSWORD+'"]').live('click',function(e){e.preventDefault();getForm({url:$(this).attr('href')});});$('a[href^="'+url_NEWSLETTER_SIGNUP+'"]').live('click',function(e){e.preventDefault();getForm({url:$(this).attr('href')});});$('a[href^="'+url_MCBE_ENTRY+'"]').live('click',function(e){e.preventDefault();getForm({url:$(this).attr('href')});});$('a[href^="'+url_MCBE_ENTRY_HONGKONG+'"]').live('click',function(e){e.preventDefault();getForm({url:$(this).attr('href')});});$('a[href^="'+url_SIDERALE_CONTACT+'"]').live('click',function(e){e.preventDefault();getForm({url:$(this).attr('href')});});$('a[href^="'+url_SIDERALE_WIDGET+'"]').live('click',function(e){e.preventDefault();$.getScript('http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false&callback=initialize_siderale_calc');});var submitButtonList=$("form input[type=submit]");submitButtonList.bind("click",function(e){var tempItem=$(this);tempItem.fadeTo(0,.5).addClass('disabled');setTimeout(function(){tempItem.attr('disabled','disabled');},100);});}
var IwcToolTip=function(content,triggerElem,opts){var surrogate=this;var defaults={wrapperClass:'',leftOffset:15,dur:200}
this.opts=$.extend(defaults,opts);this.trig=$(triggerElem);this.cont=$(content);this.dom=$('<div/>',{'class':'toolTip '+this.opts.wrapperClass});this.shadowWrap=$('<div/>',{'class':'ttShadow'});this.shadowWrapR=$('<div/>',{'class':'ttShadowR'});this.dom.html(this.cont).append(this.shadowWrap).append(this.shadowWrapR);var tthoverConfig={interval:100,timeout:400,over:function(e){surrogate.show();},out:function(e){return false;}}
this.trig.hoverIntent(tthoverConfig);if(this.cont.find('.fb_like').length>=1){this.cont.find('.fb_like').html('<iframe src="http://www.facebook.com/plugins/like.php?href='+document.location.href+'&amp;layout=button_count&amp;show_faces=false&amp;width=100&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=25" scrolling="no" frameborder="0" style="border:none; max-width:80px; margin:0 auto; height:25px;" allowTransparency="true"></iframe>')}}
IwcToolTip.prototype.show=function(){var surrogate=this;target={left:this.trig.offset().left,top:this.trig.offset().top}
if(this.trig.parent().hasClass('shareBar')){var margL=(this.dom.width()/2)-38;if(this.trig.hasClass('pinterest')&&!this.trig.parent().parent().parent().parent().hasClass('actionBar')){margL=(this.dom.width()/2)-42;}}
else{var margL=-(this.dom.width()/2+this.opts.leftOffset);}
if(opacitySupport){this.dom.appendTo('body').css(target).css({marginTop:-this.dom.height()+5,marginLeft:margL}).hide().animate({marginTop:'-=17px'},{queue:false,duration:this.opts.dur}).fadeIn(this.opts.dur).mouseleave(function(){surrogate.hide();});}else{this.dom.appendTo('body').css(target).css({marginTop:-this.dom.height()+5,marginLeft:margL}).animate({marginTop:'-=17px'},{queue:false,duration:this.opts.dur}).mouseleave(function(){surrogate.hide();});}
this.trig.addClass('selected');this.shadowWrap.height(this.dom.height());this.shadowWrapR.height(this.dom.height());}
IwcToolTip.prototype.hide=function(){var surrogate=this;if(opacitySupport){this.dom.animate({marginTop:'-=9px'},{queue:false,duration:this.opts.dur}).fadeOut(this.opts.dur,function(){surrogate.dom.remove();});}else{this.dom.animate({marginTop:'-=9px'},{queue:false,duration:this.opts.dur,complete:function(){surrogate.dom.remove();}});}
this.trig.removeClass('selected');}
$.fn.tabNav=function(){if(this.hasClass('profileTabs')){var pt=new ProfileTabs(this);}else{var tn=new TabNav(this);}}
var TabNav=function(e){var surrogate=this;this.indicator=$('<div class="indicator" />');this.tabs=e.find('li');this.tabs.bind('click',function(){surrogate.select(this)});e.append(this.indicator);this.select(this.tabs[0],true);}
TabNav.prototype.select=function(tab,initial){var t=$(tab);var indicatorTarget=t.position().left+(t.width()/2-this.indicator.width()/2);t.addClass('selected').siblings().removeClass('selected');if(initial){this.indicator.css({left:indicatorTarget});}else{this.indicator.animate({left:indicatorTarget});}}
var pfStateChanged=false;var ProfileTabs=function(e){TabNav.call(this,e);var surrogate=this;this.tabs.bind('click',function(){if(pfStateChanged==true){var conf=confirm(string_UNSAVED_CHANGES);if(conf){surrogate.switchContent('#'+$(this).find('a').attr('href').split('#')[1]);}}else{surrogate.switchContent('#'+$(this).find('a').attr('href').split('#')[1]);}
return false;});}
ProfileTabs.prototype=jQuery.extend({},TabNav.prototype,ProfileTabs.prototype);ProfileTabs.prototype.switchContent=function(content){var formToShow=$(content+'Wrap');var fWrap=$('#formWrap');var dur=200;fWrap.height(fWrap.height());$('.formHolder').not(formToShow).fadeOut(dur,function(){formToShow.show().fadeTo(0,0).addClass('selected');fWrap.animate({height:formToShow.height()},{duration:dur*2,complete:function(){formToShow.fadeTo(dur,1);}});}).removeClass('selected');pfStateChanged=false;}
var ProfileForm=function(){var surrogate=this;var initProfileEditForm=function(){var pForm=$('#profileForm');var fWrap=$('#formWrap');var formHolders=$('.formHolder');var submits=formHolders.find('input.submit');var avatarLinks=pForm.find('.avatars li a');var avatarField=$('#id_avatar');var mwTable=$('#myWatches table');var mwRows=mwTable.find('tr').not(':first-child');var closeBtn=$('<td class="close"><img src="'+MEDIA_URL+'chrome/images/field_delete.png" /></td>');$('label span.description, .label span.description').each(function(){var trig=$('<span class="toolTipTrigger">?</span>')
$(this).parent().append(trig);new IwcToolTip(this,trig.get(0));});avatarLinks.bind('click',function(e){e.preventDefault();var t=$(this);avatarLinks.not(t).removeClass('selected');t.addClass('selected');avatarField.val(t.attr('href').substring(1));});$('td.close').live('click',function(){var sur=$(this);sur.parent().remove();mwRows=mwTable.find('tr').not(':first-child');mwRows.each(function(i){var ins=$(this).find('input');$(ins[0]).attr({'id':'model'+i,'name':'model'+i});$(ins[1]).attr({'id':'caseNumber'+i,'name':'caseNumber'+i});});});$('#myWatchesWrap').find('a.add').bind('click',function(){mwRows=mwTable.find('tr').not(':first-child');var currRow=mwRows.length;var domString='<tr><td>';domString+='<input name="model'+currRow+'" id="model'+currRow+'" class="text" type="text" />';domString+='</td><td>';domString+='<input name="caseNumber'+currRow+'" id="caseNumber'+currRow+'" class="text" type="text" />';domString+='</td>';$(domString).append(closeBtn.clone()).appendTo(mwTable);return false;});mwRows.append(closeBtn);$('.formHolder').not('.selected').hide();fWrap.find('input, textarea, select').change(function(){pfStateChanged=true});markitup.jQuery(document).ready(function($){$('#id_signature').not('.markItUpEditor').markItUp(myBBCodeSettings);});Custom.init();submits.bind('click',function(e){e.preventDefault();var thisForm=$(this).closest('form');var theData=thisForm.serialize();var theUrl=thisForm.attr('action');thisForm.find('input[type=submit]').attr('disabled','disabled').fadeTo(0,.5).addClass('disabled').val(string_SAVING);$.ajax({url:theUrl,type:'POST',data:theData,success:function(data){var thisFormId=thisForm.attr('id');var receivedForm=$('#'+thisFormId,data);thisForm.html(receivedForm.html());initProfileEditForm();},error:function(){}});pfStateChanged=false;return false;}).removeAttr('disabled').fadeTo(0,1);}
initProfileEditForm();}
var GalapagosForm=function(){var surrogate=this;var gForm=$('#galapagosForm');var fWrap=$('#formWrap');var formHolders=$('.formHolder');var submits=formHolders.find('input.submit');var submitText=submits.text();var initGalapagosForm=function(){$('label img.description, .label img.description,label span.description, .label span.description').each(function(){var trig=$('<span class="toolTipTrigger">?</span>&nsbp;')
$(this).parent().append(trig);new IwcToolTip(this,trig.get(0),{wrapperClass:'galapagosTip'});});$('input.required').siblings('label').append('<span class="required">&#42;</span>');$('select.required').siblings('label').append('<span class="required">&#42;</span>');}
initGalapagosForm();}
var LaureusForm=function(){var surrogate=this;var gForm=$('#laureusForm');var fWrap=$('#formWrap');var formHolders=$('.formHolder');var submits=formHolders.find('input.submit');var submitText=submits.text();var initLaureusForm=function(){$('label img.description, .label img.description,label span.description, .label span.description').each(function(){var trig=$('<span class="toolTipTrigger">?</span>&nsbp;')
$(this).parent().append(trig);new IwcToolTip(this,trig.get(0),{wrapperClass:'laureusTip'});});$('input.required').siblings('label').append('<span class="required">&#42;</span>');$('select.required').siblings('label').append('<span class="required">&#42;</span>');}
initLaureusForm();}
var modifyFormForJapanese=function(form){if(form==undefined){form=$('body');}
if($('body').hasClass('jp')){form.find('#id_salutation').each(function(i){$(this).parent().css('display','none');});form.find('#id_title').each(function(i){$(this).parent().css('display','none');});}}
var StickyFilter=function(e,opts){var t=$(e);var w=$(window);var targ;var tTop;var pTop;window.onscroll=function(){tTop=t.offset().top;pTop=t.parent().offset().top;if(w.scrollTop()>tTop){t.css({'position':'fixed'}).addClass('active');}else if(w.scrollTop()<pTop){t.css({'position':'absolute'}).removeClass('active');}};}
var StickyConciergeBar=function(e,opts){var t=$(e);var w=$(window);var targ;var tTop;var pTop;window.onscroll=function(){tTop=t.offset().top;pTop=t.parent().offset().top;if(w.scrollTop()>tTop){t.css({'position':'fixed','left':'0px','top':'0px','width':'100%','z-index':'500','boxShadow':'0px 0px 15px 0px rgba(0, 0, 0, 0.08)'}).addClass('active');}else if(w.scrollTop()<pTop){t.removeAttr('style').removeClass('active');}};}
var ConciergeBarMoreButton=function(targElem){var barFloat=$(targElem).parents(".conciergeBarFloat");var barContainer=$(targElem).parents(".conciergeBar, .conciergeLocationBar");var moreButton=barFloat.find('.links .more').eq(0);var moreButtonDropdown=moreButton.find(".dropdown");var moreButtonText=moreButton.find(".text");var moreContent=barFloat.find('.conciergeBarMore').eq(0);var moreTog=0;var currentBg=moreButtonDropdown.css("backgroundImage");var newBg=currentBg.replace("down","up");moreContent.css({'position':'absolute','visibility':'hidden','display':'block'});moreHeight=moreContent.height();moreContent.css({'position':'static','visibility':'visible','display':'none'});moreContent.hide();moreButton.bind('click',function(e){e.preventDefault();toggleMoreContent();});var toggleMoreContent=function(){if(!moreTog){moreContent.slideDown();moreButtonText.text("view less");moreButtonDropdown.css("backgroundImage",newBg);barContainer.animate({"height":71+moreHeight+"px"});moreTog=1;}else{moreContent.slideUp();moreTog=0;moreButtonText.text("view more");moreButtonDropdown.css("backgroundImage",currentBg);barContainer.animate({"height":"51px"});}}}
var ConciergeLocationBar=function(targElem){var barContainer=$(targElem);var selectorContainer=barContainer.find('.countrySelect').eq(0);var titleLink=selectorContainer.find('.chosenCountry').eq(0);var phoneNum=barContainer.find('.links .phoneNumber').eq(0);var select=selectorContainer.find('.selectionList').eq(0);var optionsArr=select.find('li');var currLocationElem=undefined;var setOptionAsSelected=function(optionElem){currLocationElem=$(optionElem);optionsArr.each(function(ind){$(this).removeClass('selected');});currLocationElem.addClass('selected');titleLink.text(currLocationElem.find('a').eq(0).text());var phone=currLocationElem.find('a').data('phone');phoneNum.find('.replaceText').text(phone);}
var hittest=function(evt,parentElement){var bool=false;var receiver=document.elementFromPoint(evt.clientX,evt.clientY);if(receiver!=undefined){if(receiver==barContainer){bool=true;}
else{var allchildren=$(parentElement).find('*').each(function(i){if(receiver==this){bool=true;}});}}
return bool;}
var showMenu=function(){select.show();titleLink.addClass('on');$('body').bind('mousemove',function(e){if(hittest(e,barContainer)==true){select.show(0.01);}
else{select.hide(0.01);$('body').unbind('mousemove');titleLink.removeClass('on');}});}
titleLink.bind('click',function(e){e.preventDefault();showMenu();});barContainer.find('.arrow').eq(0).bind('click',function(e){e.preventDefault();showMenu();});optionsArr.each(function(ind){var option=$(this);if(ind===0){option.find('> a').css('border-top','none');}
if(option.hasClass('selected')){currLocationElem=option;setOptionAsSelected(currLocationElem);}
option.bind('click',function(e){e.preventDefault();setOptionAsSelected(this);select.hide(0.01);$('body').unbind('mousemove');titleLink.removeClass('on');});});}
var DetailSwitcher=function(){$('.specs').each(function(i){var specLists=$(this).find('.details .specsList');var calibreSpec=$(this).find('.details .calibreSpec');var detailLists=$(this).find('.details .detailList');var frontBack=$(this).find('.viewer .frontBackWrap');if(!frontBack.find(".back").length){frontBack.addClass("noBack");}
var varLinks=$(this).find('.variations ul li');var listToShow1,listToShow2,listToShow3,listToShow4;detailLists.not('.selected').hide();$(frontBack[0]).addClass('selected');$(varLinks[0]).addClass('selected').css({paddingRight:5});if(calibreSpec.length>=0){$(calibreSpec[0]).addClass('selected');}
varLinks.bind('click',function(){var numClicked=varLinks.index(this);varLinks.not(this).removeClass('selected').animate({paddingRight:0},{duration:100});$(this).addClass('selected').animate({paddingRight:5},{duration:100});listToShow1=$(specLists[numClicked]);listToShow2=$(calibreSpec[numClicked]);listToShow3=$(detailLists[numClicked]);listToShow4=$(frontBack[numClicked]);$(this).closest('.specs').find('.details .specsList,.details .calibreSpec,.details .detailList,').removeClass('selected').hide();$(this).closest('.specs').find('.viewer .frontBackWrap').not(frontBack[numClicked]).removeClass('selected');listToShow1.addClass('selected').show();listToShow2.addClass('selected').show();listToShow3.addClass('selected').show();listToShow4.addClass('selected');return false;});});}
var SearchFilter=function(){var sf=$('#searchFilter');var as=sf.find('a');var currURL=undefined;var query=String(window.location).split("?")[1];if(query!=undefined&&query!=null&&query!=""){if(query.indexOf("&filter=")>=0){currURL=query.split("&")[1].split("=")[1];}
else if(query.indexOf("type=")>=0){currURL=query.split("=")[1];}}
if(currURL===undefined||currURL===null||currURL===""||currURL==="all"){as.each(function(){var asID=String($(this).attr("id"));if(asID===undefined||asID===null||asID===""){$(this).addClass('selected');}});}
else{as.each(function(){var asID=String($(this).attr("id"));if(currURL===asID){$(this).addClass('selected');}});}
var rDiv=$('#results');var rl=$('#resultsList');var sResults=rl.children('li');var oPaddingTop=sResults.css('paddingTop');var oPaddingBottom=sResults.css('paddingBottom');var fResults;var dur=500;sResults.each(function(){var t=$(this);t.data('oHeight',t.height());})
as.bind('click',function(e){var t=$(this);var cat=t.attr('href')
as.not(t).removeClass('selected');t.addClass('selected');window.location.href=cat;return false;});}
var ExperienceFilter=function(){var surrogate=this;this.af=$('.articleFilter');this.h=this.af.find('h6');this.al=$('.articleList ol li');this.featureLinks=$('.experiences_top a.go').not('.arrow');this.af.find('li a').bind('click',function(e){e.preventDefault();$(this).parent().addClass('selected').siblings().removeClass('selected');var filterTerm=$(this).attr('href').substring(1);if(filterTerm=='all'){surrogate.showAll();}else{surrogate.filterEm(filterTerm,$(this).text());}
document.location.hash=filterTerm;});this.featureLinks.bind('click',function(e){e.preventDefault();$.scrollTo('.articleList',{duration:200});var filterTerm=$(this).data('topic');var link=surrogate.af.find('a[href=#'+filterTerm+']');surrogate.filterEm(filterTerm,link.text());document.location.hash=filterTerm;});this.hashCheck();}
ExperienceFilter.prototype.filterEm=function(filterTerm,text){this.al.not('.topic_'+filterTerm).hide()
this.al.filter('.topic_'+filterTerm).show();this.h.text(text);}
ExperienceFilter.prototype.hashCheck=function(){var hash=document.location.hash.substring(1);var link=this.af.find('a[href='+document.location.hash+']');link.parent().addClass('selected').siblings().removeClass('selected');if(this.al.filter('.topic_'+hash).length>0&&hash!=''){this.filterEm(hash,link.text());}}
ExperienceFilter.prototype.showAll=function(){this.h.text('All Articles');this.al=$('.articleList ol li').show();}
$.fn.validateForm=function(opts){var defaults={callback:function(){return true;}};var options=$.extend(defaults,opts);var isValid=false;var emailReg=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;var inputs=this.find('input.text, textarea');var alertClass='.formError';var requiredText=string_FIELD_REQUIRED;var emailText=string_VALID_EMAIL;var validate=function(){for(var i=0;i<inputs.length;i++){var inp=$(inputs[i]);if(inp.hasClass('required')&&(inp.val()==''||inp.val()==null)){showAlert(inp,requiredText);}else if(inp.hasClass('email')&&!emailReg.test(inp.val())){showAlert(inp,emailText);}else{clearAlert(inp);}}
if(!inputs.hasClass('invalid')){options.callback();}
return(!inputs.hasClass('invalid'));};var showAlert=function(inp,txt){inp.addClass('invalid').siblings(alertClass).text(txt);};var clearAlert=function(inp){inp.removeClass('invalid').siblings(alertClass).text('');};if(this.parent().hasClass('modal')){this.bind('submit',function(){validate();return false;});}else{this.bind('submit',function(){return validate();});}}
var ProgressBar=function(target,options){var defaults={sections:6,handleColor:'#333',easingMethod:'swing',dur:200};var options=$.extend(defaults,options);var indicator=$('<div class="progressIndicator"></div>');var currPercent=0;var sectionLength=target.width()/options.sections;var handleColor=options.handleColor;if($('body').hasClass('siderale')){handleColor="#8b8b89";}
indicator.css({position:'absolute',top:0,left:0,height:target.height(),width:0,backgroundColor:handleColor});target.append(indicator);var step=function(){indicator.width(indicator.width()+1);};var setIndicator=function(x){indicator.width(x)}
var stepTo=function(percent){indicator.animate({width:target.width()*percent},{duration:options.dur,easing:options.easingMethod});currPercent=percent;};var getPercentage=function(){return Math.floor(indicator.width()/target.width()*100);};var inSection=function(){return indicator.width()/sectionLength;}
return{step:step,stepTo:stepTo,getPercentage:getPercentage,inSection:inSection,setIndicator:setIndicator}}
var PackOverlay=function(e){var surrogate=this;this.psInfo=$(e);this.li=this.psInfo.parent();var hoverConfig={interval:50,timeout:50,over:function(e){surrogate.show();},out:function(e){return false;}}
this.li.hoverIntent(hoverConfig);this.psInfo.detach();}
PackOverlay.prototype.show=function(){var surrogate=this;this.targ={x:this.li.offset().left-80,y:this.li.offset().top-128}
this.psInfo.css({left:this.targ.x,top:this.targ.y}).appendTo('body').bind('mouseleave',function(){surrogate.hide();}).fadeIn(100);}
PackOverlay.prototype.hide=function(){var surrogate=this;this.psInfo.fadeOut(100,function(){surrogate.psInfo.remove();});}
var DayNight=function(e){var dur=400;var t=$(e);var dial=t.find('.dial');var dayDial=dial.find('.day');var nightDial=dial.find('.night');var clickText=t.find('span.click');var lightsText=t.find('span.lights');var dTextColor='#79797a';var nextH=t.find('h5');var overlay=$('<div id="overlay_black" />');var glowers=$('<div id="glowers" />');var dnContent=t.find('.dnContent');var isDay=true;var dialIsAnimating=false;var to;t.append(glowers);dnContent.detach();dial.bind('click',function(){if(dialIsAnimating){return false;}
dialIsAnimating=true;if(isDay){overlay.clearQueue().fadeTo(0,0).css({zIndex:0,height:$('body').height()}).appendTo('body').fadeTo(dur,.9);dayDial.clearQueue().animate({rotate:110});nightDial.clearQueue().animate({rotate:110},{duration:dur,queue:false,complete:function(){dialIsAnimating=false}}).fadeIn(dur);clickText.clearQueue().animate({color:'#5a5a5b'});nextH.clearQueue().animate({color:'#424242'});lightsText.clearQueue().animate({color:'#8c8d8e'}).html(string_LIGHTS_ON);dnContent.hide().css({left:t.offset().left+t.width()+20,top:t.offset().top+25}).appendTo('body').clearQueue().delay(dur*2).fadeIn(dur*5);glowers.clearQueue().fadeIn(dur);isDay=false;$(document).bind('keydown',function(e){if(e.keyCode==27){dial.click();}})}else{dnContent.clearQueue().fadeOut(dur,function(){dnContent.remove();});overlay.clearQueue().fadeOut(dur,function(){overlay.remove();});dayDial.clearQueue().animate({rotate:0,queue:false});nightDial.clearQueue().animate({rotate:0},{duration:dur,queue:false,complete:function(){dialIsAnimating=false}}).fadeOut(dur);clickText.clearQueue().animate({color:dTextColor});nextH.clearQueue().animate({color:'#373737'});lightsText.clearQueue().animate({color:dTextColor}).html(string_LIGHTS_OFF);glowers.clearQueue().fadeOut(dur);isDay=true;$(document).unbind('keydown');}
return false;})}

$.fn.iwcSlider=function(options){
	var defaults={type:'detail',height:420,easingMethod:'swing',duration:300,speed:30,progressHeight:6,timer:true};
	var options=$.extend(defaults,options);
	var surrogate=this;
	var wrap=$('<div class="iwcSlider '+options.type+'"></div>');
	var textOverlay=$('<div class="textOverlay"></div>');
	var progressBar=$('<div class="progressBar"></div>');
	var playPause=$('<div class="playPause"></div>');
	var indicator=$('<div class="indicator"></div>');
	var lis=$('> li',this);var list=$(this.find('ul'));
	var imgs=lis.find('img');var liWidth=Math.floor(this.width()/lis.length);
	var currIndex=0;var headers=lis.find('h4');
	var hColor=$(headers[0]).css('color');
	var hHeight=0;var totalHeight;var timer;
	var pb;
	var isPaused=false;
	var liHeight;
	if(options.type!='globetrotter'){\
		var textTrack=$('<div class="textTrack"></div>');
		var imgHolder=$('<div class="imgHolder"></div>');
		var textHolder=$('<div class="textHolder"></div>');
		var textList=this.clone();
		var titles=lis.find('h3');
	}else{
		var containerHolder=$('<div class="slideContainer"></div>');
		var container=lis.children('div');
	}
	var init=function(){surrogate.wrap(wrap);
	if(options.type!='globetrotter')imgHolder.width(surrogate.width()).height(options.height).html(imgs);
	else containerHolder.width(surrogate.width()).height(options.height).html(container);
	if(options.type!='globetrotter')headers.css({marginTop:options.height+options.progressHeight});
	else headers.css({marginTop:0});
	switch(options.type){
		case'detail':for(var i=0;i<lis.length;i++){
			var p=$(lis[i]).children('p');
			var a=$(lis[i]).children('p').children('a').detach();
			if(isBlank(p.html())){
				p.html('');
			}else{
				p.html('<span>'+p.html()+'</span>').append(a);
			}
		}
		break;
		case'family':for(var i=0;i<lis.length;i++){
			var h=$(lis[i]).children('h4').text();
			var p=$(lis[i]).children('p');
			var a=$(lis[i]).children('p').children('a').detach();
			var aHref=a.attr("href");
			if((!isBlank(h))&&(!isBlank(p.html()))&&(!isBlank(aHref))){
				p.html('<span><strong>'+h+' &mdash; </strong>'+p.html()+'</span>').append(a);
			}
if((!isBlank(h))&&(isBlank(p.html()))&&(!isBlank(aHref))){p.html('<span><strong>'+h+'</strong>'+p.html()+'</span>').append(a);}
if((isBlank(h))&&(!isBlank(p.html()))&&(!isBlank(aHref))){p.html('<span>'+p.html()+'</span>').append(a);}
if((!isBlank(h))&&(!isBlank(p.html()))&&(isBlank(aHref))){p.html('<span><strong>'+h+' &mdash; </strong>'+p.html()+'</span>');}
if((!isBlank(h))&&(isBlank(p.html()))&&(isBlank(aHref))){p.html('<span><strong>'+h+'</strong></span>');}
if((isBlank(h))&&(isBlank(p.html()))){p.html('');}}
break;case'homepage':for(var i=0;i<lis.length;i++){var t=$(lis[i]).children('h3').text();var h=$(lis[i]).children('h4').text();var p=$(lis[i]).children('p');var tHtml="";var hHtml="";if(t){tHtml='<span class="title '+$(lis[i]).children('h3')[0].className+'">'+t+'</span>';}
if(h||p){hHtml='<span class="main"><strong>'+h+' </strong>'+p.html()+'</span>';}
p.html(tHtml+hHtml);}
titles.hide();break;case'globetrotter':for(var i=0;i<lis.length;i++){var h=$(lis[i]).children('h4').text();var p=$(lis[i]).children('p');var tHtml="";var hHtml="";if(h){hHtml='<span class="main"><strong>'+h+' </strong>'+p.html()+'</span>';}
p.html(tHtml+hHtml);}
break;}


headers.each(function(){var sur=$(this);var surHtml='<span>0'+(headers.index(sur)+1)+'.</span>';if(options.type=="detail"){surHtml+=sur.text();}
sur.html(surHtml);if($(sur).outerHeight()>hHeight){hHeight=$(sur).outerHeight();}});if(options.type!='globetrotter'){var texts=lis.children('p').clone();texts.appendTo(textHolder).hide();}
lis.width(liWidth-1).bind('click',function(e){onLiClick(e,this);}).children('p').remove();if(options.type=='globetrotter'){containerHolder.hover(function(){if(isPaused){return}else{timerStop();surrogate.find('.playPause').addClass('play');}},function(){if(isPaused){return}else{timerStop();timerGo();surrogate.find('.playPause').removeClass('play');}});containerHolder.find('li').hover(function(){if(isPaused){return}else{timerStop();surrogate.find('.playPause').addClass('play');}});}
if(options.type!='homepage'&&options.type!='globetrotter'){textHolder.css({bottom:hHeight+options.progressHeight});}
if(options.type!='globetrotter'){surrogate.before(imgHolder).after(textHolder);}
else surrogate.before(containerHolder);textOverlay.width(liWidth).height(hHeight).insertBefore(surrogate);progressBar.css({bottom:hHeight}).width(surrogate.width()).insertAfter(surrogate);pb=new ProgressBar(progressBar,{sections:lis.length,dur:options.duration,easingMethod:options.easingMethod,handleColor:'#000'});indicator.css({bottom:hHeight,left:liWidth/2}).insertAfter(progressBar);lis.append(playPause);for(var i=0;i<lis.length;i++){var liSur=$(lis[i]);if(options.type=="detail"){var hH4=$(lis[i]).children('h4').html();var h4End=hH4.slice(-7);if(h4End="</span>"){$(lis[i]).children('h4').append("&nbsp;")}}
if(liSur.height()>liHeight){liHeight=liSur.height();}}
lis.append(playPause).css({"height":liHeight});timerGo();highLight(0);}
var isBlank=function(pString){if(!pString||pString.length==0){return true;}
return!/[^\s]+/.test(pString);}
var timerGo=function(){timer=setInterval(function(){pb.step();var indPos=Math.floor(pb.inSection());if(indPos<lis.length){if(currIndex!=indPos){currIndex=indPos;highLight(indPos);}}else{highLight(0);pb.setIndicator(0);}},options.speed);}
var timerStop=function(){clearInterval(timer);}
var onLiClick=function(e,t){if($(e.target).hasClass('playPause')){if(isPaused){timerGo();isPaused=false;surrogate.find('.playPause').removeClass('play');}else{timerStop();isPaused=true;surrogate.find('.playPause').addClass('play');}}else{var num=lis.index(t);highLight(num,true);currIndex=num;timerStop();}}
var highLight=function(num,clicked){if(options.type!='globetrotter'){var theImg=$(imgs[num]);var theP=$(textHolder.find('p')[num]);}else{var theContainer=$(container[num]);var theP=$(container.find('p')[num]);}
var theLi=$(lis[num]);var theHeader=$(headers[num]);var pauseBtn=theLi.find('.playPause');var indicatorTarget=theLi.position().left+theLi.width()/2-indicator.width()/2;headers.not(headers[num]).animate({color:hColor});if(options.type!='globetrotter')theP.fadeIn(options.duration).siblings('p').fadeOut(options.duration);surrogate.find('.playPause').not(pauseBtn).fadeOut();pauseBtn.fadeIn();if(options.type!='globetrotter')theImg.css({'z-index':1}).fadeIn(options.duration*1.5).siblings().css({'z-index':0}).fadeOut(options.duration);else theContainer.css({'z-index':1}).fadeIn(options.duration*1.5).siblings().css({'z-index':0}).fadeOut(options.duration);if(clicked){pb.stepTo(num/lis.length);}
if(!$('body').hasClass('siderale')){theHeader.animate({color:'#000'});}
indicator.stop().animate({left:indicatorTarget},{duration:options.duration,easing:options.easingMethod});if(options.type!='globetrotter'){if(isBlank(theP.text())){theP.parent().css({'display':'none'});}else{theP.parent().css({'display':'block'});}}
textOverlay.stop().animate({left:theLi.position().left},{duration:options.duration,easing:options.easingMethod,complete:function(){if(clicked&&!isPaused){timerGo();}}});}
var globetrotter={slideContainment:undefined,sliderPanel:undefined,liWidth:undefined,panelLi:undefined,liIndex:undefined,currentSection:undefined,listLength:undefined,panelLiLength:undefined,menuItemOriginalHeight:undefined,hoverOverlay:undefined,absMargin:undefined,animateHoverMenu:undefined,addHoverMenu:undefined,init:function(){var self=this;var selfSlider=surrogate.parents(".iwcSlider");self.addHoverMenu=500;self.animateHoverMenu=500;self.slideContainment=$('div.slide-containment',selfSlider);self.sliderPanel=self.slideContainment.find('ol.slider-panel');self.setLiWidth();self.paginationCount();self.bind();},bind:function(){var self=this;self.sliderPanel.children('li').mouseenter(function(){self.currentSection=$(this);self.currentSection.find('h6').css('color','#ffffff');var thisLiMargin=self.currentSection.find('img').css('marginLeft');var parsedMargin=parseInt(thisLiMargin);self.absMargin=Math.abs(parsedMargin);self.showImage();self.animateHover();self.hideMenuItem();self.displayMenuItem();});self.sliderPanel.children('li').mouseleave(function(){self.currentSection.find('h5').css('color','#666666');self.currentSection.find('h6').css('color','#666666');self.showMenuItem();});self.sliderPanel.mouseenter(function(){$(this).children('li').find('h5').css('color','#666666');$(this).children('li').find('h6').css('color','#666666');self.currentSection.find('h6').css('color','#ffffff');self.hideOverlay();self.addHoverIndicator();self.hideMenuItem();self.displayMenuItem();});self.sliderPanel.mouseleave(function(){self.sliderPanel.children('li').find('h5').css('color','#ffffff');self.sliderPanel.children('li').find('h6').css('color','#ffffff');self.displayOverlay();self.removeHoverIndicator();self.hideImage();});},displayOverlay:function(){var self=this;self.slideContainment.find('div.menu-overlay').stop(true,true).animate({'opacity':.4});self.slideContainment.find('h3').stop(true,true).fadeIn();},hideOverlay:function(){var self=this;self.slideContainment.find('div.menu-overlay').stop(true,true).animate({'opacity':0});self.slideContainment.find('h3').stop(true,true).fadeOut();},setLiWidth:function(){var self=this;listLength=self.sliderPanel.each(function(){var me=this;me.panelLiLength=$(this).children('li').length;switch(me.panelLiLength){case 5:$(this).addClass('menu-items-5');break;case 4:$(this).addClass('menu-items-4');break;case 3:$(this).addClass('menu-items-3');break;case 2:$(this).addClass('menu-items-2');break;case 1:default:$(this).addClass('menu-items-1');break;}});self.setupMenu();},addHoverIndicator:function(){var self=this;var thisLiWidth=self.currentSection.innerWidth();self.sliderPanel.append('<div class="menu-item-hover-overlay"></div>');self.hoverOverlay=self.sliderPanel.find('div.menu-item-hover-overlay');self.hoverOverlay.stop(true,true).animate({'height':335},self.addHoverMenu);if(self.currentSection.hasClass('last')){self.hoverOverlay.css({'width':thisLiWidth-1,'marginLeft':self.absMargin+1});}else if(self.currentSection.hasClass('first')){self.hoverOverlay.css({'width':thisLiWidth+1,'marginLeft':self.absMargin});}else{self.hoverOverlay.css({'width':thisLiWidth,'marginLeft':self.absMargin+1});}},animateHover:function(){var self=this;var thisLiWidth=self.currentSection.innerWidth();if(self.currentSection.hasClass('last')){self.hoverOverlay.stop(true,true).animate({'width':thisLiWidth-1,'marginLeft':self.absMargin+1},self.animateHoverMenu);}else if(self.currentSection.hasClass('first')){self.hoverOverlay.stop(true,true).animate({'width':thisLiWidth+1,'marginLeft':self.absMargin},self.animateHoverMenu);}else{self.hoverOverlay.stop(true,true).animate({'width':thisLiWidth,'marginLeft':self.absMargin+1},self.animateHoverMenu);}},removeHoverIndicator:function(){var self=this;self.hoverOverlay.stop(true,true).animate({'height':0},function(){$(this).remove();});},hideMenuItem:function(){var self=this;self.currentSection.find('.menu-item').stop(true,true).fadeOut();},displayMenuItem:function(){var self=this;menuCurrent=self.currentSection.find('.menu-item').css({'height':330});self.currentSection.find('h6').css({'font-family':'ProximaNovaBold','font-style':'normal','text-transform':'uppercase','font-size':'16px'});self.currentSection.find('h5').css({'color':'#c2c2c2'});pCurrent=self.currentSection.find('p').show();pHeight=pCurrent.outerHeight();if(pHeight>250){pCurrent.css({'font-size':'14px','line-height':'1.35'});}
self.currentSection.find('.menu-item').stop(true,true).delay(500).fadeIn();},showMenuItem:function(){var self=this;self.currentSection.find('.menu-item').css({'height':51,'display':'none'});self.currentSection.find('p').hide();self.currentSection.find('h6').css({'font-family':'Bookman Old Style, Palatino Linotype, Palatino, URW Palladio L, Book Antiqua, Georgia, serif','font-style':'italic','text-transform':'none','font-size':'14px'});self.currentSection.find('.menu-item').stop(true,true).delay(300).fadeIn();},setupMenu:function(){var self=this;self.sliderPanel.find('p').hide();self.sliderPanel.each(function(){var me=this;var lindex=0;if($(this).hasClass('menu-items-5')){me.liWidth=194;}else
if($(this).hasClass('menu-items-4')){me.liWidth=243;}else
if($(this).hasClass('menu-items-3')){me.liWidth=324;}else
if($(this).hasClass('menu-items-2')){me.liWidth=486;}else
if($(this).hasClass('menu-items-1')){me.liWidth=972;}
me.panelLi=$(this).children('li');$(this).children('li:last-child').addClass('last');me.panelLi.each(function(index,value){$thisPanel=me.panelLi.eq(index);lindex=$thisPanel.index();if(lindex==0){$(this).addClass('first');}
$(this).find('img').css({'marginLeft':-(lindex*me.liWidth)});});me.panelLi.find('.menu-item').css({'width':(me.liWidth-40)});});},showImage:function(){var self=this;self.sliderPanel.children('li').not(self.currentSection).find('img').stop(true,true).fadeOut();self.currentSection.find('img').stop(true,true).fadeIn();self.currentSection.css({'overflow':'visible'});},hideImage:function(){var self=this;self.sliderPanel.find('img').stop(true,true).fadeIn(0);self.sliderPanel.children('li').css({'overflow':'hidden'});},paginationCount:function(index){var self=this;var totalLength=self.sliderPanel.children('li').length;self.sliderPanel.each(function(index){var me=this;var sliderPanel=$(this);var prevLength=sliderPanel.parents('div.slide-containment').prevAll().find('li').length;var lastPage=(sliderPanel.children('li').length)+prevLength;var firstPage=prevLength+1;var slidePos=sliderPanel.parents('.slideContainer').children('div.slide-containment').eq(index);var slidePagination=sliderPanel.parents('.slideContainer').siblings('.slider').find('li').eq(index);var slideIndex=slidePos.index();var paginationIndex=slidePagination.index();if(slideIndex==paginationIndex){if(sliderPanel.children('li').length>1){slidePagination.find('h4 span').text(firstPage+' - '+lastPage);}else{slidePagination.find('h4 span').text(lastPage);}}});}};init();if(options.type=='globetrotter')globetrotter.init();return this.each(function(){});}
$.fn.packSlider=function(options){var defaults={speed:200,easingMethod:GLOBAL_EASING,limit:7,childElems:this.children('li')};var options=$.extend(defaults,options);var list=this;var wrap=$('<div class="packSlider"/>');var inner=$('<div class="inner"/>');var controlBox=$('<div class="controlBox"/>');var lArrow=$('<div class="lArrow"/>');var rArrow=$('<div class="rArrow"/>');var watches=options.childElems;var watchWidth;var cursor=0;lArrow.bind('click',function(){onButtonClick('left');});rArrow.bind('click',function(){onButtonClick('right');}).addClass('on');controlBox.append(lArrow).append(rArrow);this.wrap(wrap).before(controlBox).wrap(inner);watchWidth=$(watches[0]).outerWidth(true);$(this.parent(".inner")).width(watchWidth*options.limit);this.width(watchWidth*watches.length);if($(this).find('h6').length==1){$(this).find('h6').detach().addClass('detached').insertBefore(controlBox);}
$('#psDrawer').height();var onButtonClick=function(dir){switch(dir){case'right':cursor+=options.limit;if(cursor+options.limit>=watches.length){cursor=watches.length-options.limit;rArrow.removeClass('on');lArrow.addClass('on');}
break;case'left':cursor-=options.limit;if(cursor<=0){cursor=0;lArrow.removeClass('on');rArrow.addClass('on');}
break;}
var scrollTarg=-cursor*watchWidth;list.animate({'margin-left':scrollTarg},{duration:options.speed});}}
$.fn.frontBackSlider=function(opts){var defaults={dur:300,easing:GLOBAL_EASING};var frontBackID=$(this).attr("id");var wrap=$('<div id="'+frontBackID+'" class="frontBackWrap"></div>');var options=$.extend(defaults,opts);var sur=this;var sliderWindow=$('<div class="sliderWindow"></div>');var handle=$('<div class="handle"></div>');var shadow=$('<div class="shadow"></div>');var controls=$('<div class="fbSliderControls"><a href="#back" class="first">'+string_VIEW_BACK+'</a><a href="#front" >'+string_VIEW_FRONT+'</a></div>');var frontBtn=controls.find('a[href$="#front"]');var backBtn=controls.find('a[href$="#back"]');var front=this.find('.front');var limitRight=432;var half=limitRight/2;var shW;var lineLength=function(x,y,x0,y0){return Math.sqrt((x-=x0)*x+(y-=y0)*y);};this.wrap(wrap);if(this.find('li').length==2){sliderWindow.append(handle).insertBefore(this);controls.insertAfter(this);shW=shadow.width();if(opacitySupport){shadow.css({opacity:.1});}else{shadow.hide();}}
frontBtn.bind('click',function(){slideWindowTo(442);return false;});backBtn.bind('click',function(){slideWindowTo(handle.width()+2);return false;});handle.bind('drag',function(e,d){var pX=d.offsetX-$('#'+frontBackID).offset().left;var realX=(pX+30);var targX=Math.min(limitRight,Math.max(32,realX));sliderWindow.width(targX);front.width(targX-15);if(opacitySupport){var tmp=lineLength(pX+15,0,half,0);var shO=tmp/half;shadow.css({left:targX-shW,opacity:1-shO});}});var slideWindowTo=function(x){sliderWindow.stop().animate({width:x},{duration:options.dur,easing:options.easing});front.stop().animate({width:x-15},{duration:options.dur,easing:options.easing});var shoPac=1-(lineLength(x+15,0,half,0)/half);if(opacitySupport){shadow.stop().fadeTo(options.dur/2,.1).animate({left:x-shW,opacity:0},{duration:options.dur,easing:options.easing,queue:false});}}
slideWindowTo(limitRight);}
var packshotDrawer=function(){var endHeight=370;var sliderHeight=251;var psDrawer=$('#psDrawer');if(psDrawer.find('.promos .packSlider').length>=1){endHeight=370;}else if(psDrawer.find('.packSlider').length>=1){endHeight=390;}
var controls=$('.drawerButton');var controlClone=controls.clone();var isDown=false;var sldr=psDrawer.find('.packSlider');controlClone.insertBefore(psDrawer.children(':first-child'));var buttons=$('a[href="#drawerOpen"]');buttons.bind('click',function(){if(isDown==false){psDrawer.animate({height:endHeight}).css({'border-bottom-width':1});sldr.animate({height:sliderHeight,paddingTop:50,paddingBottom:20});controls.fadeTo(200,0);isDown=true;}else{psDrawer.animate({height:0}).css({'border-bottom-width':0});sldr.animate({height:0,paddingTop:0,paddingBottom:0});controls.fadeTo(200,1);isDown=false;}
return false;});};$.fn.calibre2=function(opts){var defaults={dur:200}
var options=$.extend(defaults,opts);var cParts=this.find('li');var partsBox=$('<div id="calibrePartsBox"></div>');var washout=$('<li class="washout"></li>');var copyBox=$('<div class="calibreCopy"></div>');var prevNext=$('<p id="prevNext"><a href="#prev" class="prev">'+string_PREV+'</a><a href="#next" class="next">'+string_NEXT+'</a></p>');var copyList=cParts.find('p').clone();var currPart=0;var prevPart=0;var raphHolder=$('<div/>').attr({id:'raphHolder'});var bg=$('<div/>').attr({id:'cbg'});var paper;var animDur=100;var lineStart={x:401,y:741}
var hoverConfig={interval:50,timeout:200,over:function(){onPartOver(this)},out:function(){onPartOut(this)}}
var onPartOver=function(e){var part=$(e);fadeInPart(part);}
var onPartOut=function(e){}
var onPartClick=function(e){var ind=cParts.index(e);if(ind!=currPart){showPartInfo(ind);}}
var onPrevNextClick=function(e){var newPart;switch($(e.target).attr('href')){case'#prev':newPart=currPart-1>0?currPart-1:0;break;case'#next':newPart=currPart+1<cParts.length?currPart+1:cParts.length-1;break;}
if($(e.target).hasClass('disabled')==false){showPartInfo(newPart);fadeInPart($(cParts.get(newPart)));}}
var showPartInfo=function(ind){var pToShow=$(copyList.get(ind));var yOffset=0;var xOffset=0;copyBox.attr('class','calibreCopy c_'+ind);copyList.hide().filter(pToShow).show();prevNext.show();switch(ind){case 0:yOffset=20;xOffset=20;break;case 1:yOffset=10;xOffset=0;break;case 2:yOffset=10;xOffset=40;break;case 3:yOffset=30;xOffset=10;break;case 4:yOffset=40;xOffset=30;break;case 5:yOffset=50;xOffset=33;break;}
drawLine(lineStart.x,lineStart.y,$(cParts[ind]).position().left+xOffset,$(cParts[ind]).position().top+yOffset);currPart=ind;if(currPart==0){$('#prevNext .prev').addClass('disabled');}else{$('#prevNext .prev').removeClass('disabled');}
if(currPart>=cParts.length-1){$('#prevNext .next').addClass('disabled');}else{$('#prevNext .next').removeClass('disabled');}}
var drawLine=function(ox,oy,tx,ty){if($('#prevNext').hasClass('drawn')==false){$('#prevNext').addClass('drawn');$('#calibreContainer .pullQuote').hide();}
paper.clear();var l=paper.path('M'+ox+'  '+oy);l.attr({stroke:'#a3443e','stroke-width':'1px'})
var p1='M'+ox+' '+oy;var p2='L'+ox+' '+(oy-20);var p3='L1 '+(oy-20);var p4='L1 '+ty;var p5='L'+tx+' '+ty;l.animate({path:p1},animDur,function(){l.animate({path:p1+p2},animDur,function(){l.animate({path:p1+p2+p3},animDur,function(){l.animate({path:p1+p2+p3+p4},animDur,function(){l.animate({path:p1+p2+p3+p4+p5},animDur);});});});});}
var fadeInPart=function(part){cParts.stop().fadeTo(options.dur,0).filter(part).fadeTo(options.dur,1);}
partsBox.bind('mouseenter',function(){washout.stop().fadeTo(options.dur,.6);copyBox.fadeIn();}).bind('mouseleave',function(){washout.stop().fadeTo(options.dur,0);cParts.stop().fadeTo(options.dur,0);});this.addClass('initialized').wrap(partsBox);$('#prevNext .prev').addClass('disabled');washout.css({opacity:0}).appendTo(bg);copyList.hide();prevNext.find('a').bind('click',function(e){onPrevNextClick(e);return false;});copyBox.append(prevNext).append(copyList).insertAfter(this).hide();bg.insertBefore(this);raphHolder.height(this.height()).insertBefore(this);paper=Raphael("raphHolder",raphHolder.width(),raphHolder.height());cParts.hoverIntent(hoverConfig).css({opacity:0}).bind('click',function(){onPartClick(this);}).each(function(i){$(this).addClass('c_part_'+i);});return this.each(function(){});}



var paralaxBG=function(){
	var w=$(window);
	var b=$('body');
	w.scroll(function(){
		var paralaxStartY=350;
		if($('body').hasClass('siderale')){
			paralaxStartY=150;
		}
	var bgTargY=-w.scrollTop()/4+paralaxStartY;
	var bgTarg='50% '+bgTargY+'px';
	b.css('backgroundPosition',bgTarg);
	});
}

var equalizeColumns=function(){var rowsToEQ=$('#wrapper .row, .promos .row').not('.retail .row, .commentList, .intervention .details, .creators.row, .detail-header');var homeCols=$('.homeFirstCol, .homeSecondCol, .homeThirdCol');rowsToEQ.each(function(){var heights=[];var theCols=$(this).find('.col_4, .col_3, .col_8, .col_9').not('.creatorBioRow2 .col_4, .creatorBioRow1 .col_4, .no-js-height');if(theCols.length>1){theCols.each(function(){heights.push($(this).height());});theCols.height(Math.max.apply(Math,heights));}});}
var formPlaceholderSetup=function(){$(".comments textarea, .commentsBox textarea, .commentsBox input.text, .commentsBox input[type=text]").each(function(){$(this).bind({focus:function(){$("label[for='"+$(this).attr('id')+"']").fadeOut(100)},blur:function(){if($(this).val()==""){$("label[for='"+$(this).attr('id')+"']").fadeIn(100)}}});if($(this).val()!=""){$("label",$(this).parent()).hide();}});}
var commentFieldSetup=function(){$('.comments textarea').bind('focus',function(){if($('.userHello').length<1){getForm({url:url_REGISTER});}}).addClass('required');$('#commentPost').validateForm();}
var forumLinksSetup=function(){$('.forum table tbody tr').each(function(){var theRow=$(this);$('td',this).live('click',function(){document.location=theRow.find('a').attr('href');});}).css({cursor:'pointer'});}
var collectionLandingLinksSetup=function(){$('.collection .gallery .col.first .familyModule, .collection .gallery .col.last .familyModule').bind('click',function(){document.location=$(this).find('a').attr('href');});}
var CommentExpando=function(el,theLimit){this.cList=$(el);this.limit=theLimit;this.lis=$('li',this.cList);this.button=$('a.viewAllComments');this.downText=string_COLLAPSE_COMMENTS;this.upText=this.button.text();if(this.lis.length>this.limit){this.button.css({display:'block'});this.collapse();}}
CommentExpando.prototype.collapse=function(){var surrogate=this;if(this.cList.hasClass('commentList')){}
this.lis.each(function(i){if(i>surrogate.limit-1){$(this).hide();}});this.button.bind('click',function(e){e.preventDefault();surrogate.expand();}).removeClass('down').find('span').text(this.upText);}
CommentExpando.prototype.expand=function(){var surrogate=this;this.lis.show();this.button.bind('click',function(e){e.preventDefault();surrogate.collapse();}).addClass('down').find('span').text(this.downText);}
var ShareBar=function(){}
var InitMasonry=function(){$('.social-tile-block').masonry({itemSelector:'.filterListItem',columnWidth:300,isAnimated:true});}
var recalculateFirstLastClasses=function(elements,mode){if(!elements){elements=getTileGroups();}
if(!mode){mode=getCurrentFilterName();}
var maxWidth=3;var columnWidths={'default':{'youtube':1.5,'facebook':1,'twitter':1,'instagram':1},'all':{'youtube':2,'facebook':1,'twitter':1,'instagram':1}};var classes=[];$.each(columnWidths['default'],function(key){classes.push(key);});var widths;if(columnWidths.hasOwnProperty(mode)){widths=columnWidths[mode];}else{widths=columnWidths['default'];}
getTiles(elements).removeClass('first').removeClass('last');for(var group_index=0;group_index<elements.length;group_index++){var tiles=getVisibleTiles(elements[group_index]);var width=0;var remainingWidth=maxWidth;for(var i=0;i<tiles.length;i++){var element=$(tiles[i]);$.each(classes,function(i,className){if(element.hasClass(className)){width=widths[className]}});if(width>remainingWidth){remainingWidth=maxWidth;}
if((remainingWidth-width)>=0){if(remainingWidth==maxWidth){element.addClass('first');}
remainingWidth=remainingWidth-width;if(remainingWidth==0){element.addClass('last');remainingWidth=maxWidth;}}else if(i>0){$(tiles[i-1]).addClass('last');remainingWidth=maxWidth;}}}};var getNumDisplayedRows=function(){var visible_tiles=$(".filterListItem:visible");var all_tops=new Array();visible_tiles.each(function(){var tile_top=$(this).position().top;if($.inArray(tile_top,all_tops)<0){all_tops.push(tile_top);}});return all_tops.length;}
var getCurrentFilterName=function(){return $(".social-aggregator .aggregator-bar li.active").text().toLowerCase();};var getTileGroups=function(){return $(".filterList");};var getTiles=function(items){if(items){var tt=$(".filterListItem",items);return tt;}
return $(".filterListItem");}
var getVisibleTiles=function(items){if(items){var tt=$('.filterListItem:visible',items);return tt;}
return $('.filterListItem:visible');}
var updateDateBlocks=function(){$(".date").each(function(){if(!$(".filterListItem:visible",$(this).next(".filterList")).length){$(this).css({'display':'none'});}else{$(this).css({'display':'block'});}});}
var ChangeYoutubeWidth=function(class_name){if(class_name=='youtube'){$(".filterListItem.youtube.col_8").each(function(){$(this).removeClass("col_8").addClass("col_6");});}else{$(".filterListItem.youtube.col_6").each(function(){$(this).removeClass("col_6").addClass("col_8");});}};var FilterTiles=function(class_name){var tile_groups=getTileGroups();var tiles=getTiles();class_name=$.trim(class_name);if(class_name==="all"){tiles.show();ChangeYoutubeWidth(class_name);recalculateFirstLastClasses(tile_groups,class_name);}else{tiles.not("."+class_name).hide();tiles.filter('.'+class_name).show();ChangeYoutubeWidth(class_name);recalculateFirstLastClasses(tile_groups,class_name);}
updateDateBlocks();};var InitLoadMore=function(){$(".load-more").show();$(".load-more a").click(function(e){e.preventDefault();var current_filter=getCurrentFilterName();var current_row_count=getNumDisplayedRows();var target_row_count=current_row_count+4;while((current_row_count<target_row_count)&&tile_data.length>0){var new_row=tile_data.shift();if(typeof new_row!=='undefined'){if(new_row['date']!==$(".date").last().text()){var date_html=date_template(new_row);date_html+="<ul class='tiles filterList'></ul>";$(".social-tile-block").append(date_html);date_html="";}
var new_html="";for(var index in new_row['items']){var item=new_row['items'][index];template=GetTemplate(item);new_html+=template(item);displayed_tiles.push(item);}
$(".filterList").last().append(new_html);FilterTiles(current_filter);}
recalculateFirstLastClasses();current_row_count=getNumDisplayedRows();}
if(tile_data.length==0){$(".loadMore").hide();}
else if(tile_data.length<10){ajaxLoadTileData()}})}
var ajaxLoadTileData=function(){var url="/social_aggregator/"+aggregator_id+"/"+aggregator_list_length+"/";$.ajax({url:url,success:function(result){if(result.length){tile_data=tile_data.concat(result);}}});}
var templateFilters={tweetOverlay:function(item){function urlise(text){var list=text.match(/\b(http:\/\/|www\.|http:\/\/www\.)[^ <]{2,200}\b/g);if(list){for(var i=0;i<list.length;i++){var prot=list[i].indexOf('http://')===0||list[i].indexOf('https://')===0?'':'http://';text=text.replace(list[i],'<a target="_blank" href="'+prot+list[i]+'">'+list[i]+'</a>');}}
return text;}
function processTweetLinks(text){var exp=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/i;text=text.replace(exp,"<a href='$1' target='_blank'>$1</a>");exp=/(^|\s)#(\w+)/g;text=text.replace(exp,"$1<a href='http://search.twitter.com/search?q=%23$2' target='_blank'>#$2</a>");exp=/(^|\s)@(\w+)/g;text=text.replace(exp,"$1<a href='http://www.twitter.com/$2' target='_blank'>@$2</a>");return text;}
var content=item.content;content=urlise(content);content=processTweetLinks(content);item.content=content;item.filtered=true;return item;}};var GetTemplate=function(item,overlay){var template;switch(item['type']){case"tweet":if(overlay){if(typeof item.filtered==='undefined'||item.filtered===false){item=templateFilters.tweetOverlay(item);}}
template=overlay?tweet_overlay_template:tweet_template;break;case"instagram":template=overlay?instagram_overlay_template:instagram_template;break;case"youtube":template=overlay?youtube_overlay_template:youtube_template;break;default:template=overlay?facebook_overlay_template:facebook_template;}
return template;};var InitFeedFilters=function(){$(".social-aggregator .aggregator-bar li").live('click',function(){var self=$(this);FilterTiles(self.text().toLowerCase());self.addClass('active').siblings().removeClass('active');});};var InitSocialTileOverlay=function(item){var currentIndex=$.inArray(item,$(".filterListItem"));var overlay_content=[];var current_filter=getCurrentFilterName();for(var index=0;index<displayed_tiles.length;index++){var item=displayed_tiles[index];var new_item=$(GetTemplate(item,true)(item));if(current_filter!=='all'&&!new_item.hasClass(current_filter)){continue;}
overlay_content.push(new_item);if(index==currentIndex){currentIndex=overlay_content.length-1;}}
var overlay=new TileLightBox(overlay_content,{'width':400,'currentItem':currentIndex});overlay.open();};function TileLightBox(itemArray,options){var surrogate=this;var defaults={isOpen:false,currentItem:0,verticalBuffer:100,animate:true,topMargin:80};$.extend(true,this,defaults,options);this.items=itemArray;this.$elmts={};this.scrollable=false;this.$elmts.lightBox=$("<div/>",{"class":"lightBox social"}).css({"position":"fixed","top":0,"left":0,"width":"100%","height":"100%","zIndex":500,"opacity":1}).data("lightBox",this);if(opacitySupport){this.$elmts.lightBox.css({"opacity":0});}
this.$elmts.overlay=$("<div/>",{"class":"overlay","click":function(){surrogate.close();}}).css({"position":"absolute","top":0,"left":0,"width":"100%","height":"100%"}).appendTo(this.$elmts.lightBox);this.$elmts.container=$("<div/>",{"class":"container"}).css({"position":"absolute","top":this.topMargin}).appendTo(this.$elmts.lightBox);this.$elmts.controls=$("<div/>",{"class":"controls"}).appendTo(this.$elmts.container);this.$elmts.prevButton=$("<span/>",{"class":"prevButton","click":function(){if(!$(this).hasClass("disabled")){surrogate.goToItem(surrogate.currentItem-1,this.animate);}}}).appendTo(this.$elmts.controls);this.$elmts.closeButton=$("<span/>",{"class":"closeButton","click":function(){surrogate.close();}}).appendTo(this.$elmts.controls);this.$elmts.nextButton=$("<span/>",{"class":"nextButton","click":function(){if(!$(this).hasClass("disabled")){surrogate.goToItem(surrogate.currentItem+1,this.animate);}}}).appendTo(this.$elmts.controls);this.$elmts.itemContainer=$("<div/>",{"class":"itemContainer"}).css({"position":"relative","min-height":100,"text-align":"center"}).appendTo(this.$elmts.container);for(var item_index=0;item_index<this.items.length;item_index++){this.items[item_index].css({opacity:0,display:'none'}).appendTo(this.$elmts.itemContainer);}
this.$elmts.pinterestScript=$('<script type="text/javascript" src="http://assets.pinterest.com/js/pinit.js"></script>').appendTo(this.$elmts.itemContainer);this.$elmts.item=null;if(this.currentItem&&this.currentItem>0){this.goToItem(this.currentItem);}else{this.currentItem=null;this.goToItem(0);}
this.open();};TileLightBox.prototype.open=function(){var surrogate=this;this.isOpen=true;this.$elmts.lightBox.appendTo("body");$(window).bind("resize.lightBox",function(){surrogate._updatePosition();});if(opacitySupport){this.$elmts.lightBox.fadeTo(300,1);this._updatePosition();}else{this.$elmts.lightBox.show();this._updatePosition();}
$(document).bind("keyup.lightBox",function(e){switch(typeof e.keyCode=="number"?e.keyCode:e.which){case G_KEYCODES.esc:surrogate.close();break;case G_KEYCODES.left:surrogate.$elmts.prevButton.trigger("click");break;case G_KEYCODES.right:surrogate.$elmts.nextButton.trigger("click");break;}});return this;};TileLightBox.prototype.close=function(){if(this.isOpen){var surrogate=this;$(document).unbind("keyup.lightBox");var top=this.$elmts.overlay.offset().top;window.location.hash="";if($.scrollTo){$.scrollTo(top);}
if(opacitySupport){this.$elmts.lightBox.fadeTo(300,0,function(){surrogate.$elmts.lightBox.detach();$(window).unbind("resize.lightBox");surrogate.isOpen=false;});}else{this.$elmts.lightBox.hide().detach();$(window).unbind("resize.lightBox");this.isOpen=false;}}
return this;};TileLightBox.prototype.setItem=function(index){if(typeof index!="number"){index=parseInt(index);}
if(index<0){index=0;}else if(index>=this.items.length){index=this.items.length-1;}
this.currentItem=index;if(this.currentItem<=0){this.$elmts.prevButton.addClass("disabled");}else{this.$elmts.prevButton.removeClass("disabled");}
if(this.currentItem>=this.items.length-1){this.$elmts.nextButton.addClass("disabled");}else{this.$elmts.nextButton.removeClass("disabled");}
return this;};TileLightBox.prototype.goToItem=function(index){if(index>=0){var surrogate=this;var oldItem=this.currentItem;if(typeof oldItem!=='undefined'&&oldItem!==null&&oldItem!==index){this.items[oldItem].animate({"opacity":0},300,function(){$(this).css({'display':'none'});});}
this.items[index].css({'display':'block'}).animate({'opacity':1},300,function(){$(".shareBar").each(function(){$(this).shareBarInit();if(typeof gapi!='undefined'){if($(".googlePlusButton").length>0){gapi.plusone.go();}}});surrogate.$elmts.container.css({'height':$(this).outerHeight()});surrogate._updatePosition();});this.setItem(index);}};TileLightBox.prototype._updatePosition=function(){var surrogate=this;var htDiff=$(window).height()-this.$elmts.container.outerHeight(false);if(htDiff>0){if(this.scrollable){this.scrollable=false;$(window).unbind("scroll.lightbox");}
this.$elmts.container.css({"top":this.verticalBuffer});}else{if(!this.scrollable){this.scrollable=true;this.overlayTop=this.$elmts.overlay.offset().top;$(window).bind("scroll.lightbox",function(){var topDiff=surrogate.overlayTop-surrogate.$elmts.overlay.offset().top;surrogate.overlayTop=surrogate.$elmts.overlay.offset().top;surrogate._scroll(topDiff);});}}
var visibleContent=$(".content:visible",this.$elmts.container);var visibleDescription=$(".description:visible",this.$elmts.container);var headerHeight=$(".header",visibleDescription).outerHeight(true)+$(".shareBar",visibleDescription).outerHeight(true);var itemWidth=visibleContent.outerWidth()
+visibleDescription.outerWidth();this.$elmts.container.css({"left":($(window).width()-itemWidth)/2});var imageHeight=visibleContent.outerHeight();$(".text",visibleDescription).css({'height':imageHeight-headerHeight});this.$elmts.controls.css({"left":itemWidth/2-this.$elmts.controls.outerWidth()/2});};TileLightBox.prototype._scroll=function(delta){var diff=$(window).height()-this.$elmts.container.outerHeight();var newTop=this.$elmts.container.position().top+delta;if(newTop>this.topMargin){newTop=this.topMargin;}else if(newTop<diff){newTop=diff;}
this.$elmts.container.css({"top":newTop});};var BindTileOverlay=function(){$(".filterListItem").live('click',function(e){InitSocialTileOverlay(this);e.stopPropagation();})}
$.fn.shareBarInit=function(){var lo=47
$(this).each(function(){var t=$(this);$('a.sharePage').bind('click',function(){return false;})
if(t.parent().hasClass('col_4')){lo=12;}else if(t.closest('.actionBar').length>0){lo=17;}
$('.fbLinks',this).each(function(){var targ=t.find('.facebook');new IwcToolTip(this,targ,{wrapperClass:'share',leftOffset:lo});}).bind('click',function(e){e.preventDefault();});$('.pinterestLinks',this).each(function(){var targ=t.find('.pinterest');new IwcToolTip(this,targ,{wrapperClass:'share',leftOffset:lo});}).bind('click',function(e){e.preventDefault();});$('a.twitter',this).bind('click',function(e){e.preventDefault();var loc=window.location.href;var title=document.title.split(" | ");window.open('http://twitter.com/share?url='+loc+'&text='+encodeURIComponent(title[title.length-1])+' @IWC - ','twitterWindow','height=450, width=550, top='+($(window).height()/2-225)+', left='+$(window).width()/2+', toolbar=0, location=0, menubar=0, directories=0, scrollbars=0');return false;}).attr('href','');});}
$(document).ready(function(){if(!isIE6){$("img[alt='MCBE Form Button']").parent().siblings().css({'display':'none'});if($('.slider.homepage-marquee').length>0){$('.slider.homepage-marquee').iwcSlider({type:'homepage'});}
if($('.slider.family-marquee').length>0){$('.slider.family-marquee').each(function(){$(this).iwcSlider({type:'family'});})}
if($('.slider.detail-marquee').length>0){$('.slider.detail-marquee').each(function(){if($(".article-the-volvo-ocean-race").length>0){$(this).iwcSlider({type:'family'});}else{$(this).iwcSlider({type:'detail'});}})}
if($('.slider.globetrotter-marquee').length>0){$('.slider.globetrotter-marquee').each(function(){$(this).iwcSlider({type:'globetrotter',height:426});})}
$('.frontBack').each(function(){$(this).frontBackSlider();});$('.pack_shots').each(function(){if($(this).children('li').length>7){$(this).packSlider();}});$('.promos .row').each(function(){var elems=$(this).children('.col_3');if(elems.length>4){$(this).packSlider({childElems:elems,limit:4});}});$('.variations').each(function(i){$(this).find("ul").buildWatchDetail($(".enlarge"));});if(document.getElementById('calibreParts')){$('#calibreParts').calibre2();}
if($('body').hasClass('paralax')){paralaxBG();}
if(document.getElementById('psDrawer')){packshotDrawer();}
if($('.tabs').length>0){$('.tabs').tabNav();}
$('.psInfo').each(function(){new PackOverlay(this);});$('.dayNight').each(function(){new DayNight(this);});if(document.getElementById('searchFilter')){new SearchFilter();}
if(document.getElementById('profileForm')){new ProfileForm();}
if(document.getElementById('galapagosForm')){new GalapagosForm();}
if(document.getElementById('laureusForm')){new LaureusForm();}
if($('.articleFilter').length>0){$('.articleFilter .inner').each(function(){new StickyFilter(this);});new ExperienceFilter();}
if(!$('body').hasClass('homepage')&&$('.conciergeBar').length>0){var conciergeBarFloat=$('.conciergeBarFloat');if(conciergeBarFloat.length>0)
new StickyConciergeBar(conciergeBarFloat.eq(0));}
if($('.conciergeLocationBar').length>0){$('.conciergeLocationBar').each(function(i){new ConciergeLocationBar($(this));});if(!$('body').hasClass('homepage')){var conciergeBarFloat=$('.conciergeBarFloat');if(conciergeBarFloat.length>0)
new StickyConciergeBar(conciergeBarFloat.eq(0));}}
if($('.conciergeBarMore').length>0){$('.conciergeBarMore').each(function(i){new ConciergeBarMoreButton($(this));});}
$('.psDrawer div.promo, .promos .promo, .promoModule .promo').not('#wrapper .promos .promo, .service .promos .promo, .siderale .promos .promo, .city .promos .promo').each(function(){if(LANGUAGE_CODE=='ja'){$(this).find('h5').truncateBlockAtChar(35,'...');var desc=$(this).find("p");if(desc.html()){var fullHref=$(this).find("a").eq(0).attr("href");var appendix=desc.html().length>0?"...&nbsp;<a>"+string_READ_MORE+"</a>":"<a>"+string_READ_MORE+"</a>";desc.html(desc.html()+appendix);desc.truncateBlockAtChar(65,appendix);desc.find("a").attr("href",fullHref);}}
else{var lineHeight=parseInt($(this).find('h5').css("line-height")),ht=$(this).find('h5').height(),descTrunc;if(ht>lineHeight){$(this).find('h5').truncateBlockAtLine(2,"...");descTrunc=2;}else{descTrunc=3;}
var desc=$(this).find("p");if(desc.html()){var fullHref=$(this).find("a").eq(0).attr("href");var appendix=desc.html().length>0?"...&nbsp;<a>"+string_READ_MORE+"</a>":"<a>"+string_READ_MORE+"</a>";desc.html(desc.html()+appendix);desc.truncateBlockAtLine(descTrunc,appendix);desc.find("a").attr("href",fullHref);}}})
if(typeof target_tab!=="undefined"){$('a[href$="#'+target_tab+'"]').trigger('click');}
if(typeof final_redirect!=="undefined"){setTimeout("location.href="+final_redirect,5000);}
if($('#sectionNav').length>0){var sn=$('#sectionNav');var as=sn.find('a');var anchors=$('a.anchor');var curContent;var prevContent;new StickyFilter(sn.children('ul'),{ot:1976});sn.localScroll({hash:true});as.bind('click',function(){$(this).addClass('selected');as.not(this).removeClass('selected');});$(window).bind('scroll',function(){curContent=anchors.filter(':in-viewport').eq(0).attr('name');prevContent;if(curContent!=undefined&&curContent!=prevContent){as.removeClass('selected').filter('a[href$="#'+curContent+'"]').addClass('selected');;prevContent=curContent;}})}
if($('.details .specsList').length>=1){new DetailSwitcher();}
if($('.comments .commentList').length==1){new CommentExpando($('.commentList'),10);}
if($('.profile .subFooter .recentActivity').length==1){new CommentExpando($('.profile .subFooter .recentActivity ul'),5);}
$('.indent p:first-child').prepend('<span class="indentRule"></span>');initFormLinks();$('.article-the-volvo-ocean-race').addClass('vorParalax');$('.article-the-volvo-ocean-race .textContent h4 a').each(function(){var t=$(this);t.parent().addClass("vorRoute").attr('title',t.attr('href').replace(/[^a-zA-Z0-9_\.]+/g,""));t.after(t.text()).remove();});if($('body').hasClass('vorParalax')){$('body').prepend('<div class="portsMap"><img src="'+MEDIA_URL+'chrome/images/vor/map_middle.png" alt="Port Map"><div id="portsRoutes2" class="portsRoutes"></div><div id="portsRoutes1" class="portsRoutes"></div></div>');vorParalaxBG();}
if($('#boatParts').length>0){$('#boatParts').parent().parent().parent(".row").attr({id:"boatContainer"});$('#boatParts').boat2();$('#boatContainer #prevNext .prev').trigger('click');}}
InitFeedFilters();InitLoadMore();BindTileOverlay();if($('.modal').data("ga")){triggerGAEvents($('.modal').data("ga"));}
$(".shareBar").each(function(){$(this).shareBarInit();});if(typeof gapi!='undefined'){if($(".googlePlusButton").length>0){gapi.plusone.go();}}
$(".contact .phoneNumbers #id_phone_area_code, .contact .phoneNumbers #id_phone_number").keypress(function(event){var charCode=(event.which)?event.which:event.keyCode;if((charCode>31&&charCode<48)||(charCode>57)){return false;}else{return true;}});commentFieldSetup();formPlaceholderSetup();$('a').newWin();forumLinksSetup();collectionLandingLinksSetup();modifyFormForJapanese();});$(window).load(function(){equalizeColumns();})
$.fn.truncateWordAtWidth=function(desiredWd,appendix){if($(this).find("*").length<1&&$(this).text().length&&$(this).text().indexOf(" ")==-1){appendix=typeof appendix=="string"?appendix:"";desiredWd=typeof desiredWd=="number"&&desiredWd>0?desiredWd:$(this).width();var txt=$(this).text();var temp=$(this).clone();$(this).replaceWith(temp);temp.wrapInner("<span/>");var curWd=temp.find("span").width();if(curWd>desiredWd){var len=Math.floor(txt.length*(desiredWd/curWd));temp.find("span").empty().text(txt.substr(0,len)+appendix);while(temp.find("span").width()<desiredWd){len++;temp.find("span").empty().text(txt.substr(0,len)+appendix);}
while(temp.find("span").width()>desiredWd){len--;temp.find("span").empty().text(txt.substr(0,len)+appendix);}
$(this).text(temp.find("span").text());temp.replaceWith($(this));return true;}else{temp.replaceWith($(this));return false;}}else{return false;}};$.fn.truncateBlockAtLine=function(lines,appendix){if($(this).css("display")=="block"&&$(this).html().length&&!$(this).find("*").filter(function(){return $(this).css("display")!="inline";}).length){appendix=typeof appendix=="string"?appendix:"";lines=typeof lines=="number"&&lines>0?lines:1;var fullText=this.text();var temp=this.clone();$(this).replaceWith(temp);var words=fullText.split(" ");var totalWords=words.length;var lineHeight=parseInt(temp.css("line-height"));var initialHeight=temp.height();var truncHeight=lineHeight*lines;var lineRatio=lines/(Math.floor(initialHeight/lineHeight));if(lineRatio<1){var sliceAt=Math.ceil(totalWords*lineRatio);do{var wordsSliced=words.slice(0,sliceAt++);temp.html(closeHtmlTags(wordsSliced.join(" ")+appendix));}while(words.length>=sliceAt&&Math.floor(temp.height()/parseInt(lineHeight))<=lines);do{var wordsSliced=words.slice(0,sliceAt--);temp.html(closeHtmlTags(wordsSliced.join(" ")+appendix));}while(sliceAt>1&&Math.floor(temp.height()/parseInt(lineHeight))>lines);$(this).empty().html(closeHtmlTags(temp.html()));temp.replaceWith(this);return true;}else{temp.replaceWith(this);return false;}}else{return false;}};$.fn.truncateBlockAtHeight=function(desiredHt,appendix){if($(this).css("display")=="block"&&$(this).html().length){appendix=typeof appendix=="string"?appendix:"";desiredHt=typeof desiredHt=="number"&&desiredHt>0?desiredHt:$(this).height();var fullHtml=this.html().replace(/<(?!meta\b)([\/]?)([a-z]+)([^>]*)?>/g," <$1$2$3> ").replace(/(\r\n|\n|\r)/gm," ");var temp=this.clone();temp.wrapInner("<div/>");$(this).replaceWith(temp);var words=fullHtml.split(" ");var totalWords=words.length;var curHt=temp.children("div").eq(0).height();if(desiredHt<curHt){var tempDiv=temp.children("div").eq(0);var sliceAt=Math.ceil(totalWords*(desiredHt/curHt));do{var wordsSliced=words.slice(0,sliceAt++);tempDiv.html(closeHtmlTags(wordsSliced.join(" ")+appendix));}while(tempDiv.height()<=desiredHt);do{var wordsSliced=words.slice(0,sliceAt--);tempDiv.html(closeHtmlTags(wordsSliced.join(" ")+appendix));}while(tempDiv.height()>desiredHt);$(this).empty().html(closeHtmlTags(tempDiv.html()));temp.replaceWith(this);return true;}else{temp.replaceWith(this);return false;}}else{return false;}};$.fn.truncateBlockAtChar=function(charLimit,appendix){if($(this).css("display")=="block"&&$(this).html().length){appendix=typeof appendix=="string"?appendix:"";var fullHtml=this.html().replace(/<(?!meta\b)([\/]?)([a-z]+)([^>]*)?>/g," <$1$2$3> ").replace(/(\r\n|\n|\r)/gm," ");var charCount=fullHtml.length;var temp=this.clone();temp.wrapInner("<div/>");$(this).replaceWith(temp);if(charLimit<charCount){var tempDiv=temp.children("div").eq(0);$(this).empty().html(closeHtmlTags(tempDiv.html().substring(0,charLimit)+appendix));temp.replaceWith(this);return true;}else{temp.replaceWith(this);return false;}}else{return false;}};function closeHtmlTags(html){var tagRgx=new RegExp("<(?!meta|img|br|hr|input\b)([/]?)([a-z]+)([^>]*)?>","i"),openTags=[],strPieces=[],workStr=html,tagMatch,lastTag;while(tagMatch=tagRgx.exec(workStr)){strPieces.push(workStr.substr(0,tagMatch.index));workStr=workStr.substr(tagMatch.index+tagMatch[0].length);if(tagMatch[1]!="/"){openTags.push(tagMatch[2]);strPieces.push(tagMatch[0]);}else{while(openTags.length>0){t=openTags.length-1;lastTag=openTags.pop();strPieces.push("</"+lastTag+">");if(lastTag==tagMatch[2]){break;}}}}
strPieces.push(workStr);return strPieces.join("");}
$.fn.extend({buildOverlayGeneric:function(opts){$('.overlay').remove();var controller=$(this).buildOverlay(opts);return controller;},buildOverlayContact:function(){$('.overlay').remove();var controller=$(this).buildOverlay({width:"900"});return controller;},buildOverlay:function(opts){var defaults={width:693},options=$.extend(defaults,opts);$(this).detach();var $thisID=$(this).attr("id"),isSideraleWidget=$thisID=="sidereal-widget"?true:false,controller=new OverlayWindow($(this),$thisID,$thisID,{width:options.width}),closeBtnImg=isSideraleWidget?"chrome/images/overlay_close_btn_black.png":"chrome/images/overlay_close_btn.png";$("<img/>",{"class":"button closeButton","src":MEDIA_URL+closeBtnImg,"alt":"Close","click":function(e){e.preventDefault();controller.close();}}).prependTo(controller.$elmts.popover);controller.$elmts.contents.find('.closeForm, .closeModal').bind('click',function(e){e.preventDefault();controller.close();});return controller;}});var formatSideraleForm=function(sForm){var $form=$(sForm);$form.find('h2').text(string_CONTACT_SIDERALE);$form.find('#id_subject_area').append('<option value="siderale" selected="true">'+string_SIDERALE+'</option>').hide();setTimeout(function(){$form.find('#selectsubject_area').replaceWith('<span style="display:inline-block;padding:15px 0 7px">'+string_SIDERALE+'</span>');},50);$form.find('li').eq(1).hide();}
function OverlayWindow(jqContents,id,hash,options){var surrogate=this;this.customFormTimeout=undefined;var defaults={fadeDur:180,preloadContents:true,width:"auto",height:"auto"};$.extend(true,this,defaults,options);this.scrollable=false;this.$elmts={};this.$elmts.overlay=$("<div/>",{"class":"overlay"}).css({"display":"none","position":"fixed","top":0,"left":0,"height":$('body').height(),"width":"100%","zIndex":500}).appendTo("body").data("controller",this);this.$elmts.popover=$("<div/>",{"class":"popover"}).css({"display":"block","position":"relative","width":this.width,"height":this.height,"margin":"0 auto"});if(this.width)this.$elmts.popover.width(this.width);if(this.height)this.$elmts.popover.height(this.height);this.$elmts.spinner=$("<span/>",{"class":"spinner","text":string_LOADING});this.$elmts.contents=$(jqContents).appendTo(this.$elmts.popover).css({"display":"block"});if(this.$elmts.popover.find(".modal.contact").length>0&&this.width<945){this.$elmts.popover.width(945);}
if(this.$elmts.popover.find("#sidereal-widget").length>0){this.$elmts.popover.css({"min-width":"856px","width":"90%"});}}
OverlayWindow.prototype.open=function(){var surrogate=this;var images=[];$("img",this.$elmts.contents).each(function(){images.push($(this).attr("src"));});if(this.preloadContents&&jQuery.loadImages&&images.length){this.$elmts.spinner.appendTo(this.$elmts.overlay);this.$elmts.overlay.fadeIn(this.fadeDur);$.loadImages(images,function(){surrogate.$elmts.spinner.detach();if(surrogate.fadeDur){surrogate.$elmts.popover.appendTo(surrogate.$elmts.overlay).hide().fadeIn(surrogate.fadeDur);}else{surrogate.$elmts.popover.appendTo(surrogate.$elmts.overlay);}
surrogate.updatePosition();});}else{this.$elmts.popover.appendTo(this.$elmts.overlay);this.$elmts.overlay.fadeIn(this.fadeDur);surrogate.updatePosition();}
$(window).bind("resize.popover",function(){surrogate.updatePosition();});if(this.customFormTimeout!=undefined){clearTimeout(this.customFormTimeout);}
if(Custom.init){this.customFormTimeout=setTimeout(function(){Custom.init();},750);}}
OverlayWindow.prototype.close=function(){var surrogate=this;if(this.fadeDur){this.$elmts.overlay.fadeOut(this.fadeDur,function(){surrogate.$elmts.spinner.detach();surrogate.$elmts.popover.detach();});}else{this.$elmts.spinner.detach();this.$elmts.popover.detach();$(window).unbind("resize.popover");}}
OverlayWindow.prototype.updatePosition=function(){var surrogate=this;var htDiff=$(window).height()-this.$elmts.popover.height();if(htDiff>0){if(this.scrollable){this.scrollable=false;$(window).unbind("scroll.popover");}
this.$elmts.popover.css({"top":htDiff/2});}else{if(!this.scrollable){this.scrollable=true;this.overlayTop=this.$elmts.overlay.offset().top;$(window).bind("scroll.popover",function(){var topDiff=surrogate.overlayTop-surrogate.$elmts.overlay.offset().top;surrogate.overlayTop=surrogate.$elmts.overlay.offset().top;surrogate._scroll(topDiff);});}}}
OverlayWindow.prototype._scroll=function(delta){var diff=$(window).height()-this.$elmts.popover.outerHeight();var newTop=this.$elmts.popover.position().top+delta;if(newTop>0){newTop=0;}else if(newTop<diff){newTop=diff;}
this.$elmts.popover.css({"top":newTop});}
OverlayWindow.prototype.hashCheck=function(){var surrogate=this;var nowHash=window.location.hash.substr(1);if(this.hash==nowHash){this.open();}}
var IwcNav2=function(opts){var surrogate=this;this.defaults={navRef:null,dur:400,easingMethod:GLOBAL_EASING};this.nav=$('#pageHeader').find('.nav');this.dds=this.nav.find('.dd');this.ddLs=this.dds.parent();this.currentMenu=null;this.drawer=$('<div id="ddDrawer"></div>');this.indicatorTrack=$('<div class="indicatorTrack"></div>');this.indicator=$('<div class="indicator"></div>');this.options=$.extend(this.defaults,opts);this.nav=$('#pageHeader').find('.nav');this.searchForm=this.nav.find('li.navSearch');this.searchField=this.searchForm.find('input.text');this.optTrigger=this.searchForm.find('.optionTrigger');this.searchDD=this.searchForm.find('.searchOptions');this.optsList=this.searchDD.find('ul');this.isDrawerDown=false;this.indicatorTrack.append(this.indicator);this.drawer.append(this.indicatorTrack).insertAfter(this.nav);var ddOver=function(elem){surrogate.currentMenu=elem;var $elem=$(elem);var theDD=$elem.children('.dd');var theA=$elem.children('a:first-child');var drawerMode=surrogate.isDrawerDown==true?'fade':'slide';if(!opacitySupport){drawerMode='ie';}
surrogate.showDropDown(theDD,{mode:drawerMode});var theHeight=theDD.children().outerHeight();var targX=theA.outerWidth()/2+$elem.position().left+4;surrogate.showDrawer(theHeight,targX);};this.ddLs.addClass('ddLink');var childLinks=this.ddLs.children('a');var hoverConfigTopNav={interval:80,timeout:300,over:function(){var ddL=this.parentNode;var previousDDL=surrogate.currentMenu;if(iwcL10n.drawerIsDown||previousDDL&&(ddL!=previousDDL)){surrogate.hideDropDown();iwcL10n.hide();ddOver(ddL);}},out:function(){}};childLinks.hoverIntent(hoverConfigTopNav);childLinks.click(function(event){event.preventDefault();var ddL=this.parentNode;var previousDDL=surrogate.currentMenu;if(surrogate.currentMenu){surrogate.hideDropDown();}
if(ddL!=previousDDL){iwcL10n.hide();ddOver(ddL);}
else{surrogate.hideDrawer();}});this.dds.each(function(){var t=$(this);if(t.hasClass('collection')){t.children().wrapAll('<div class="inner"/>');}
t.css({visibility:'visible'}).children().css({marginTop:-t.height()});if(t.hasClass('userInfo')){t.css({left:-t.parent().position().left,top:t.parent().position().top+t.parent().height()});}});var hoverConfigSearch={interval:100,timeout:400,over:function(){surrogate.searchOver()},out:function(){surrogate.searchOut()}}
this.searchForm.hoverIntent(hoverConfigSearch);this.searchField.width(0);this.optsList.show().css({marginTop:-(this.optsList.height()+22)}).delegate('a','click',function(e){surrogate.searchOptionsClick(e);return false;}).hide();this.optTrigger.css({right:5}).bind('click',function(){$(this).addClass('active');surrogate.optsList.show().animate({marginTop:0},{duration:surrogate.options.dur,easing:surrogate.options.easingMethod});return false;});}
IwcNav2.prototype.showDropDown=function(dd,opts){if(dd.find('.spinner').length){$.get(url_PROFILE_INFO_AJAX,{},function(result){dd.find('.spinner').remove();dd.find('ul').append(result);});}
var surrogate=this;var defaults={mode:'slide'};var opts=$.extend(defaults,opts);var theCont=dd.children();if(opts.mode=='fade'){this.dds.children().not(theCont).each(function(){var t=$(this);t.fadeTo(surrogate.options.dur/3,0,function(){t.hide()});});theCont.hide().delay(surrogate.options.dur).css({marginTop:0}).fadeTo(surrogate.options.dur/2,1).addClass('active');}else if(opts.mode=="ie"){this.dds.children().not(theCont).each(function(){var t=$(this);t.animate({marginTop:-t.outerHeight()},{duration:surrogate.options.dur,easing:surrogate.options.easingMethod,complete:function(){t.hide()}});});theCont.show().css({marginTop:-theCont.outerHeight()}).animate({marginTop:0},{duration:surrogate.options.dur,easing:surrogate.options.easingMethod}).addClass('active');}else{theCont.show().fadeTo(0,1).css({marginTop:-theCont.outerHeight()}).animate({marginTop:0},{duration:surrogate.options.dur,easing:surrogate.options.easingMethod}).addClass('active');}
if(opts.mode!="ie"){dd.siblings('a').animate({backgroundPosition:'50% 50px'},{duration:surrogate.options.dur/2,easing:surrogate.options.easingMethod});}}
IwcNav2.prototype.hideDropDown=function(){var surrogate=this;var dd=$(surrogate.currentMenu).children('.dd');surrogate.currentMenu=null;if(opacitySupport){dd.siblings('a').stop().delay(surrogate.options.dur/2).animate({backgroundPosition:'50% 36px'},{duration:surrogate.options.dur/2,easing:surrogate.options.easingMethod});}}
IwcNav2.prototype.showDrawer=function(ht,indicatorX){var surrogate=this;if(!this.isDrawerDown){this.indicator.css({top:-10,left:indicatorX});}
this.indicator.animate({top:0,left:indicatorX},{duration:surrogate.options.dur/1.5,easing:surrogate.options.easingMethod});this.drawer.stop().css({'border-bottom':'1px solid #D7D7D7'}).animate({height:ht},{duration:surrogate.options.dur,easing:surrogate.options.easingMethod,complete:function(){surrogate.isDrawerDown=true;}});}
IwcNav2.prototype.hideDrawer=function(){var surrogate=this;this.indicator.stop().animate({top:-10},{duration:surrogate.options.dur/1.5,easing:surrogate.options.easingMethod});this.drawer.stop().animate({height:0},{duration:surrogate.options.dur,easing:surrogate.options.easingMethod,complete:function(){surrogate.isDrawerDown=false;}}).css({'border-bottom':'0'});this.dds.children().each(function(){$(this).animate({marginTop:-$(this).outerHeight()},{duration:surrogate.options.dur,easing:surrogate.options.easingMethod,queue:false});});}
IwcNav2.prototype.searchOver=function(){this.searchField.animate({width:140},{duration:this.options.dur,easing:this.options.easingMethod}).focus();this.optTrigger.animate({right:175},{duration:this.options.dur,easing:this.options.easingMethod});}
IwcNav2.prototype.searchOut=function(){var surrogate=this;this.optsList.animate({marginTop:-(surrogate.optsList.height()+22)},{duration:surrogate.options.dur,easing:surrogate.options.easingMethod,complete:function(){surrogate.searchField.animate({width:0},{duration:surrogate.options.dur,easing:surrogate.options.easingMethod}).blur();surrogate.optTrigger.animate({right:0},{duration:surrogate.options.dur,easing:surrogate.options.easingMethod}).removeClass('active');surrogate.optsList.hide();}});}
IwcNav2.prototype.searchOptionsClick=function(e){var t=$(e.target);t.addClass('selected').parent().siblings().find('a').removeClass('selected');$('#id_filter').val(t.attr('href').substring(1));if(this.searchField.val()!=''){this.searchForm.find('form').find('.submit').click();}}
var setupL10n=function(){var surrogate=this;var link=$('li#l10n > a');surrogate.dd=link.next();surrogate.dd.show();surrogate.ht=surrogate.dd.outerHeight();surrogate.dd.hide().css({'marginTop':-surrogate.ht}).show();surrogate.drawerIsDown=false;var hoverConfigL10n={interval:100,timeout:400,over:function(){if(iwcNav.currentMenu){surrogate.show();}},out:function(){}};link.hoverIntent(hoverConfigL10n);link.click(function(event){event.preventDefault();if(surrogate.dd.css('marginTop')=='0px'){surrogate.hide();}
else{surrogate.show();}});};setupL10n.prototype.show=function(){this.dd.stop().animate({'marginTop':0},300);iwcNav.hideDropDown();iwcNav.hideDrawer();iwcL10n.drawerIsDown=true;};setupL10n.prototype.hide=function(){this.dd.stop().animate({'marginTop':-this.ht},300);iwcL10n.drawerIsDown=false;};var iwcNav;var iwcL10n;$(document).ready(function(){iwcNav=new IwcNav2();iwcL10n=new setupL10n();});$(document).ready(function(){$('body').click(function(event){var $target=$(event.target);if($target.attr('id')!='topNav'&&$target.parents('#topNav').length==0&&$target.attr('id')!='ddDrawer'&&$target.parents('#ddDrawer').length==0){iwcNav.hideDropDown();iwcNav.hideDrawer();iwcL10n.hide();}});});function WatchDetail(data){var surrogate=this;var properties={variations:data,currentVariation:0,currentZoomLevel:1,frontBack:"front",isOpen:false,menuScrollable:false,instructionsShown:false}
$.extend(this,properties);this.$elmts={};this.$elmts.watchDetail=$("<div/>",{"class":"watchDetail"}).css({"position":"fixed","top":0,"left":0,"zIndex":500,"opacity":0}).width($(window).width()-20).height($(window).height()-20);this.$elmts.window=$("<div/>",{"class":"window"}).css({"position":"absolute","top":0,"left":0,"width":"100%","height":"100%"}).appendTo(this.$elmts.watchDetail);this.$elmts.imageContainer=$("<div/>",{"class":"imageContainer"}).css({"position":"absolute","top":0,"left":0,"width":"100%","height":"100%"}).appendTo(this.$elmts.window);this.$elmts.spinner=$("<div/>",{"class":"spinner"}).css({"display":"none","position":"absolute","top":"50%","left":"50%"}).append($("<span/>")).appendTo(this.$elmts.window);this.$elmts.instructions=$("<div/>",{"class":"instructions","click":function(){if(!surrogate.instructionsShown){$(this).fadeOut(500,function(){$(this).detach();surrogate.instructionsShown=true;});}}}).css({"display":"none","position":"absolute","top":0,"left":0,"width":"100%","height":"100%"}).append($('<div/>').css({"position":"relative","top":"50%","left":"50%"}).append($("<h4/>",{"text":string_IMAGE_VIEWER})).append($("<h2/>",{"html":string_CLICK_DRAG_EXPLORE})).append($("<h3/>",{"html":string_VIEWER_INSTRUCTIONS})));this.$elmts.image=null;this._buildMenuElmts();var hashObj=this._hashCheck();if(hashObj!==false&&!this.variations[hashObj.variation].isStarChart){this.setVariation(hashObj.variation);this.setFrontBack(hashObj.frontBack);this.setZoomLevel(hashObj.zoomLevel);this.open();}};WatchDetail.prototype.open=function(){if(!this.isOpen){var surrogate=this;this.isOpen=true;var thumbUrls=[];for(var t=0;t<this.variations.length;t++){thumbUrls.push(this.variations[t].thumbnail);}
$.loadImages(thumbUrls,function(){$("html").css({width:"100%",height:"100%",overflow:"hidden"});surrogate.$elmts.watchDetail.appendTo("body");$(window).bind("resize.watchDetail",function(){surrogate._updateWindow();});surrogate._updateWindow();if(!surrogate.instructionsShown){surrogate.$elmts.instructions.insertBefore(surrogate.$elmts._menu.container).show();}
surrogate.$elmts.watchDetail.fadeTo(300,1,function(){if(!surrogate.instructionsShown){setTimeout(function(){if(!surrogate.instructionsShown){surrogate.$elmts.instructions.fadeOut(500,function(){$(this).detach();surrogate.instructionsShown=true;});}},5000);}});surrogate._selectImage(surrogate.currentVariation,surrogate.frontBack,surrogate.currentZoomLevel);surrogate.$elmts.imageContainer.bind("mousedown touchstart",function(e){e.preventDefault();surrogate.$elmts.image.stop();var restTimeout,oldX,oldY,evX,evY,deltaX,deltaY,updateCounter=0;var imageWd=surrogate.$elmts.image.width(),imageHt=surrogate.$elmts.image.height(),windowWd=$(window).width(),windowHt=$(window).height();var lowerLimitX=windowWd-imageWd,lowerLimitY=windowHt-imageHt;updateEventCoords(e);$(this).bind({"mousemove touchmove":function(e){e.preventDefault();clearTimeout(restTimeout);updateEventCoords(e);var pos=surrogate.$elmts.image.position();if(imageWd>windowWd){var newLeft=pos.left+deltaX;if(newLeft>0){newLeft=0;}else if(newLeft<lowerLimitX){newLeft=lowerLimitX;}}else{newLeft=(windowWd-imageWd)/2;}
if(imageHt>windowHt){var newTop=pos.top+deltaY;if(newTop>0){newTop=0;}else if(newTop<lowerLimitY){newTop=lowerLimitY;}}else{newTop=(windowHt-imageHt)/2;}
surrogate.$elmts.image.css({left:newLeft,top:newTop});restTimeout=setTimeout(function(){updateEventCoords(e);},100);},"mouseup touchend":function(e){e.preventDefault();if(updateCounter>2){var n,distance,pos,newLeft,newTop;n=8;distance=n*Math.sqrt(((oldX-evX)*(oldX-evX))
+
((oldY-evY)*(oldY-evY)));pos=surrogate.$elmts.image.position();if(imageWd>windowWd){newLeft=pos.left+(deltaX*n);if(newLeft>0){newLeft=0;}else if(newLeft<lowerLimitX){newLeft=lowerLimitX;}}else{newLeft=(windowWd-imageWd)/2;}
if(imageHt>windowHt){newTop=pos.top+(deltaY*n);if(newTop>0){newTop=0;}else if(newTop<lowerLimitY){newTop=lowerLimitY;}}else{newTop=(windowHt-imageHt)/2;}
if(imageWd<=windowWd&&imageHt<=windowHt){surrogate.$elmts.image.removeClass("movable");}else{surrogate.$elmts.image.addClass("movable");}
surrogate.$elmts.image.animate({"left":newLeft,"top":newTop},Math.round(distance*.8),"easeOutQuad");}
$(this).unbind("mousemove mouseup touchmove touchend");},"mouseout":function(){e.preventDefault();surrogate.$elmts.imageContainer.trigger("mouseup");}});function updateEventCoords(evt){oldX=typeof evX=="number"?evX:0;oldY=typeof evY=="number"?evY:0;if(evt.pageX){evX=evt.pageX;evY=evt.pageY;}else{evX=oldX;evY=oldX;}
deltaX=evX-oldX;deltaY=evY-oldY;updateCounter++;}});},false);$(document).bind("keyup.watchDetail",function(e){if((typeof e.keyCode=="number"?e.keyCode:e.which)==G_KEYCODES.esc){surrogate.close();}});}
return this;};WatchDetail.prototype.close=function(){if(this.isOpen){var surrogate=this;this.$elmts.imageContainer.unbind("mousedown mousemove mouseup mouseout");$(document).unbind("keyup.watchDetail");var top=this.$elmts.window.offset().top;window.location.hash="";if($.scrollTo){$.scrollTo(top);}
this.$elmts.watchDetail.fadeTo(300,0,function(){surrogate.$elmts.instructions.detach();surrogate.$elmts.watchDetail.detach();$("html").css({width:"auto",height:"auto",overflow:"auto"});$(window).unbind("resize.watchDetail");surrogate.isOpen=false;});}
return this;};WatchDetail.prototype.setVariation=function(index){var newVariation,prevVariation=this.currentVariation;if(typeof index=="number"){if(index<0){newVariation=0;}else if(index>this.variations.length){newVariation=this.variations.length-1;}else{newVariation=index;}}else{newVariation=0;}
if(this.variations.length>1){this.$elmts._menu._thumbnails[prevVariation].removeClass("selected");this.$elmts._menu._thumbnails[newVariation].addClass("selected");}
this.currentVariation=newVariation;return this;};WatchDetail.prototype.setFrontBack=function(state){this.frontBack=(state=="back")?"back":"front";if(!this.variations[this.currentVariation].backs.length){this.frontBack="front";this.$elmts._menu._buttons.view.addClass("disabled");}else{this.$elmts._menu._buttons.view.removeClass("disabled");}
if(this.variations[this.currentVariation].isStarChart){this.$elmts._menu._buttons.view.find("span.detailMenuLabel").text(this.frontBack=="back"?string_VIEW_NORTH:string_VIEW_SOUTH);}
else{this.$elmts._menu._buttons.view.find("span.detailMenuLabel").text(this.frontBack=="back"?string_VIEW_FRONT:string_VIEW_BACK);}
return this;};WatchDetail.prototype.setZoomLevel=function(z){if(typeof z=="number"){if(z<=0){this.currentZoomLevel=0;}else if(z>=this.variations[this.currentVariation][this.frontBack+"s"].length-1){this.currentZoomLevel=this.variations[this.currentVariation][this.frontBack+"s"].length-1;}else{this.currentZoomLevel=z;}}
if(this.currentZoomLevel<=0){this.$elmts._menu._buttons.zoomIn.addClass("disabled");}else{this.$elmts._menu._buttons.zoomIn.removeClass("disabled");}
if(this.currentZoomLevel>=this.variations[this.currentVariation][this.frontBack+"s"].length-1){this.$elmts._menu._buttons.zoomOut.addClass("disabled");}else{this.$elmts._menu._buttons.zoomOut.removeClass("disabled");}
return this;};WatchDetail.prototype._selectImage=function(index,state,zoom){var surrogate=this;this.setVariation(index).setFrontBack(state).setZoomLevel(zoom);this.$elmts.imageContainer.empty();this.$elmts.spinner.clearQueue().hide().fadeIn(500);var imgSrc=surrogate.variations[surrogate.currentVariation][surrogate.frontBack+"s"][surrogate.currentZoomLevel];$.loadImages(imgSrc,function(){surrogate.$elmts.image=$("<img/>",{"class":"largeImage","src":imgSrc,"alt":""}).appendTo(surrogate.$elmts.imageContainer.empty());var span=$("<span/>",{"class":"largeImage"}).css({backgroundImage:"url('"+imgSrc+"')",left:(($(window).width()-surrogate.$elmts.image.width())/2),top:(($(window).height()-surrogate.$elmts.image.height())/2)}).width(surrogate.$elmts.image.width()).height(surrogate.$elmts.image.height());surrogate.$elmts.image.replaceWith(span);surrogate.$elmts.image=span;surrogate.$elmts.spinner.show().delay(250).fadeOut(500);window.location.hash=surrogate.getCurrentHash();});};WatchDetail.prototype._updateWindow=function(){var surrogate=this;this.$elmts.watchDetail.width($(window).width()-20).height($(window).height()-20);this.$elmts.imageContainer.trigger("mousedown").trigger("mouseup");var htDiff=this.$elmts.window.height()-this.$elmts._menu.container.height();if(htDiff>0){if(this.menuScrollable){this.menuScrollable=false;}
this.$elmts._menu.container.css({"top":htDiff/2});}else{if(!this.menuScrollable){this.menuScrollable=true;this.$elmts._menu.container.css({"top":0});}}};WatchDetail.prototype._menuScroll=function(delta){};WatchDetail.prototype._buildMenuElmts=function(){var surrogate=this;this.$elmts._menu={};this.$elmts._menu.container=$("<div/>",{"class":"detailMenu hidden"}).css({"right":-202}).hoverIntent({over:function(){$(this).animate({"right":0},{duration:200,easing:"easeOutQuad",complete:function(){$(this).removeClass("hidden");}});},out:function(){$(this).animate({"right":-202},{duration:200,easing:"easeOutQuad",complete:function(){$(this).addClass("hidden");}});},timeout:750}).appendTo(this.$elmts.window);this.$elmts._menu.panel1=$("<div/>",{"class":"detailMenuPanel"}).appendTo(this.$elmts._menu.container);this.$elmts._menu.panel2=$("<div/>",{"class":"detailMenuPanel"}).appendTo(this.$elmts._menu.container);this.$elmts._menu._buttons={};this.$elmts._menu._buttons.close=$("<div/>",{"class":"detailMenuButton detailButtonClose","click":function(){surrogate.close();}}).append($("<span/>",{"class":"icon"})).append($("<span/>",{"class":"detailMenuLabel","html":string_CLOSE_RETURN})).appendTo(this.$elmts._menu.panel1);this.$elmts._menu._buttons.zoomIn=$("<div/>",{"class":"detailMenuButton detailButtonZoomIn","click":function(){if(!$(this).hasClass("disabled")){surrogate._selectImage(surrogate.currentVariation,surrogate.frontBack,surrogate.currentZoomLevel-1);}}}).append($("<span/>",{"class":"icon"})).append($("<span/>",{"class":"detailMenuLabel","text":string_ZOOM_IN})).appendTo(this.$elmts._menu.panel1);this.$elmts._menu._buttons.zoomOut=$("<div/>",{"class":"detailMenuButton detailButtonZoomOut","click":function(){if(!$(this).hasClass("disabled")){surrogate._selectImage(surrogate.currentVariation,surrogate.frontBack,surrogate.currentZoomLevel+1);}}}).append($("<span/>",{"class":"icon"})).append($("<span/>",{"class":"detailMenuLabel","text":string_ZOOM_OUT})).appendTo(this.$elmts._menu.panel1);this.$elmts._menu._buttons.view=$("<div/>",{"class":"detailMenuButton detailButtonView","click":function(){if(!$(this).hasClass("disabled")){surrogate._selectImage(surrogate.currentVariation,surrogate.frontBack=="back"?"front":"back",surrogate.currentZoomLevel);}}}).append($("<span/>",{"class":"icon"})).append($("<span/>",{"class":"detailMenuLabel","text":"View Watch Back"})).appendTo(this.$elmts._menu.panel1);this.$elmts._menu._buttons.share=$("<div/>",{"class":"detailMenuButton detailButtonShare"}).append($("<span/>",{"class":"icon"})).append($("<span/>",{"class":"detailMenuLabel shareBar","text":string_SHARE+":"}).append($("<a/>",{"class":"twitter","href":"http://twitter.com/share?url="+(window.location.toString())+"&amp;text="+$("title").text()}).append($("<span/>",{"class":"icon"}))).append($("<a/>",{"class":"facebook","href":"#facebook"}).append($("<span/>",{"class":"icon"}))).append($("<a/>",{"class":"email","href":"#email"}).append($("<span/>",{"class":"icon"}))).append($("<div>",{"class":"fbLinks"}).append($("<ul/>").append($("<li/>",{"class":"fb_like","html":'<iframe src="http://www.facebook.com/plugins/like.php?href='+window.location.toString()+'&amp;layout=button_count&amp;show_faces=false&amp;width=50&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:50px; height:21px;" allowTransparency="true"></iframe>'})).append($("<li/>",{"class":"fb_share"}).append($("<a/>",{"name":"fb_share","type":"button","href":"http://www.facebook.com/sharer.php?u="+window.location.toString(),"html":"<span class='FBConnectButton FBConnectButton_Small' style='cursor:pointer;'><span class='FBConnectButton_Text'>Share</span></span>"}).attr("share_url",window.location.toString())))))).appendTo(this.$elmts._menu.panel2).shareBarInit();if(!surrogate.variations[surrogate.currentVariation].isStarChart){this.$elmts._menu._buttons.download=$("<div/>",{"class":"detailMenuButton detailButtonDownload","click":function(){window.open(surrogate.variations[surrogate.currentVariation][surrogate.frontBack+"s"][0])}}).append($("<span/>",{"class":"icon"})).append($("<span/>",{"class":"detailMenuLabel","text":string_DOWNLOAD_HI_RES})).appendTo(this.$elmts._menu.panel2);}
$(".detailMenuButton",this.$elmts._menu.container).bind("click",function(){surrogate.$elmts._menu.container.stop(true);});if(this.variations.length>1){this.$elmts._menu.panel3=$("<div/>",{"class":"detailMenuPanel detailMenuThumbnailPanel"}).append($("<span/>",{"class":"icon"})).appendTo(this.$elmts._menu.container);this.$elmts._menu.thumbnailContainer=$("<ul/>",{"class":"detailMenuThumbnails"}).appendTo(this.$elmts._menu.panel3);this.$elmts._menu._thumbnails=[];for(var z=0;z<this.variations.length;z++){this.$elmts._menu._thumbnails.push($("<li/>",{"class":"detailMenuThumbnail","click":function(){if(!$(this).hasClass("selected")){var myIndex=surrogate.$elmts._menu.panel3.find("li").index($(this));surrogate._selectImage(myIndex,"front",surrogate.currentZoomLevel);}}}).prepend($("<img/>",{"src":this.variations[z].thumbnail,"alt":this.variations[z].title})).appendTo(this.$elmts._menu.thumbnailContainer));}}};WatchDetail.prototype._hashCheck=function(){var hash=window.location.hash.substr(1).split("/");if(hash[0]=="enlarge"){var returnObj={};for(var p=1;p<hash.length;p++){if(hash[1].split("-").length>1&&hash[p].split("-")[0]=="variation"){returnObj.variation=parseInt(hash[p].split("-")[1])-1;}else if(hash[1].split("-").length>1&&hash[p].split("-")[0]=="zoom"){returnObj.zoomLevel=parseInt(hash[p].split("-")[1])-1;}else if(hash[p]=="front"||hash[p]=="back"){returnObj.frontBack=hash[p];}}
returnObj.variation=typeof returnObj.variation=="number"?returnObj.variation:0;returnObj.zoomLevel=typeof returnObj.zoomLevel=="number"?returnObj.zoomLevel:0;returnObj.frontBack=(returnObj.frontBack=="front"||returnObj.frontBack=="back")?returnObj.frontBack:"front";return returnObj;}else{return false;}};WatchDetail.prototype.getCurrentHash=function(){if(this.variations[this.currentVariation].isStarChart){ret="#enlargeStarChart";}
else{ret="#enlarge/variation-"+(this.currentVariation+1)+"/"+this.frontBack+"/zoom-"+(this.currentZoomLevel+1);}
return ret;}
$.fn.extend({buildWatchDetail:function($enlargeButtons){var surrogate=this;var variationsData=[];$(this).eq(0).find(".variation").each(function(){variationsData.push({thumbnail:$("img.thumbnail",this).attr("src"),fronts:$("a",this).data("front")?$("a",this).data("front").split(","):[],backs:$("a",this).data("back")?$("a",this).data("back").split(","):[],title:$("a",this).attr("title")!=""?$("a",this).attr("title"):false});});if(variationsData.length){var watchDetailObj=new WatchDetail(variationsData);$(this).eq(0).data("watchDetail",watchDetailObj);$(this).eq(0).find("li").each(function(index){$(this).bind("click",function(e){e.preventDefault();watchDetailObj.setVariation(index);$enlargeButtons.filter("a").attr("href",watchDetailObj.getCurrentHash());});});$enlargeButtons.bind("click",function(event){event.preventDefault();watchDetailObj.open();});return watchDetailObj;}else{return false;}}});var G_KEYCODES={backspace:8,tab:9,enter:13,"shift":16,ctrl:17,alt:18,capsLock:20,esc:27,pageUp:33,pageDown:34,end:35,"home":36,left:37,up:38,right:39,down:40,insert:45,"delete":46,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindows:91,rightWindows:92,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145,semicolon:186,equalSign:187,comma:188,dash:189,period:190,slash:191,grave:192,bracketOpen:219,backslash:220,bracketClose:221,singleQuote:222};$(function(){$("#interventions").each(function(){$(this).setupInterventions();});});$.fn.extend({setupInterventions:function(){var surrogate=this;$("<ul/>",{"class":"interventionTabs"}).appendTo($(this).find(".header"));$(this).find(".intervention").each(function(){var tab=$("<li/>",{"class":"interventionTab"}).html($(this).find(".title").html()).data("myContent",$(this));tab.appendTo($(surrogate).find(".interventionTabs"))
$(this).data("myTab",tab);$(this).find(".title").remove();$(this).data("InterventionSteps",(new InterventionSteps($(this).find(".steps"))));$(this).data("myTab").bind("click",function(){if(!$(this).hasClass("selected")){$(surrogate).find(".interventionTab.selected").removeClass("selected");$(this).addClass("selected");$(surrogate).find(".intervention:not(.hidden)").addClass("hidden");$(this).data("myContent").removeClass("hidden");$(surrogate).find(".interventionTabs .indicator").animate({left:(($(this).outerWidth()-$(surrogate).find(".interventionTabs .indicator").width())/2)+$(this).position().left},500,GLOBAL_EASING);}});});$(this).find(".intervention:gt(0)").addClass("hidden");$(this).find(".interventionTab:eq(0)").addClass("selected");var indicator=$("<div/>",{"class":"indicator"}).appendTo($(this).find(".interventionTabs"));var indicatorWd=$(this).find(".indicator").width();var tabWd=$(this).find(".interventionTab:not(.hidden)").outerWidth();var tabLeft=$(this).find(".interventionTab.selected").position().left;indicator.css({left:((tabWd-indicatorWd)/2)+tabLeft});}});var InterventionSteps=function($steps){var surrogate=this;$steps=$steps.eq(0);this.currentStep=0;this.isAnimating=false;this.$elmts={};this.$elmts.container=$steps;this.$elmts._steps=$steps.find(".step");this.$elmts.tray=$steps.wrapInner($("<div/>",{"class":"stepsTray"}).width($steps.find(".step").length*$steps.find(".step").eq(1).outerWidth())).find(".stepsTray");this.$elmts.window=$steps.wrapInner($("<div/>",{"class":"stepsWindow"})).find(".stepsWindow");this.$elmts._nav={};this.$elmts._nav.container=$("<ol/>",{"class":"stepsNav"}).width(this.$elmts._steps.length*28).appendTo(this.$elmts.container);var largestHt=0;var paddingDif=this.$elmts._steps.eq(0).outerHeight(false)-this.$elmts._steps.eq(0).height();for(var s=0;s<this.$elmts._steps.length;s++){$("<h5/>",{"class":"number","text":(s+1).toStringOfLength(2)}).insertAfter(this.$elmts._steps.eq(s).find("img"));$("<li/>",{"text":(s+1).toStringOfLength(2),"click":function(){surrogate.turnToStep($(this).data("myIndex"));}}).data("myIndex",s).appendTo(this.$elmts._nav.container);var thisHt=this.$elmts._steps.eq(s).height();largestHt=thisHt>largestHt?thisHt:largestHt;}
this.$elmts._steps.height(largestHt);this.$elmts.window.height(largestHt+paddingDif);this.$elmts._nav._numbers=this.$elmts._nav.container.find("li");this.$elmts._nav.indicator=$("<div/>",{"class":"indicator"}).appendTo(this.$elmts._nav.container);this.$elmts._nav.buttons=$("<div/>",{"class":"stepsNavButtons"}).appendTo(this.$elmts._nav.container);this.$elmts._nav.prevButton=$("<span/>",{"class":"prev","click":function(){surrogate.turnToStep(surrogate.currentStep-4);}}).appendTo(this.$elmts._nav.buttons);this.$elmts._nav.nextButton=$("<span/>",{"class":"next","click":function(){surrogate.turnToStep(surrogate.currentStep+4);}}).appendTo(this.$elmts._nav.buttons);this.$elmts._nav.indicator.add(this.$elmts._nav.buttons).css({left:this.currentStep*243});if(this.currentStep<=0){this.$elmts._nav.prevButton.addClass("disabled").fadeOut(500,GLOBAL_EASING);}else{this.$elmts._nav.prevButton.removeClass("disabled").fadeIn(500,GLOBAL_EASING);}
if(this.currentStep>=this.$elmts._steps.length-4){this.$elmts._nav.nextButton.addClass("disabled").fadeOut(500,GLOBAL_EASING);}else{this.$elmts._nav.nextButton.removeClass("disabled").fadeIn(500,GLOBAL_EASING);}};InterventionSteps.prototype.turnToStep=function(index){var surrogate=this;if(!this.isAnimating){if(index<0){index=0;}else if(index>this.$elmts._steps.length-4){index=this.$elmts._steps.length-4;}
if(index!==this.currentStep){this.currentStep=index;this.isAnimating=true;var navLeft=this.$elmts._nav._numbers.eq(index).position().left;var trayLeft=index*-243;this.$elmts.tray.animate({left:trayLeft},{duration:500,easing:GLOBAL_EASING});this.$elmts._nav.indicator.add(this.$elmts._nav.buttons).animate({left:navLeft},{duration:500,easing:GLOBAL_EASING,complete:function(){surrogate.isAnimating=false;if(surrogate.currentStep<=0){surrogate.$elmts._nav.prevButton.addClass("disabled").fadeOut(200);}
if(surrogate.currentStep>=surrogate.$elmts._steps.length-4){surrogate.$elmts._nav.nextButton.addClass("disabled").fadeOut(200);}}});if(surrogate.currentStep>0){surrogate.$elmts._nav.prevButton.removeClass("disabled").fadeIn(200);}
if(surrogate.currentStep<surrogate.$elmts._steps.length-4){surrogate.$elmts._nav.nextButton.removeClass("disabled").fadeIn(200);}}}
return this;};Number.prototype.toStringOfLength=function(len,pad){var str=this.toString();pad=typeof pad=="string"?pad:"0";while(str.length<len){str=pad+str;}
return str;}
$(function(){$("ul.lightbox").iwcLightbox();});function IWCLightBox(imageArray,options){var surrogate=this;var defaults={isOpen:false,currentImage:0,verticalBuffer:100,animate:true};$.extend(true,this,defaults,options);this.images=imageArray;this.isLoading=false;this.$elmts={};this.$elmts.lightBox=$("<div/>",{"class":"lightBox"}).css({"position":"fixed","top":0,"left":0,"width":"100%","height":"100%","zIndex":500}).data("lightBox",this);if(opacitySupport){this.$elmts.lightBox.css({"opacity":0});}
this.$elmts.overlay=$("<div/>",{"class":"overlay"}).css({"position":"absolute","top":0,"left":0,"width":"100%","height":"100%"}).appendTo(this.$elmts.lightBox);this.$elmts.container=$("<div/>",{"class":"container"}).css({"position":"absolute"}).appendTo(this.$elmts.lightBox);this.$elmts.controls=$("<div/>",{"class":"controls"}).appendTo(this.$elmts.container);this.$elmts.prevButton=$("<span/>",{"class":"prevButton","click":function(){if(!$(this).hasClass("disabled")){surrogate.goToImage(surrogate.currentImage-1,this.animate);}}}).appendTo(this.$elmts.controls);this.$elmts.firstButton=$("<span/>",{"class":"firstButton","click":function(){if(!$(this).hasClass("disabled")){surrogate.goToImage(0,this.animate);}}}).appendTo(this.$elmts.controls);this.$elmts.closeButton=$("<span/>",{"class":"closeButton","click":function(){surrogate.close();}}).appendTo(this.$elmts.controls);this.$elmts.nextButton=$("<span/>",{"class":"nextButton","click":function(){if(!$(this).hasClass("disabled")){surrogate.goToImage(surrogate.currentImage+1,this.animate);}}}).appendTo(this.$elmts.controls);this.$elmts.imageContainer=$("<div/>",{"class":"imageContainer"}).css({"position":"relative","min-height":100,"text-align":"center"}).appendTo(this.$elmts.container);this.$elmts.subTextContainer=$("<p/>",{"class":"subTextContainer"}).css({"position":"relative","text-align":"center"}).appendTo(this.$elmts.container);this.$elmts.spinner=$("<div/>",{"class":"spinner"}).css({"display":"none","position":"absolute","top":"50%","left":"50%"}).append($("<span/>")).appendTo(this.$elmts.imageContainer);this.$elmts.image=null;var hashVal=this._hashCheck();if(hashVal!==false){this.setImage(hashVal);this.open();}else if(this.isOpen){this.open();}};IWCLightBox.prototype.open=function(){var surrogate=this;this.isOpen=true;this.$elmts.lightBox.appendTo("body");surrogate.goToImage(surrogate.currentImage,false);$(window).bind("resize.lightBox",function(){surrogate._updatePosition();});this._updatePosition();if(opacitySupport){this.$elmts.lightBox.fadeTo(300,1);}else{this.$elmts.lightBox.show();}
$(document).bind("keyup.lightBox",function(e){switch(typeof e.keyCode=="number"?e.keyCode:e.which){case G_KEYCODES.esc:surrogate.close();break;case G_KEYCODES.left:surrogate.$elmts.prevButton.trigger("click");break;case G_KEYCODES.right:surrogate.$elmts.nextButton.trigger("click");break;}});return this;};IWCLightBox.prototype.close=function(){if(this.isOpen){var surrogate=this;$(document).unbind("keyup.lightBox");var top=this.$elmts.overlay.offset().top;window.location.hash="";if($.scrollTo){$.scrollTo(top);}
if(opacitySupport){this.$elmts.lightBox.fadeTo(300,0,function(){surrogate.$elmts.lightBox.detach();$(window).unbind("resize.lightBox");surrogate.isOpen=false;});}else{this.$elmts.lightBox.hide().detach();$(window).unbind("resize.lightBox");this.isOpen=false;}}
return this;};IWCLightBox.prototype.setImage=function(index){if(typeof index!="number"){index=parseInt(index);}
if(index<0){index=0;}else if(index>=this.images.length){index=this.images.length-1;}
this.currentImage=index;if(this.currentImage<=0){this.$elmts.prevButton.addClass("disabled");this.$elmts.firstButton.addClass("disabled");}else{this.$elmts.prevButton.removeClass("disabled");this.$elmts.firstButton.removeClass("disabled");}
if(this.currentImage>=this.images.length-1){this.$elmts.nextButton.addClass("disabled");}else{this.$elmts.nextButton.removeClass("disabled");}
return this;};IWCLightBox.prototype.goToImage=function(index,anim){if(!this.isLoading){var surrogate=this;anim=typeof anim=="boolean"?anim:true;anim=this.isOpen&&this.animate?anim:false;this.setImage(index);this.$elmts.spinner.clearQueue().hide().fadeIn(200);this.isLoading=true;$.loadImages(this.images[index].url,function(){var oldImage=surrogate.$elmts.image;surrogate.$elmts.image=$("<img/>",{"src":surrogate.images[index].url,"alt":""}).css({"opacity":0});surrogate.$elmts.spinner.show().delay(10).fadeOut(200);if(anim&&oldImage){surrogate.$elmts.subTextContainer.fadeOut();oldImage.fadeOut(300,function(){oldImage.remove();surrogate.$elmts.image.appendTo(surrogate.$elmts.imageContainer);surrogate._updatePosition();surrogate.$elmts.image.fadeTo(300,1,function(){window.location.hash=surrogate.getCurrentHash();surrogate.isLoading=false;});surrogate.$elmts.subTextContainer.text(surrogate.images[index].subText).fadeIn();});}else{if(oldImage){oldImage.remove();}
surrogate.$elmts.image.appendTo(surrogate.$elmts.imageContainer).fadeTo(0,1);surrogate.$elmts.subTextContainer.text(surrogate.images[index].subText);surrogate._updatePosition();window.location.hash=surrogate.getCurrentHash();surrogate.isLoading=false;}});}};IWCLightBox.prototype._updatePosition=function(){var surrogate=this;var htDiff=$(window).height()-this.$elmts.container.outerHeight(false);if(htDiff>0){if(this.scrollable){this.scrollable=false;$(window).unbind("scroll.lightbox");}
if(htDiff>this.verticalBuffer*2){this.$elmts.container.css({"top":this.verticalBuffer});}else{this.$elmts.container.css({"top":htDiff/2});}}else{if(!this.scrollable){this.scrollable=true;this.overlayTop=this.$elmts.overlay.offset().top;$(window).bind("scroll.lightbox",function(){var topDiff=surrogate.overlayTop-surrogate.$elmts.overlay.offset().top;surrogate.overlayTop=surrogate.$elmts.overlay.offset().top;surrogate._scroll(topDiff);});}}
this.$elmts.container.css({"left":($(window).width()-this.$elmts.container.outerWidth(false))/2});};IWCLightBox.prototype._scroll=function(delta){var diff=$(window).height()-this.$elmts.container.outerHeight();var newTop=this.$elmts.container.position().top+delta;if(newTop>0){newTop=0;}else if(newTop<diff){newTop=diff;}
this.$elmts.container.css({"top":newTop});};IWCLightBox.prototype._hashCheck=function(){var hash=window.location.hash.substr(1).split("/");if(hash[0]=="slideshow"){return hash.length>1?parseInt(hash[1])-1:0;}else{return false;}};IWCLightBox.prototype.getCurrentHash=function(){return"#slideshow/"+(this.currentImage+1);};$.fn.iwcLightbox=function(){$(this).each(function(){var surrogate=$(this),imageArray=[],lightBox,firstLI=$(this).find("li").eq(0),boxHt,boxWd,launcher;surrogate.find("li:gt(0)").each(function(){var slide={url:$(this).find("img").attr("src"),subText:$(this).find("p.slide-subtext span").text()};imageArray.push(slide);$(this).detach();});firstLI.find("img").bind("load",function(){boxHt=firstLI.find("img").height();boxWd=firstLI.find("img").width();firstLI.detach();lightBox=new IWCLightBox(imageArray);launcher=$("<div/>",{"class":"lightBoxLauncher "+surrogate.attr("class").replace(/lightbox/g,""),"html":firstLI.html(),"click":function(){lightBox.open()}}).height(boxHt).width(boxWd);launcher.find("img").prependTo(launcher);launcher.find("h4, p").wrapAll("<div class='titles'/>");launcher.append($("<div/>",{"class":"launchButton"}));surrogate.replaceWith(launcher);});if(firstLI.find("img").get(0).complete){firstLI.find("img").trigger("load");}});};$(function(){$(".faq table tbody tr:not(:first-child) .category *").hide();$(".faq table .answer div").each(function(){var surrogate=this;var tallHt=$(this).height();var clone=$(this).clone().addClass("clone").css({overflow:"hidden"}).height($(surrogate).height());if(trimByLanguage($(this))){var shortHt=$(this).height();$("<span/>",{"class":"expand","text":string_EXPAND_FOR_ANSWER,"click":function(){if($(this).parent().hasClass("expanded")){$(this).text(string_EXPAND_FOR_ANSWER).parent().removeClass("expanded");clone.animate({height:shortHt},300,GLOBAL_EASING,function(){$(this).replaceWith($(surrogate));});}else{$(surrogate).replaceWith(clone);clone.height(shortHt).animate({height:tallHt},300,GLOBAL_EASING);$(this).text(string_COLLAPSE_ANSWER).parent().addClass("expanded");}}}).insertAfter($(this));}});});function trimByLanguage(e){if(LANGUAGE_CODE=='ja'){if(e.truncateBlockAtChar(150," ...")){return true;}}
else{if(e.truncateBlockAtHeight(108," ...")){return true;}}
return false;}
$(function(){$(".iwcVideo").buildVideoPlayer();if(navigator.userAgent.match(/Android/i)||("iPad iPhone iPod").indexOf(navigator.platform)>-1){$(".iwcVideo").each(function(){var expID="bc_"+$(this).attr("id").split("-")[1];setTimeout(function(){onTemplateLoaded(expID,true);},2000);});}});function onTemplateLoaded(experienceID,bypass){if(bypass){$("#video-"+experienceID.replace('bc_','')).data("videoController").open();}else{$("#video-"+experienceID.replace('bc_','')).data("videoController").initBrightcoveAPI(experienceID);}}
$.fn.buildVideoPlayer=function(){if(!swfobject.hasFlashPlayerVersion("9.0.18")&&!(navigator.userAgent.match(/Android/i)||("iPad iPhone iPod").indexOf(navigator.platform)>-1)){$(this).append('<a href="http://www.adobe.com/go/getflash/" class="figcaption flash_error" target="_blank">'+string_FLASH_ERROR+'</a>');}
$(this).each(function(){if(!$(this).data("videoController")){if($(this).hasClass("videoFull")){var iwcVP=new IWCVideoPlayer($(this),"full");}else if($(this).hasClass("videoTwoThirds")){var iwcVP=new IWCVideoPlayer($(this),"twothirds");}}});}
var IWCVideoPlayer=function($container,aType){var surrogate=this;this.type=aType=="full"?"full":"twothirds";this.bcLoaded=false;this.bc=null;this.isPlaying=false;this.$elmts={};this.$elmts.container=$container.data("videoController",this);this.$elmts.poster=$container.find(".poster");this.$elmts.video=$container.find(".bcVideo");this.$elmts.overlay=$("<div/>",{"class":"videoFadeOverlay"}).css({"display":"none","position":"absolute","top":0,"left":0,"width":"100%","height":"100%","zIndex":4});$(window).bind("resize.videoPlayer",function(){surrogate.$elmts.overlay.width($(document).width()).height($(document).height());});$(window).trigger("resize.videoPlayer");this.$elmts.playButton=$("<div/>",{"class":"playButton","click":function(){surrogate.open();}});this.$elmts.closeButton=$("<div/>",{"class":"videoCloseButton","text":this.type=="twothirds"?"Close":"","click":function(){surrogate.close();}});};IWCVideoPlayer.prototype.open=function(){var surrogate=this;this.play();this.$elmts.video.css({"left":0});this.$elmts.poster.delay(50).fadeOut(400,function(){if(surrogate.type=="full"){surrogate.$elmts.container.delay(100).animate({height:surrogate.$elmts.video.height()},400,function(){surrogate.$elmts.container.css({"zIndex":5});if(surrogate.bc){surrogate.$elmts.overlay.appendTo("body");$(window).trigger("resize.videoPlayer");surrogate.$elmts.overlay.fadeIn(400);surrogate.$elmts.closeButton.appendTo("body").css({top:surrogate.$elmts.video.offset().top,left:surrogate.$elmts.video.offset().left+surrogate.$elmts.video.width()}).hide().fadeIn(200);}});}else if(surrogate.type=="twothirds"){if(surrogate.bc){surrogate.$elmts.closeButton.appendTo(surrogate.$elmts.container).hide().fadeIn(200);}}});};IWCVideoPlayer.prototype.close=function(){if(this.bc){var surrogate=this;this.$elmts.closeButton.fadeOut(200,function(){$(this).detach();});this.$elmts.poster.fadeIn(400,function(){surrogate.pause();surrogate.$elmts.video.css({"left":4000});if(surrogate.type=="full"){surrogate.$elmts.container.delay(100).animate({height:surrogate.$elmts.poster.height()},400,function(){surrogate.$elmts.overlay.fadeOut(400,function(){$(this).detach();surrogate.$elmts.container.css({"zIndex":"auto"});});});}});}};IWCVideoPlayer.prototype.play=function(){if(this.bc&&!this.isPlaying){this.bc._modules.videoPlayer.play();this.isPlaying=true;}};IWCVideoPlayer.prototype.pause=function(){if(this.bc&&this.isPlaying){this.bc._modules.videoPlayer.pause();this.isPlaying=false;}};IWCVideoPlayer.prototype._activate=function(){if(!this.bcLoaded){this.$elmts.playButton.appendTo(this.$elmts.poster).hide().fadeIn(200);this.bcLoaded=true;}};IWCVideoPlayer.prototype.initBrightcoveAPI=function(experienceID){if(!this.bc){var surrogate=this;this.bc={expID:experienceID,exp:brightcove.getExperience(experienceID),_modules:{}};this.bc._modules.videoPlayer=this.bc.exp.getModule(APIModules.VIDEO_PLAYER);this.bc._modules.experience=this.bc.exp.getModule(APIModules.EXPERIENCE);this.bc._modules.content=this.bc.exp.getModule(APIModules.CONTENT);this.bc._modules.videoPlayer.addEventListener(BCMediaEvent.COMPLETE,function(){});this.bc._modules.experience.addEventListener(BCExperienceEvent.CONTENT_LOAD,function(){surrogate._activate();});this.bc._modules.content.addEventListener(BCContentEvent.VIDEO_LOAD,function(){surrogate._activate();});this.bc._modules.captionsModule=this.bc.exp.getModule(APIModules.CAPTIONS);this.bc._modules.videoPlayer.addEventListener(BCMediaEvent.CHANGE,function(event){surrogate.bc._modules.captionsModule.setCaptionsEnabled(true);var language=LANGUAGE_CODE;if(language=='zh-cn'){language='Simplified Chinese';}
else if(language=='zh-tw'){language='Traditional Chinese';}
surrogate.bc._modules.captionsModule.setLanguage(language);});if($(".article-the-volvo-ocean-race").length==1){this.bc._modules.videoPlayer.addEventListener(BCMediaEvent.PROGRESS,function(event){if(event.position>event.duration-1){surrogate.bc._modules.videoPlayer.seek(0);}});}}};var vorParalaxBG=function(){var topDist=15;var topOffset=-75;var routesOffset=285;var $w=$(window);var $b=$('body');var $ports=$('body.en h2.pageTitle a[name="Stopovers"], body.zh-cn h2.pageTitle a[name=""], body.zh-tw h2.pageTitle a[name=""], body.it h2.pageTitle a[name="Sediditappa"], body.de h2.pageTitle a[name="Zwischenstopps"]').parent().parent();var $boats=$('body.en h2.pageTitle a[name="TheBoats"], body.zh-cn h2.pageTitle a[name=""], body.zh-tw h2.pageTitle a[name=""], body.it h2.pageTitle a[name="LeBarche"], body.de h2.pageTitle a[name="DIEJACHTEN"]').parent().parent();var language='enus';if($("body").hasClass("zh-cn"))language='zhcn';else if($("body").hasClass("zh-tw"))language='zhtw';else if($("body").hasClass("it"))language='it';else if($("body").hasClass("de"))language='de';var $map=$('.portsMap');var portsY,boatsY;var routeY=new Array();var routeName=new Array();if($w.height()<600)topDist-=200;var currentRoute=-1;var oldRoute=-1;var routeToggle=1;var calcParalaxBG=function(){preloadRoutes();if(boatsY!=$boats.offset().top){portsY=$ports.offset().top;boatsY=$boats.offset().top;$('.vorRoute').each(function(index){routeY[index]=$(this).offset().top;});routeY[0]-=114;routeY[1]-=130;routeY[2]-=147;routeY[3]-=10;routeY[4]-=300;routeY[5]-=140;routeY[6]-=80;routeY[7]-=130;}
$.each(routeY,function(index,value){if($w.scrollTop()+routesOffset<routeY[0])currentRoute=-1;if($w.scrollTop()+routesOffset>value)currentRoute=index;if($w.scrollTop()+routesOffset>routeY[routeY.length-1])currentRoute=-1;});if(currentRoute!=oldRoute){if(routeToggle>0){if(routeName[currentRoute]!=undefined)var newBgImg="url("+MEDIA_URL+"chrome/images/vor/"+routeName[currentRoute]+"/"+language+".png)"
else var newBgImg="none";if(opacitySupport){$("#portsRoutes1").stop().fadeOut();$("#portsRoutes2").stop().hide().css("background-image",newBgImg).fadeTo(400,1.0);}
else{$("#portsRoutes1").stop().hide();$("#portsRoutes2").stop().css("background-image",newBgImg).show();}}else{if(routeName[currentRoute]!=undefined)var newBgImg="url("+MEDIA_URL+"chrome/images/vor/"+routeName[currentRoute]+"/"+language+".png)"
else var newBgImg="none";if(opacitySupport){$("#portsRoutes2").stop().fadeOut();$("#portsRoutes1").stop().hide().css("background-image",newBgImg).fadeTo(400,1.0);}
else{$("#portsRoutes2").stop().hide();$("#portsRoutes1").stop().css("background-image",newBgImg).show();}}
oldRoute=currentRoute;routeToggle*=-1;}
var top=portsY+topOffset-Math.min($w.scrollTop(),portsY+topOffset);var bgTargY=top/5+topDist;var mapTargY=top/5+topDist;var mapTargOp=1-(top/(portsY+topOffset));var bottom=$w.scrollTop()-boatsY+700;if(bottom>0){var bgTargY=bottom/-5+topDist;var mapTargY=bottom/-5+topDist;var mapTargOp=1-Math.min((bottom/(portsY+topOffset)),1);}
$b.css('backgroundPosition','50% '+bgTargY+'px');if(opacitySupport)$map.css({top:mapTargY,opacity:Math.pow(mapTargOp,4)});else $map.css({top:mapTargY});}
var routeImages=new Array()
function preloadRoutes(){$('.vorRoute').each(function(index){routeName[index]=$(this).attr('title');routeImages[index]=new Image();routeImages[index].src=MEDIA_URL+"chrome/images/vor/"+routeName[index]+"/"+language+".png";});}
$w.scroll(function(){calcParalaxBG();});}
$.fn.boat2=function(opts){var defaults={dur:200}
var options=$.extend(defaults,opts);var cParts=this.find('li');var partsBox=$('<div id="boatPartsBox"></div>');var frontBack=$('');var washout=$('<li class="washout"></li>');var copyBox=$('<div class="boatCopy"></div>');var counter=$('<div class="hr"></div><p class="counter"><span class="incrementNum">1</span> '+string_OF+' <span class="totalNum">100</span></p>');var prevNext=$('<p id="prevNext"><a href="#prev" class="prev">'+string_PREV+'</a><a href="#next" class="next">'+string_NEXT+'</a></p>');var copyList=cParts.find('p').clone();var currPart=0;var prevPart=0;var raphHolder=$('<div/>').attr({id:'raphHolder'});var bg=$('<div/>').attr({id:'cbg'});var paper;var animDur=100;var lineStart={x:480,y:650}
var hoverConfig={interval:50,timeout:200,over:function(){onPartOver(this)},out:function(){onPartOut(this)}}
var onPartOver=function(e){var part=$(e);fadeInPart(part);}
var onPartOut=function(e){}
var onPartClick=function(e){var ind=cParts.index(e);if(ind!=currPart){showPartInfo(ind);}}
bg.append("<img class='back' src='"+MEDIA_URL+"chrome/images/vor/volvo_open_70.jpg' alt='' />");bg.append("<img class='front' src='"+MEDIA_URL+"chrome/images/vor/volvo_open_70.jpg' alt='' />");var onPrevNextClick=function(e){var newPart=0;switch($(e.target).attr('href').split("#")[1]){case'prev':newPart=currPart-1>0?currPart-1:0;break;case'next':newPart=currPart+1<cParts.length?currPart+1:cParts.length-1;break;}
if($(e.target).hasClass('disabled')==false){showPartInfo(newPart);fadeInPart($(cParts.get(newPart)));}
if(newPart>=4){if(opacitySupport){bg.find('img.front').animate({'opacity':'0'});}
else{bg.find('img.front').hide();}
toggleFrontBackLinks("front");}
else{if(opacitySupport){bg.find('img.front').animate({'opacity':'1'});}
else{bg.find('img.front').show();}
toggleFrontBackLinks("back");}
updateCounter(newPart,copyList.length);}
var updateCounter=function(num,totalNum){counter.find('span.incrementNum').text(num+1);counter.find('span.totalNum').text(totalNum);}
var toggleFrontBackLinks=function(whichIsActive){}
var showPartInfo=function(ind){var pToShow=$(copyList.get(ind));var yOffset=6;var xOffset=22;copyBox.attr('class','boatCopy c_'+ind);copyList.hide().filter(pToShow).show();prevNext.show();drawLine(lineStart.x,lineStart.y,$(cParts[ind]).position().left+xOffset,$(cParts[ind]).position().top+yOffset);currPart=ind;if(currPart==0){$('#prevNext .prev').addClass('disabled');}else{$('#prevNext .prev').removeClass('disabled');}
if(currPart>=cParts.length-1){$('#prevNext .next').addClass('disabled');}else{$('#prevNext .next').removeClass('disabled');}}
var drawLine=function(ox,oy,tx,ty){if($('#prevNext').hasClass('drawn')==false){$('#prevNext').addClass('drawn');}
paper.clear();var l=paper.path('M'+ox+'  '+oy);l.attr({stroke:'#a3443e','stroke-width':'1px'});var p1='M'+ox+' '+oy;var p2='L'+ox+' '+(oy-20);var p3='L180 '+(oy-20);var p4='L180 '+ty;var p5='L'+tx+' '+ty;if(tx>ox){p3='L'+(ox+300)+' '+(oy-20);p4='L'+(ox+300)+' '+ty;}
l.animate({path:p1},animDur,function(){l.animate({path:p1+p2},animDur,function(){l.animate({path:p1+p2+p3},animDur,function(){l.animate({path:p1+p2+p3+p4},animDur,function(){l.animate({path:p1+p2+p3+p4+p5},animDur);});});});});}
var fadeInPart=function(part){cParts.stop().fadeTo(options.dur,0).filter(part).fadeTo(options.dur,1);}
this.addClass('initialized').wrap(partsBox);$('#prevNext .prev').addClass('disabled');copyList.hide();prevNext.find('a').bind('click',function(e){onPrevNextClick(e);return false;});copyBox.append(prevNext).append(counter).append(copyList).insertAfter(this).hide();bg.insertBefore(this);raphHolder.height(650).insertBefore(this);paper=Raphael("raphHolder",raphHolder.width(),raphHolder.height());cParts.hoverIntent(hoverConfig).css({"opacity":"0","filter":"alpha(opacity=0)"}).bind('click',function(){onPartClick(this);}).each(function(i){$(this).addClass('c_part_'+i);});copyBox.fadeIn();frontBack.find('a').bind('click',function(e){});return this.each(function(){});}
function autoResize(height){$('body #wrapper iframe').css(height+'px');}
$(document).ready(function(){if($("body").hasClass("siderale")){var creatorBioRow1=new CreatorExpando('.siderale .creatorBioRow1',0,".siderale .expandCollapseControls1");var creatorBioRow2=new CreatorExpando('.siderale .creatorBioRow2',0,".siderale .expandCollapseControls2");this.headShotsButtons=$('.headShotWrapper','.creatorHeadRow1').bind('click',function(e){e.preventDefault();if(creatorBioRow1.element.hasClass("collapsed")){creatorBioRow1.expand();}});this.headShotsButtons=$('.headShotWrapper','.creatorHeadRow2').bind('click',function(e){e.preventDefault();if(creatorBioRow2.element.hasClass("collapsed")){creatorBioRow2.expand();}});var starChart=new WatchDetail([{thumbnail:MEDIA_URL+"chrome/images/siderale/starchart/north_small.gif",fronts:[MEDIA_URL+'chrome/images/siderale/starchart/north_large.gif',MEDIA_URL+'chrome/images/siderale/starchart/north_medium.gif',MEDIA_URL+'chrome/images/siderale/starchart/north_small.gif'],backs:[MEDIA_URL+'chrome/images/siderale/starchart/south_large.gif',MEDIA_URL+'chrome/images/siderale/starchart/south_medium.gif',MEDIA_URL+'chrome/images/siderale/starchart/south_small.gif'],title:"Star Chart",isStarChart:true}]);$('a.enlargeStarChart').bind("click",function(event){event.preventDefault();starChart.open();});var watchDetail=new WatchDetail([{thumbnail:MEDIA_URL+'chrome/images/siderale/enlarge/front_end_small.jpg',fronts:[MEDIA_URL+'chrome/images/siderale/enlarge/front_end_large.jpg',MEDIA_URL+'chrome/images/siderale/enlarge/front_end_medium.jpg',MEDIA_URL+'chrome/images/siderale/enlarge/front_end_small.jpg'],backs:[MEDIA_URL+'chrome/images/siderale/enlarge/back_end_large.jpg',MEDIA_URL+'chrome/images/siderale/enlarge/back_end_medium.jpg',MEDIA_URL+'chrome/images/siderale/enlarge/back_end_small.jpg'],title:"Protuguese Sid&eacute;rale Scafusia"}]);$("a.enlarge").bind("click",function(e){e.preventDefault();watchDetail.open();});$('a.scrollTo').bind('click',function(e){e.preventDefault();scrollTo($(this));});$(".watch360").watch360();$(".watchImageSlider").each(function(){new WatchImageSlider($(this));});if(document.getElementById('sideraleParts')){$('#sideraleParts').siderale2();$('.siderale #prevNext .prev').trigger('click');}
var viewChartLink=new viewChartHighlight($(".siderale .chartCustomization .boxLinkContainer .boxArrowLink"));var viewChartTextLink=new viewChartHighlight($(".siderale .chartCustomization .viewChartTextLink"));}});var viewChartHighlight=function(element){element.bind('mouseover',function(e){e.preventDefault();$(".siderale .chartCustomization .bgImage").addClass("highlighted");});element.bind('mouseout',function(e){e.preventDefault();$(".siderale .chartCustomization .bgImage").removeClass("highlighted");});}
var CreatorExpando=function(el,theLimit,btnRef){this.element=$(el);this.limit=theLimit;this.lis=$('li',this.element);this.button=$(btnRef);this.downText=this.button.data('collapse-text');this.upText=this.button.text();this.element.addClass("expanded");var that=this;if(this.lis.length>this.limit){this.button.css({display:'block'});that.collapse();}}
CreatorExpando.prototype.collapse=function(){var parentObj=this;parentObj.element.removeClass("expanded").addClass("collapsed");parentObj.lis.each(function(i){if(i>parentObj.limit-1){if(jQuery.support.opacity&&!$.browser.msie){$(this).animate({"height":"0px","opacity":"0"},200,function(){});}
else{$(this).hide();$(this).css({"height":"0px"});}}});parentObj.button.unbind('click');parentObj.button.bind('click',function(e){e.preventDefault();parentObj.expand();scrollTo($(this));}).removeClass('down').text(this.upText);}
CreatorExpando.prototype.expand=function(){var parentObj=this;parentObj.element.removeClass("collapsed").addClass("expanded");if(jQuery.support.opacity&&!$.browser.msie){parentObj.lis.animate({"height":"300px","opacity":"1"},200,function(){});}
else{parentObj.lis.show();parentObj.lis.css({"height":"300px"});}
parentObj.button.unbind('click');parentObj.button.bind('click',function(e){e.preventDefault();parentObj.collapse();scrollTo($(this));}).addClass('down').text(this.downText);}
var scrollTo=function(elementClicked){var elementHref=$(elementClicked).attr('href');var destination=$(elementHref).offset().top;$("html:not(:animated),body:not(:animated)").animate({scrollTop:destination},500);return false;}
function SlideControl($rail,$handle,opts){var th=this,sc="slidecontrol",evtNS=sc+"-"+Math.floor((Math.random()*1E4)).toString(16),startDrag,stopDrag;$.extend(th,{initialValue:0,steps:0,orientation:"h",reverse:false,animateSlide:true,snapToStepIncrements:0,isThrowable:false},opts,{$rail:$rail,inMotion:false,$currentStep:0,$lastDragPos:0,$dragTimer:null,eventNamespace:evtNS,evts:{mMv:"mousemove."+evtNS,bDr:"beforeDrag."+sc,aDr:"afterDrag."+sc,rCl:"railClick."+sc,uPo:"updatePosition."+sc}});th.orientation=th.orientation==="v"?"v":"h";th.$handle=!!$handle?$handle:$("<span/>",{"class":"handle"});th.$rail.has(th.$handle.get(0))||th.$rail.append(th.$handle);th.$handle.css({"position":"absolute","MozUserSelect":"none","WebkitUserSelect":"none","userSelect":"none"}).bind({"selectstart":function(){return false;},"dragstart":function(){return false;},"mousedown":function(e){startDrag(e);}});th.$rail.css({position:"relative"}).bind({"click":function(e){if(!th.inMotion){th.$rail.trigger(th.evts.rCl);if(th.snapToStepIncrements>0){th.checkSlideSnapIncrement();}
else{th.slideToPos(th.orientation==="h"?e.pageX-th.$rail.offset().left:e.pageY-th.$rail.offset().top,true);}}}});startDrag=function(e){th.inMotion=true;e.stopPropagation();th.$rail.trigger(th.evts.bDr);th.$handle.addClass("hover");$(document.body).bind('mouseup',stopDrag);$(document).bind(th.evts.mMv,function(e){th.slideToPos(th.orientation==="h"?e.pageX-th.$rail.offset().left:e.pageY-th.$rail.offset().top,false);});if(th.isThrowable){th.$dragTimer=setInterval(function(){if(th.isThrowable){th.$lastDragPos=parseInt(th.$handle.css('left'));}},100);}
return false;};stopDrag=function(e){$(document).unbind(th.evts.mMv);$(document.body).unbind('mouseup',stopDrag);th.$handle.removeClass("hover");th.$rail.trigger(th.evts.aDr);if(th.isThrowable){clearInterval(th.$dragTimer);th.$dragTimer=null;var currentDragPos=parseInt(th.$handle.css('left'));var speed=currentDragPos-th.$lastDragPos;if(Math.abs(speed)>10){th.slideToPos(currentDragPos+speed,true,'easeOutSine');return false;}}
th.slideToPos(th.orientation==="h"?e.pageX-th.$rail.offset().left:e.pageY-th.$rail.offset().top,false);th.dragComplete();return false;};th._updateSize();};SlideControl.prototype.dragComplete=function(){var th=this;th.checkSlideSnapIncrement();th.inMotion=false;};SlideControl.prototype.checkSlideSnapIncrement=function(){var th=this;var checkNum=th.steps/th.snapToStepIncrements;if(th.snapToStepIncrements>0){for(var i=1;i<=checkNum;i++){if(th.$currentStep<(i*th.snapToStepIncrements)&&th.$currentStep>((i-1)*th.snapToStepIncrements)){if(th.$currentStep>((i-1)*th.snapToStepIncrements+(th.snapToStepIncrements/2))){th.slideToStep((i*th.snapToStepIncrements),true);}
else{th.slideToStep(((i-1)*th.snapToStepIncrements),true);}
return;}}}}
SlideControl.prototype.slideToPos=function(pos,animate,easing){var th=this;animate=animate===false?false:true;if(typeof(easing)=='undefined')easing='linear';pos<0&&(pos=0);pos>=th.railSize&&(pos=th.railSize);th.steps&&(pos=Math.round(pos/th.stepSize)*th.stepSize);th.$handle.animate(th.orientation==="h"?{left:pos}:{top:pos},{duration:animate&&th.animateSlide?300:0,easing:easing,step:function(now,fx){th.inMotion=true;th.$currentStep=Math.round(now/th.stepSize);th.$rail.trigger({"type":th.evts.uPo,"position":now,"isComplete":false,"step":th.$currentStep});},complete:function(){th.$currentStep=Math.round(pos/th.stepSize);th.inMotion=false;th.$rail.trigger({"type":th.evts.uPo,"position":pos,"isComplete":true,"step":th.$currentStep});}});return this;};SlideControl.prototype.slideToStep=function(step,animate){var th=this;this.slideToPos(step*(this.steps?this.stepSize:1),animate);return this;};SlideControl.prototype._updateSize=function(){var th=this;th.railSize=(th.orientation==="h"?th.$rail.width():th.$rail.height())-1;th.steps&&(th.stepSize=th.railSize/th.steps);return this;};function Preloader(urlArray,callback,opts){var th=this;$.extend(th,{$target:$(document),onFinishOne:null,checkFilesize:true,startNow:true,loadMethod:"inOrder"},opts,{urls:urlArray,onFinishAll:callback,loaderQueue:[],errors:[],completed:[],totalBytes:0,completedBytes:0,state:"initializing",evts:{bFs:"beforeFilesize.preloader",aFs:"afterFilesize.preloader",pFs:"filesizeProgress.preloader",bLo:"beforeLoad.preloader",aLo:"afterLoad.preloader",pLo:"loadProgress.preloader"}});th.startNow&&th.start();}
Preloader.prototype.start=function(){var th=this,filesizeQueue,tempArray,a,b,c;$.each(th.urls,function(i,url){th.loaderQueue[i]={originalIndex:i,url:th.urls[i],filesize:0};});if(th.loadMethod==="interpolate"){tempArray=th.loaderQueue;th.loaderQueue=[tempArray.splice(0,1)[0],tempArray.splice(-1,1)[0]];a=1;b=2;do{(a%2)&&th.loaderQueue.push(tempArray.splice(Math.floor((tempArray.length/b)*a),1)[0]);a++;if(a>=b){a=1;b*=2;}}while(tempArray.length);}else if(th.loadMethod==="middleOut"){tempArray=th.loaderQueue;th.loaderQueue=[];do{th.loaderQueue.push(tempArray.splice(Math.floor((tempArray.length-1)/2),1)[0]);}while(tempArray.length);}else if(th.loadMethod.split("/")[0]==="stepped"){tempArray=th.loaderQueue;th.loaderQueue=[];a=0;b=th.loadMethod.split("/").length>1&&parseInt(th.loadMethod.split("/")[1])>0?parseInt(th.loadMethod.split("/")[1]):2;c=0;do{th.loaderQueue.push(tempArray[a]);a+=b;if(a>=tempArray.length){a=++c;}}while(th.loaderQueue.length<tempArray.length);}
if(th.checkFilesize){filesizeQueue=th.loaderQueue;th.loaderQueue=[];th.state="filesize_checking";th.$target.trigger({type:th.evts.bFs,preloaderData:th._getDataObject()});sizeLoop(0);}else{loadEm();}
return th;function loadEm(){var dfrs=[],dfr;th.state="loading";th.$target.trigger({type:th.evts.bLo,preloaderData:th._getDataObject()});while(th.loaderQueue.length){var thisImg=$("<img/>",{load:function(){doneOne(1,$(this).data("imgObj"));$(this).removeData("imgObj");},error:function(){doneOne(0,$(this).data("imgObj"));}}).data("imgObj",th.loaderQueue.splice(0,1)[0]);thisImg.attr("src",thisImg.data("imgObj").url)}
function doneOne(g,imgObj){var dataObj;if(g){th.completed.push(imgObj);th.completedBytes+=imgObj.size;}else{th.errors.push(imgObj);}
dataObj=th._getDataObject(imgObj);th.$target.trigger({type:th.evts.pLo,preloaderData:dataObj});$.isFunction(th.onFinishOne)&&th.onFinishOne(dataObj);if(th.completed.length+th.errors.length===th.urls.length){doneAll();}}
function doneAll(){var dataObj;th.state="finished";dataObj=th._getDataObject();th.$target.trigger({type:th.evts.aLo,preloaderData:dataObj});$.isFunction(th.onFinishAll)&&th.onFinishAll(dataObj);}};function sizeLoop(index){var xhr=new XMLHttpRequest(),byteSize;xhr.open('HEAD',filesizeQueue[index],1);xhr.onreadystatechange=function(){var imgObj;if(xhr.readyState==4){if(xhr.status==200){byteSize=parseInt(xhr.getResponseHeader('Content-Length'),"10");imgObj=filesizeQueue[index];imgObj.filesize=byteSize;th.loaderQueue.push(imgObj);th.totalBytes+=byteSize;}else{th.errors.push(filesizeQueue[index]);}
th.$target.trigger({type:th.evts.pFs,preloaderData:th._getDataObject(imgObj)});if(++index<filesizeQueue.length){sizeLoop(index);}else{th.$target.trigger({type:th.evts.aFs,preloaderData:th._getDataObject()});loadEm();}}};xhr.send(null);};};Preloader.prototype._getDataObject=function(thisImg){var th=this;return{"state":th.state,"totalImages":th.urls.length,"totalBytes":th.totalBytes,"totalErrors":th.errors.length,"completedImages":th.completed.length,"completedBytes":th.completedBytes,"latestImage":!!thisImg?thisImg:false};}
function Watch360($container,imageUrlArray,opts){var th=this,tempArray,a,b,oneLoaded,enoughLoaded,allLoaded;$.extend(th,{$el:$container,currentImage:null,numToPreload:0.5},opts,{imageUrls:imageUrlArray,readyToGo:false});th.numToPreload=Math.round(th.numToPreload*(th.numToPreload<1?imageUrlArray.length:1));th.$imgContainer=th.$el.find(".imageContainer").eq(0);th.$imgContainer.find("img").eq(0).addClass("temp");th.$sliderContainer=th.$el.find(".slider").eq(0);$.each(th.imageUrls,function(){th.$imgContainer.append($("<span/>",{"class":"placeHolder"}));});oneLoaded=function(imgObject){var $img=$("<img/>",{"class":"angle","src":imgObject.url});th.$imgContainer.children().eq(imgObject.originalIndex).replaceWith($img);};allLoaded=function(){};enoughLoaded=function(pD){var $handle,label1,label2,label3;th.readyToGo=true;th.$imgContainer.find("img.temp").remove();th.$imgContainer.find("img.angle:eq(0)").addClass("selected");label1=$("<span/>",{"class":"label label-0","html":"0&deg;"}).hide().appendTo(th.$sliderContainer);label2=$("<span/>",{"class":"label label-180","html":"180&deg;"}).hide().appendTo(th.$sliderContainer);label3=$("<span/>",{"class":"label label-360","html":"360&deg;"}).hide().appendTo(th.$sliderContainer);$handle=$("<span/>",{"class":"handle","text":"0"}).hide().appendTo(th.$sliderContainer);$handle.add(label1).add(label2).add(label3).fadeIn(200);th.slider=new SlideControl(th.$sliderContainer,$handle,{steps:72,isThrowable:true});th.slider.$rail.bind("updatePosition.slidecontrol",function(e){th.slider.$handle.text(e.step*5);th.scrubToImage(e.step);})};th.preloader=new Preloader(th.imageUrls,allLoaded,{$target:th.$el,checkFilesize:false,loadMethod:"stepped/2",onFinishOne:function(pD){oneLoaded(pD.latestImage);!th.readyToGo&&pD.completedImages+pD.totalErrors>=th.numToPreload&&enoughLoaded(pD);}});}
Watch360.prototype.scrubToImage=function(index){var th=this,children=th.$imgContainer.children(),newGuy;if(!children.eq(index).is("img")){index++;}
newGuy=children.eq(index);if(!newGuy.hasClass("selected")){children.filter(".selected").removeClass("selected");newGuy.addClass("selected");}
th.currentImage=index;return this;}
$.fn.watch360=function(){$(this).each(function(){var img=$(this).find("img"),srcFragment,i,urls=[];srcFragment=$(this).find("img").attr("src").split("_000.png")[0];for(i=0;i<=360;i+=5){urls.push(srcFragment+"_"+padStringToLength(i,3,"0",true)+".png")}
new Watch360($(this),urls,{});});}
function padStringToLength(str,len,pad,prepend){str=typeof str=="string"?str:str.toString();pad=typeof pad=="string"?pad:"0";while(str.length<len){str=!prepend?(str+pad):(pad+str);}
return str;}
function WatchImageSlider(element){var wis=this;wis.steps=36;wis.snapIncrements=18;wis.sliderContainer=element.find(".slider").eq(0);wis.imgContainer=element.find(".imageContainer").eq(0);wis.copyContainer=element.find(".copyContainer").eq(0);wis.imgContainer.find('img').each(function(){if(!$(this).hasClass('image-0')){if(jQuery.support.opacity){$(this).animate({"opacity":"0"},500,function(){});}
else{$(this).hide();}}});wis.copyContainer.find('.copyBlock').each(function(){if(!$(this).hasClass('copyBlock-0')){if(jQuery.support.opacity){$(this).animate({"opacity":"0"},500,function(){});}
else{$(this).hide();}}});var headings=wis.copyContainer.find('h1');label1=$("<span/>",{"class":"label label-0","html":$(headings[0]).text()}).hide().appendTo(wis.sliderContainer);label2=$("<span/>",{"class":"label label-1","html":$(headings[1]).text()}).hide().appendTo(wis.sliderContainer);label3=$("<span/>",{"class":"label label-2","html":$(headings[2]).text()}).hide().appendTo(wis.sliderContainer);wis.handle=$("<span/>",{"class":"handle","text":""}).hide().appendTo(wis.sliderContainer);wis.handleSprite=$("<span/>",{"class":"circleSprite"}).appendTo(wis.handle);wis.handle.add(label1).add(label2).add(label3).fadeIn(200);wis.slider=new SlideControl(wis.sliderContainer,wis.handle,{steps:wis.steps,snapToStepIncrements:wis.snapIncrements});$('.sliderButton').bind('click',function(e){e.preventDefault();if($(this).hasClass('previous')){var prevStep=wis.slider.$currentStep-wis.slider.snapToStepIncrements;wis.slider.slideToStep(prevStep,true);}
else{var nextStep=wis.slider.$currentStep+wis.slider.snapToStepIncrements;wis.slider.slideToStep(nextStep,true);}});wis.slider.$rail.bind("updatePosition.slidecontrol",function(e){wis.scrubToImage(e);})}
WatchImageSlider.prototype.scrubToImage=function(e){var imageNum=0;var wis=this;var index=e.step;var isComplete=e.isComplete;if(index!=0){if(jQuery.support.opacity){$('.watchImageSlider .handleIntroText').css({"opacity":"0"});}
else{$('.watchImageSlider .handleIntroText').hide();}}
else{if(jQuery.support.opacity){$('.watchImageSlider .handleIntroText').css({"opacity":"1"});}
else{$('.watchImageSlider .handleIntroText').show();}}



var newXPos=-(index*27);wis.handleSprite.css({"background-position":newXPos});



if(!wis.slider.inMotion&&isComplete){wis.showCopyBlock(index);}
if(index<=wis.snapIncrements){imageNum=1;}
else if(index>wis.snapIncrements&&index<=(wis.snapIncrements*2)){imageNum=2;index=index-wis.snapIncrements;}
else if(index>(wis.snapIncrements*2)&&index<=(wis.snapIncrements*3)){imageNum=3;index=index-(wis.snapIncrements*2);}
var currImgOpacity=roundNumber($(wis.imgContainer).find('img.image-'+imageNum).css('opacity'),1);var newImgOpacity=roundNumber(Number(0)+Number(index*(1/wis.snapIncrements)),1);if(currImgOpacity!=newImgOpacity){if(jQuery.support.opacity){$(wis.imgContainer).find('img.image-'+imageNum).css({'opacity':newImgOpacity,"filter":"alpha(opacity="+newImgOpacity+")"});}
else{if(newImgOpacity>0.5){$(wis.imgContainer).find('img.image-'+imageNum).show();}
else{$(wis.imgContainer).find('img.image-'+imageNum).hide();}}}
return this;}
WatchImageSlider.prototype.showCopyBlock=function(index){var wis=this;var copyIndex=0;if(index<wis.snapIncrements){copyIndex=0;}
else if(index>=wis.snapIncrements&&index<(wis.snapIncrements*2)){copyIndex=1;}
else if(index>=(wis.snapIncrements*2)&&index<(wis.snapIncrements*3)){copyIndex=2;}
else if(index==(wis.snapIncrements*3)){copyIndex=3;}
wis.copyContainer.find('.copyBlock').each(function(){if(!$(this).hasClass('copyBlock-'+copyIndex)){if(jQuery.support.opacity){$(this).animate({"opacity":"0"},0);}
else{$(this).hide();}}
else{if(jQuery.support.opacity){$(this).animate({"opacity":"1"},0);}
else{$(this).show();}}});}
$.fn.siderale2=function(opts){var defaults={dur:200}
var options=$.extend(defaults,opts);var cParts=this.find('li');var partsBox=$('<div id="sideralePartsBox"></div>');var frontBack=$('<p class="frontBack"><a href="#" class="frontLink">'+string_VIEW_FRONT+'</a><a href="#" class="backLink">'+string_VIEW_BACK+'</a></p>');var washout=$('<li class="washout"></li>');var copyBox=$('<div class="sideraleCopy"></div>');var counter=$('<p class="counter"><span class="incrementNum">1</span> '+string_OF+' <span class="totalNum">100</span></p>');var prevNext=$('<p id="prevNext"><a href="#prev" class="prev">'+string_PREV+'</a><a href="#next" class="next">'+string_NEXT+'</a></p>');var copyList=cParts.find('p').clone();var currPart=0;var prevPart=0;var raphHolder=$('<div/>').attr({id:'raphHolder'});var bg=$('<div/>').attr({id:'cbg'});var paper;var animDur=100;var lineStart={x:220,y:550}
var hoverConfig={interval:50,timeout:200,over:function(){onPartOver(this)},out:function(){onPartOut(this)}}
var onPartOver=function(e){var part=$(e);fadeInPart(part);}
var onPartOut=function(e){}
var onPartClick=function(e){var ind=cParts.index(e);if(ind!=currPart){showPartInfo(ind);}}
bg.append("<img class='back' src='"+MEDIA_URL+"chrome/images/siderale/features/siderale_features_watch_back.jpg' alt='' />");bg.append("<img class='front' src='"+MEDIA_URL+"chrome/images/siderale/features/siderale_features_watch_front.png' alt='' />");var onPrevNextClick=function(e){var newPart=0;switch($(e.target).attr('href').split("#")[1]){case'prev':newPart=currPart-1>0?currPart-1:0;break;case'next':newPart=currPart+1<cParts.length?currPart+1:cParts.length-1;break;}
if($(e.target).hasClass('disabled')==false){showPartInfo(newPart);fadeInPart($(cParts.get(newPart)));}
if(newPart>=4){if(jQuery.support.opacity){bg.find('img.front').animate({'opacity':'0'});}
else{bg.find('img.front').hide();}
toggleFrontBackLinks("front");}
else{if(jQuery.support.opacity){bg.find('img.front').animate({'opacity':'1'});}
else{bg.find('img.front').show();}
toggleFrontBackLinks("back");}
updateCounter(newPart,copyList.length);}
var updateCounter=function(num,totalNum){counter.find('span.incrementNum').text(num+1);counter.find('span.totalNum').text(totalNum);}
var toggleFrontBackLinks=function(whichIsActive){if(whichIsActive=="front"){frontBack.find('a.backLink').css({"color":"#7f7f7f"});frontBack.find('a.frontLink').css({"color":"#cea001"});}
else{frontBack.find('a.frontLink').css({"color":"#7f7f7f"});frontBack.find('a.backLink').css({"color":"#cea001"});}}
var showPartInfo=function(ind){var pToShow=$(copyList.get(ind));var yOffset=6;var xOffset=22;copyBox.attr('class','sideraleCopy c_'+ind);copyList.hide().filter(pToShow).show();prevNext.show();drawLine(lineStart.x,lineStart.y,$(cParts[ind]).position().left+xOffset,$(cParts[ind]).position().top+yOffset);currPart=ind;if(currPart==0){$('#prevNext .prev').addClass('disabled');}else{$('#prevNext .prev').removeClass('disabled');}
if(currPart>=cParts.length-1){$('#prevNext .next').addClass('disabled');}else{$('#prevNext .next').removeClass('disabled');}}
var drawLine=function(ox,oy,tx,ty){if($('#prevNext').hasClass('drawn')==false){$('#prevNext').addClass('drawn');$('#sideraleContainer .pullQuote').hide();}
paper.clear();var l=paper.path('M'+ox+'  '+oy);l.attr({stroke:'#cea001','stroke-width':'1px'});var p1='M'+ox+' '+oy;var p2='L'+ox+' '+(oy-20);var p3='L1 '+(oy-20);var p4='L1 '+ty;var p5='L'+tx+' '+ty;if(tx>ox){p3='L'+(ox+190)+' '+(oy-20);p4='L'+(ox+190)+' '+ty;}
l.animate({path:p1},animDur,function(){l.animate({path:p1+p2},animDur,function(){l.animate({path:p1+p2+p3},animDur,function(){l.animate({path:p1+p2+p3+p4},animDur,function(){l.animate({path:p1+p2+p3+p4+p5},animDur);});});});});}
var fadeInPart=function(part){cParts.stop().fadeTo(options.dur,0).filter(part).fadeTo(options.dur,1);}
this.addClass('initialized').wrap(partsBox);$('#prevNext .prev').addClass('disabled');copyList.hide();prevNext.find('a').bind('click',function(e){onPrevNextClick(e);return false;});copyBox.append(prevNext).append(counter).append(copyList).insertAfter(this).hide();bg.insertBefore(this);raphHolder.height(550).insertBefore(this);paper=Raphael("raphHolder",raphHolder.width(),raphHolder.height());cParts.hoverIntent(hoverConfig).css({"opacity":"0","filter":"alpha(opacity=0)"}).bind('click',function(){onPartClick(this);}).each(function(i){$(this).addClass('c_part_'+i);});copyBox.fadeIn();frontBack.find('a').bind('click',function(e){e.preventDefault();var btn=$(this);if(btn.hasClass('frontLink')){showPartInfo(0);fadeInPart($(cParts.get(0)));if(jQuery.support.opacity){bg.find('img.front').animate({'opacity':'1',"filter":"alpha(opacity=1)"});}
else{bg.find('img.front').show();}
toggleFrontBackLinks("back");updateCounter(0,copyList.length);}
else{showPartInfo(4);fadeInPart($(cParts.get(4)));if(jQuery.support.opacity){bg.find('img.front').animate({'opacity':'0',"filter":"alpha(opacity=0)"});}
else{bg.find('img.front').hide();}
toggleFrontBackLinks("front");updateCounter(4,copyList.length);}});$('.features').prepend(frontBack);return this.each(function(){});}
function roundNumber(number,decimal_points){if(!decimal_points)return Math.round(number);if(number==0){var decimals="";for(var i=0;i<decimal_points;i++)decimals+="0";return"0."+decimals;}
var exponent=Math.pow(10,decimal_points);var num=Math.round((number*exponent)).toString();return num.slice(0,-1*decimal_points)+"."+num.slice(-1*decimal_points)}
var RetailerForm=function(){$("p.no-js").hide();$("#retailerForm").show();this.contField=$('#id_region');this.countryField=$('#id_country');this.cityField=$('#id_city');this.flagship=$('#flagshipContent');this.noResults=$('<h4 id="noResult">'+string_NO_RESULTS+'</h4>');this.checks=$('#retailerForm input[type="checkbox"]');this.contField.show();this.countryField.hide();this.cityField.hide();this.init();}
RetailerForm.prototype.init=function(){var surrogate=this;var optionString='<option value="">'+string_REGION+'</option>';for(var i=0;i<regions.length;i++){optionString+='<option value="'+regions[i][0]+'">'+regions[i][1]+'</option>';}
this.contField.html(optionString).bind('change',function(){if($(this).val()!=''){surrogate.onRegionChange();}});this.checks.bind('change',function(){surrogate.filterResults();})
this.buildResults();}
RetailerForm.prototype.buildOneResult=function(retailer){var tempString='<li class="'+retailer.country.toLowerCase()+' '+retailer.city.replace(/[.,\/']/g,'').split(' ').join('').toLowerCase();if(retailer.is_boutique){tempString+=' boutique';}
if(retailer.is_iwc_service){tempString+=' iwc_service';}
if(retailer.is_distribution){tempString+=' retailer';}
tempString+='">';tempString+='<h4>'+retailer.name+'</h4>';if(retailer.name_line_2){tempString+='<h5>'+retailer.name_line_2+'</h5>';}
tempString+='<p class="types">';if(retailer.is_boutique){tempString+=string_BOUTIQUE;}
if(retailer.is_iwc_service){if(retailer.is_boutique){tempString+=' / ';}
tempString+=string_IWC_SERVICE_CENTRE;}
if(retailer.is_distribution){if(retailer.is_iwc_service||retailer.is_boutique){tempString+=' / ';}
tempString+=string_AUTHORIZED_RETAILER;}
tempString+='</p><div class="col col_4 first"><div class="adr"><h5>'+string_ADDRESS+'</h5>';if(retailer.country=="DE"||retailer.country=="CH"){tempString+='<span class="street-address"> ';tempString+=retailer.address.replace(/\,$/,'');if(retailer.address_line_2){tempString+=", "+retailer.address_line_2.replace(/\,$/,'');}
tempString+='</span>';tempString+='<span class="region">'+retailer.region+'</span>';tempString+='<span class="locality">'+retailer.zip+" "+retailer.city_i18n+'</span>';tempString+='<span class="country-name">'+retailer.country_verbose+'</span>';}
else if(retailer.country=="JP"&&$('body').hasClass('ja')){tempString+=retailer.zip?'<span class="postal-code">'+retailer.zip+'</span>':'';tempString+=retailer.region?'<span class="region">'+retailer.region+'</span>&nbsp;':'';tempString+='<span class="locality">'+retailer.city_i18n+'</span>';tempString+='<span class="street-address"> ';if(retailer.address_line_2){tempString+=retailer.address_line_2.replace(/\,$/,'')+", ";}
tempString+=retailer.address.replace(/\,$/,'');tempString+='</span>';}else{tempString+='<span class="street-address"> ';tempString+=retailer.address.replace(/\,$/,'');if(retailer.address_line_2){tempString+=", "+retailer.address_line_2.replace(/\,$/,'');}
tempString+='</span>';tempString+='<span class="locality">'+retailer.city_i18n+'</span>';tempString+=retailer.region?'<span class="region">'+retailer.region+'</span>&nbsp;':'';tempString+=retailer.zip?'<span class="postal-code">'+retailer.zip+'</span>':'';tempString+='<span class="country-name">'+retailer.country_verbose+'</span>';}
if(retailer.comments){tempString+='<br/><h5>'+string_COMMENTS+'</h5><span class="retailer-comments">'+retailer.comments+'</span>';}
tempString+='</div></div>';tempString+='<div class="col col_4 last"><div class="contact"><h5>'+string_CONTACT+'</h5>';if(retailer.phone){tempString+='<span class="phone">'+string_PHONE+': '+retailer.phone+'</span>';}
if(retailer.fax){tempString+='<span class="fax">'+string_FAX+': '+retailer.fax+'</span>';}
if(retailer.email){tempString+='<span class="web">'+string_EMAIL+': <a href="mailto:'+retailer.email+'?Subject=Contact via IWC.com" target="_blank">'+retailer.email+'</a></span>';}
if(retailer.url){tempString+='<span class="web">'+string_WEB+': <a href="'+retailer.url+'" target="_blank">'+retailer.url+'</a></span>';}
if(retailer.latitude&&retailer.longitude){tempString+='<span class="web"><a href="http://maps.google.com/maps?f=q&source=s_q&hl=en&geocode=&q='+retailer.latitude+','+retailer.longitude+'&ie=UTF8&z=17" target="_blank">'+string_VIEW_MAP+'</a></span>';}
if(!retailer.latitude&&!retailer.longitude){if(retailer.address&&retailer.city&&retailer.zip){retailer.address.replace(/ /i,"+");retailer.city.replace(/ /i,"+");tempString+='<span class="web"><a href="http://maps.google.com/maps?f=q&source=s_q&hl=en&geocode=&q='+retailer.address+'+'+retailer.city+'+';if(retailer.region){tempString+=retailer.region+'+'};tempString+=retailer.zip+'&sll=&sspn=&ie=UTF8&z=17" target="_blank">'+string_VIEW_MAP+'</a></span>';}}
tempString+='</div></div></li>';return tempString;};RetailerForm.prototype.buildResults=function(){var tempString='';var retailer;var sortedRetailers=[];var temp1=[];var temp2=[];var temp3=[];for(var b=0;b<retailers.length;b++){if(retailers[b].is_boutique){temp1.push(retailers[b]);}else if(retailers[b].is_distribution){temp2.push(retailers[b]);}else if(retailers[b].is_iwc_service){temp3.push(retailers[b]);}}
sortedRetailers=temp1.concat(temp2,temp3);for(var i=0;i<sortedRetailers.length;i++){retailer=sortedRetailers[i];var retailerString=this.buildOneResult(retailer);if(retailer.country=='HK'&&retailer.name=='IWC Schaffhausen Flagship Boutique'){tempString=retailerString+tempString;}
else{tempString+=retailerString;}}
$('#retailerResults').append(tempString);this.resultList=$('#retailerResults li');}
RetailerForm.prototype.onRegionChange=function(){var surrogate=this;var countryCodes=[];var optionString='<option value="">'+string_COUNTRY+'</option>';for(var i=0;i<region_countries.length;i++){if(region_countries[i][0]==this.contField.val()){countryCodes=(region_countries[i][1]);}}
var filtered_countries=[];for(var j=0;j<countryCodes.length;j++){for(var k=0;k<countries.length;k++){if(countries[k][0]==countryCodes[j]){filtered_countries.push([countries[k][0],countries[k][1]]);}}}
for(var k=0;k<filtered_countries.length;k++){optionString+='<option value="'+filtered_countries[k][0]+'">'+filtered_countries[k][1]+'</option>';}
this.cityField.html('<option value="">'+string_CITY+'</option>');this.countryField.html(optionString).show().bind('change',function(){if($(this).val()!=''){surrogate.onCountryChange();}});}
RetailerForm.prototype.onCountryChange=function(){var surrogate=this;var optionString='<option value="">'+string_CITY+'</option>';for(var i=0;i<cities.length;i++){if(cities[i].country==this.countryField.val()){optionString+='<option value="'+cities[i].city+'">'+cities[i].city_i18n+'</option>';}}
if(optionString!='<option value="">'+string_CITY+'</option>'){this.cityField.html(optionString).show().bind('change',function(){if($(this).val()!=''){surrogate.onCityChange();}});}else{this.cityField.html('<option value="">'+string_NO_CITIES+'</option>');}
this.flagship.hide();this.filterResults('country',this.countryField.val());this.updateHeader();}
RetailerForm.prototype.onCityChange=function(){this.filterResults('city',this.cityField.val());this.updateHeader();}
RetailerForm.prototype.filterResults=function(){var surrogate=this;var filterString='';var filterTerms=[];var filteredList;var finalFilter=[];if(this.cityField.val()!=''){filterString+='.'+surrogate.cityField.val().replace(/[.,\/']/g,'').split(' ').join('').toLowerCase();}
if(this.countryField.val()!=''){filterString+='.'+surrogate.countryField.val().toLowerCase();}
filteredList=$(filterString);if($('#id_is_boutique').is(':checked')&&$('#id_is_iwc_service').is(':checked')&&$('#id_is_distribution').is(':checked')){}else if(!$('#id_is_boutique').is(':checked')&&!$('#id_is_iwc_service').is(':checked')&&!$('#id_is_distribution').is(':checked')){filteredList=[];}else{if($('#id_is_boutique').is(':checked')){filterString+='.boutique';filterTerms.push('boutique');}
if($('#id_is_iwc_service').is(':checked')){filterString+='.iwc_service';filterTerms.push('iwc_service');}
if($('#id_is_distribution').is(':checked')){filterString+='.retailer';filterTerms.push('retailer');}}
if(filterTerms.length>0){for(var i=0;i<filterTerms.length;i++){$(filteredList).each(function(){if($(this).hasClass(filterTerms[i])){finalFilter.push(this);}});}}else{finalFilter=filteredList;}
$.unique(finalFilter);if(finalFilter.length>=1){this.noResults.detach();this.resultList.hide();$(finalFilter).show();}else{this.resultList.hide();$('#retailerResults').append(this.noResults);}}
RetailerForm.prototype.updateHeader=function(){var lh=$('#locationHeader');var tempString='';if(this.contField.val()!=''){tempString+=this.contField.find('option:selected').text();}
if(this.countryField.val()!=''){tempString+=' / '+this.countryField.find('option:selected').text();}
if(this.cityField.val()!=''){tempString+=' / '+this.cityField.val()}
lh.text(tempString).show();}
function initialize_siderale_widget(isStandAlone){var geocoder,map,marker,updateTime,showTab,$sideraleWidget,$mapAddressField,$results,$nauticalFields,$latLongFields,$formError,_isStandAlone=isStandAlone,TIME_FORMAT="hms";var round=function(n,x){return Math.round(n*Math.pow(10,x))/Math.pow(10,x);};function gmaps_init(){var latlng=new google.maps.LatLng(51.751724,-1.255284);var options={zoom:2,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),options);geocoder=new google.maps.Geocoder();marker=new google.maps.Marker({map:map,draggable:true});google.maps.event.addListener(marker,'dragend',function(){geocode_lookup('latLng',marker.getPosition());});google.maps.event.addListener(map,'click',function(event){marker.setPosition(event.latLng);geocode_lookup('latLng',event.latLng);});}
function update_map(geometry){map.fitBounds(geometry.viewport);marker.setPosition(geometry.location);}
function update_ui(address,latLng,action){var $results=$sideraleWidget.find(".results"),html="";clearTimeout(updateTime);sidereal={'address':address,'lat':latLng.lat(),'long':latLng.lng(),'time':getTime(latLng.lng(),action)};if(action=="init"){$mapAddressField.autocomplete("close");$mapAddressField.val(address);html+='<h2>Your sidereal time is <strong>'+sidereal.time+'</strong></h2>';html+='<div class="resultsBtns clearfix disable-select">';html+='<div><a href="'+share_sidereal_time(sidereal.time)+'" target="_blank" class="share">Share</a></div>'
html+='<div class="toggle">Change time format</div>';html+='</div>';$results.empty().append(html).slideDown();update_inputs();}else{$results.find("h2").html('Your sidereal time is <strong>'+sidereal.time+'</strong>');$results.find(".share").attr('href',share_sidereal_time(sidereal.time));}
updateTime=setTimeout(function(){update_ui(sidereal.address,latLng,"update");},1000);}
function geocode_lookup(type,value,update){update=typeof update!=='undefined'?update:false;request={};request[type]=value;geocoder.geocode(request,function(results,status){$formError.html('').css({"display":"none"});if(status==google.maps.GeocoderStatus.OK){if(results[0]){update_ui(results[0].formatted_address,results[0].geometry.location,"init");if(update){update_map(results[0].geometry);}}
else{$formError.html(string_SIDERALE_WIDGET_ERROR).css({"display":"block"});}}
else{if(type=='address'){$formError.html(string_SIDERALE_WIDGET_INVALID_VALUE).css({"display":"block"});}
else{$formError.html(string_SIDERALE_WIDGET_NO_ADDRESS_FOUND).css({"display":"block"});update_ui('',value,"update");}}});}
function update_inputs(){var latD=sidereal.lat,longD=sidereal.long,formattedAddress=sidereal.address,latDMS=deg_to_dms(latD);longDMS=deg_to_dms(longD);latDegree=parseInt(latDMS[0]);latMin=parseInt(latDMS[1]);latSec=parseInt(latDMS[2]);longDegree=parseInt(longDMS[0]);longMin=parseInt(longDMS[1]);longSec=parseInt(longDMS[2]);$mapAddressField.val(formattedAddress);$nauticalFields.filter("input#lat-degree").val(latDegree);$nauticalFields.filter("input#lat-min").val(latMin);$nauticalFields.filter("input#lat-sec").val(latSec);$nauticalFields.filter("input#long-degree").val(longDegree);$nauticalFields.filter("input#long-min").val(longMin);$nauticalFields.filter("input#long-sec").val(longSec);$latLongFields.filter("input#latField").val(latD);$latLongFields.filter("input#longField").val(longD);}
function autocomplete_init(){$mapAddressField.autocomplete({source:function(request,response){geocoder.geocode({'address':request.term},function(results,status){response($.map(results,function(item){return{label:item.formatted_address,value:item.formatted_address,geocode:item};}));});},select:function(event,ui){update_ui(ui.item.value,ui.item.geocode.geometry.location,"init");update_map(ui.item.geocode.geometry);}});}
function share_sidereal_time(sidereal_time){title=string_SIDERALE_WIDGET_SHARE_TITLE+' '+sidereal_time;body=string_SIDERALE_WIDGET_SHARE_BODY;url='http://www.iwc.com/en/collection/siderale/';thumb='http://media2.iwc.com/site_media/uploads/images/2011/08/25/siderale_family_view1.png';fb_url='http://www.facebook.com/sharer.php?s=100&p[title]='+title+'&p[url]='+url+'&p[images][0]='+thumb+'&p[summary]='+body;return fb_url;}
function getTime(longitude,action){var now=new Date();var hour=now.getUTCHours();var minute=now.getUTCMinutes();var second=now.getUTCSeconds();var beg=new Date(now.getUTCFullYear()-1,11,31);var day=Math.floor((now-beg)/86400000);var mst=getMST(now,longitude);var ras=mst;mst=mst/15.0;if(action=="toggle"){TIME_FORMAT=TIME_FORMAT=="decimal"?"hms":"decimal";}
if(TIME_FORMAT=="decimal"){mst=round(mst,8);return mst;}else{var deg,min,sec,hms;deg=Math.floor(ras);ras=ras-deg;ras=ras*60;min=Math.floor(ras);ras=ras-min;ras=ras*60;sec=Math.floor(ras);hour=Math.floor(mst);mst=mst-hour;mst=mst*60;minute=Math.floor(mst);mst=mst-minute;mst=mst*60;second=Math.floor(mst);hms=d2(hour)+":"+d2(minute)+":"+d2(second);return hms;}}
function d2(n){if(n<10)
return"0"+n;return n;}
function getMST(now,lon){var year=now.getUTCFullYear();var month=now.getUTCMonth()+1;var day=now.getUTCDate();var hour=now.getUTCHours();var minute=now.getUTCMinutes();var second=now.getUTCSeconds();if(month==1||month==2)
{year=year-1;month=month+12;}
var a=Math.floor(year/100);var b=2-a+Math.floor(a/4);var c=Math.floor(365.25*year);var d=Math.floor(30.6001*(month+1));var jd=b+c+d-730550.5+day+(hour+minute/60.0+second/3600.0)/24.0;var jt=jd/36525.0;var GMST=280.46061837+360.98564736629*jd+0.000387933*jt*jt-jt*jt*jt/38710000+lon;if(GMST>0.0)
{while(GMST>360.0)
GMST-=360.0;}
else
{while(GMST<0.0)
GMST+=360.0;}
return GMST;}
function deg_to_dms(deg){d=parseInt(deg)
md=Math.abs(deg-d)*60
m=parseInt(md)
sd=(md-m)*60
return[d,m,sd]}
function toggleSearch_init(){$sideraleWidget.find(".toggleTabs div").live("click",function(){var $t=$(this),showTab="."+$t.data("tab");$sideraleWidget.find(".toggleTabs div.active.label").removeClass("active");$t.addClass("active");$sideraleWidget.find(".tab").hide();$(showTab).show();$formError.html('').css({"display":"none"});});}
function checkIfFieldsAreFull($fields){var haveFullCoords=true;$fields.each(function(index){if(!$(this).val()!=''){haveFullCoords=false;}});return haveFullCoords;}
function formatCoords(format){var formattedCoords=latCoords=longCoords="";if(format=="nautical"){var latDegrees,latMin,latSec,longDegrees,longMin,longSec,$nautTab=$(".nauticalTab");$latCoordsFields=$nautTab.find(".lat"),$longCoordsFields=$nautTab.find(".long"),latDegrees=$latCoordsFields.find("input#lat-degree").val();latMin=$latCoordsFields.find("input#lat-min").val();latSec=$latCoordsFields.find("input#lat-sec").val();longDegrees=$longCoordsFields.find("input#long-degree").val();longMin=$longCoordsFields.find("input#long-min").val();longSec=$longCoordsFields.find("input#long-sec").val();latCoords=latDegrees+" "+latMin+" "+latSec;longCoords=longDegrees+" "+longMin+" "+longSec;}else if(format=="latLng"){var $latLongTab=$(".latLongTab");latCoords=$latLongTab.find("input#latField").val();longCoords=$latLongTab.find("input#longField").val();}
formattedCoords=latCoords+","+longCoords;return formattedCoords;}
function format_and_search(){var $focusTabs=activeTab=fullCoords=searchValue="",tabType=$sideraleWidget.find(".toggleTabs div.active").data("tab");if(tabType=="latLongTab"){$focusTabs=$latLongFields;activeTab="latLng";}else if(tabType=="nauticalTab"){$focusTabs=$nauticalFields;activeTab="nautical";}else{$focusTabs=$mapAddressField;activeTab="address";}
if(activeTab=="address"){searchValue=$mapAddressField.val();}else{fullCoords=checkIfFieldsAreFull($focusTabs);if(fullCoords){searchValue=formatCoords(activeTab);}}
geocode_lookup('address',searchValue,true);}
function searchBy_init(){var $allFields=$latLongFields.add($nauticalFields).add($mapAddressField);$sideraleWidget.find('a.button').click(function(event){event.preventDefault();format_and_search();});$allFields.keypress(function(event){var code=(event.keyCode?event.keyCode:event.which);if(code==13){format_and_search();};});}
function __init__(){if($('#map-canvas').length){clearTimeout(waitForCanvas);$sideraleWidget=$('#sidereal-widget');$results=$sideraleWidget.find(".results");$mapAddressField=$("#map-address");$nauticalFields=$sideraleWidget.find(".long input, .lat  input");$latLongFields=$sideraleWidget.find("input#latField, input#longField");$formError=$sideraleWidget.find(".formError");if($sideraleWidget&&_isStandAlone){$("#wrapper").css({"min-width":"856px","width":"90%"});}
$(".overlay .popover img.button.closeButton").unbind().live("click",function(e){e.preventDefault();var $overlay=$(this).parent().parent();if(typeof updateTime!='undefined'){clearTimeout(updateTime);}
$overlay.fadeOut(500);$(window).unbind("resize.popover");});$results.delegate(".toggle","click",function(){sidereal.time=getTime(sidereal.long,"toggle");$results.find("h2").html('Your sidereal time is <strong>'+sidereal.time+'</strong>');$results.find(".share").attr('href',share_sidereal_time(sidereal.time));});gmaps_init();autocomplete_init();toggleSearch_init();searchBy_init();}else{var waitForCanvas=window.setTimeout(function(){__init__()},2000);}}
__init__();}
(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,d=e.filter,g=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,_=Object.keys,j=i.bind,w=function(n){return n instanceof w?n:this instanceof w?(this._wrapped=n,void 0):new w(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):n._=w,w.VERSION="1.4.4";var A=w.each=w.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a in n)if(w.has(n,a)&&t.call(e,n[a],a,n)===r)return};w.map=w.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e[e.length]=t.call(r,n,u,i)}),e)};var O="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=w.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},w.reduceRight=w.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=w.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=w.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},w.find=w.detect=function(n,t,r){var e;return E(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},w.filter=w.select=function(n,t,r){var e=[];return null==n?e:d&&n.filter===d?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&(e[e.length]=n)}),e)},w.reject=function(n,t,r){return w.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},w.every=w.all=function(n,t,e){t||(t=w.identity);var u=!0;return null==n?u:g&&n.every===g?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var E=w.some=w.any=function(n,t,e){t||(t=w.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};w.contains=w.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:E(n,function(n){return n===t})},w.invoke=function(n,t){var r=o.call(arguments,2),e=w.isFunction(t);return w.map(n,function(n){return(e?t:n[t]).apply(n,r)})},w.pluck=function(n,t){return w.map(n,function(n){return n[t]})},w.where=function(n,t,r){return w.isEmpty(t)?r?null:[]:w[r?"find":"filter"](n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},w.findWhere=function(n,t){return w.where(n,t,!0)},w.max=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.max.apply(Math,n);if(!t&&w.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>=e.computed&&(e={value:n,computed:a})}),e.value},w.min=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.min.apply(Math,n);if(!t&&w.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;e.computed>a&&(e={value:n,computed:a})}),e.value},w.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=w.random(r++),e[r-1]=e[t],e[t]=n}),e};var k=function(n){return w.isFunction(n)?n:function(t){return t[n]}};w.sortBy=function(n,t,r){var e=k(t);return w.pluck(w.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index<t.index?-1:1}),"value")};var F=function(n,t,r,e){var u={},i=k(t||w.identity);return A(n,function(t,a){var o=i.call(r,t,a,n);e(u,o,t)}),u};w.groupBy=function(n,t,r){return F(n,t,r,function(n,t,r){(w.has(n,t)?n[t]:n[t]=[]).push(r)})},w.countBy=function(n,t,r){return F(n,t,r,function(n,t){w.has(n,t)||(n[t]=0),n[t]++})},w.sortedIndex=function(n,t,r,e){r=null==r?w.identity:k(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;u>r.call(e,n[o])?i=o+1:a=o}return i},w.toArray=function(n){return n?w.isArray(n)?o.call(n):n.length===+n.length?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:n.length===+n.length?n.length:w.keys(n).length},w.first=w.head=w.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},w.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},w.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},w.rest=w.tail=w.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},w.compact=function(n){return w.filter(n,w.identity)};var R=function(n,t,r){return A(n,function(n){w.isArray(n)?t?a.apply(r,n):R(n,t,r):r.push(n)}),r};w.flatten=function(n,t){return R(n,t,[])},w.without=function(n){return w.difference(n,o.call(arguments,1))},w.uniq=w.unique=function(n,t,r,e){w.isFunction(t)&&(e=r,r=t,t=!1);var u=r?w.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:w.contains(a,r))||(a.push(r),i.push(n[e]))}),i},w.union=function(){return w.uniq(c.apply(e,arguments))},w.intersection=function(n){var t=o.call(arguments,1);return w.filter(w.uniq(n),function(n){return w.every(t,function(t){return w.indexOf(t,n)>=0})})},w.difference=function(n){var t=c.apply(e,o.call(arguments,1));return w.filter(n,function(n){return!w.contains(t,n)})},w.zip=function(){for(var n=o.call(arguments),t=w.max(w.pluck(n,"length")),r=Array(t),e=0;t>e;e++)r[e]=w.pluck(n,""+e);return r},w.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},w.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=w.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},w.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},w.range=function(n,t,r){1>=arguments.length&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=Array(e);e>u;)i[u++]=n,n+=r;return i},w.bind=function(n,t){if(n.bind===j&&j)return j.apply(n,o.call(arguments,1));var r=o.call(arguments,2);return function(){return n.apply(t,r.concat(o.call(arguments)))}},w.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},w.bindAll=function(n){var t=o.call(arguments,1);return 0===t.length&&(t=w.functions(n)),A(t,function(t){n[t]=w.bind(n[t],n)}),n},w.memoize=function(n,t){var r={};return t||(t=w.identity),function(){var e=t.apply(this,arguments);return w.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},w.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},w.defer=function(n){return w.delay.apply(w,[n,1].concat(o.call(arguments,1)))},w.throttle=function(n,t){var r,e,u,i,a=0,o=function(){a=new Date,u=null,i=n.apply(r,e)};return function(){var c=new Date,l=t-(c-a);return r=this,e=arguments,0>=l?(clearTimeout(u),u=null,a=c,i=n.apply(r,e)):u||(u=setTimeout(o,l)),i}},w.debounce=function(n,t,r){var e,u;return function(){var i=this,a=arguments,o=function(){e=null,r||(u=n.apply(i,a))},c=r&&!e;return clearTimeout(e),e=setTimeout(o,t),c&&(u=n.apply(i,a)),u}},w.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},w.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},w.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},w.after=function(n,t){return 0>=n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},w.keys=_||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)w.has(n,r)&&(t[t.length]=r);return t},w.values=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push(n[r]);return t},w.pairs=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push([r,n[r]]);return t},w.invert=function(n){var t={};for(var r in n)w.has(n,r)&&(t[n[r]]=r);return t},w.functions=w.methods=function(n){var t=[];for(var r in n)w.isFunction(n[r])&&t.push(r);return t.sort()},w.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},w.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},w.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)w.contains(r,u)||(t[u]=n[u]);return t},w.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)null==n[r]&&(n[r]=t[r])}),n},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,t){return t(n),n};var I=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof w&&(n=n._wrapped),t instanceof w&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==t+"";case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;r.push(n),e.push(t);var a=0,o=!0;if("[object Array]"==u){if(a=n.length,o=a==t.length)for(;a--&&(o=I(n[a],t[a],r,e)););}else{var c=n.constructor,f=t.constructor;if(c!==f&&!(w.isFunction(c)&&c instanceof c&&w.isFunction(f)&&f instanceof f))return!1;for(var s in n)if(w.has(n,s)&&(a++,!(o=w.has(t,s)&&I(n[s],t[s],r,e))))break;if(o){for(s in t)if(w.has(t,s)&&!a--)break;o=!a}}return r.pop(),e.pop(),o};w.isEqual=function(n,t){return I(n,t,[],[])},w.isEmpty=function(n){if(null==n)return!0;if(w.isArray(n)||w.isString(n))return 0===n.length;for(var t in n)if(w.has(n,t))return!1;return!0},w.isElement=function(n){return!(!n||1!==n.nodeType)},w.isArray=x||function(n){return"[object Array]"==l.call(n)},w.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){w["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return!(!n||!w.has(n,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(n){return"function"==typeof n}),w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!=+n},w.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return n===void 0},w.has=function(n,t){return f.call(n,t)},w.noConflict=function(){return n._=t,this},w.identity=function(n){return n},w.times=function(n,t,r){for(var e=Array(n),u=0;n>u;u++)e[u]=t.call(r,u);return e},w.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=w.invert(M.escape);var S={escape:RegExp("["+w.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+w.keys(M.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(n){w[n]=function(t){return null==t?"":(""+t).replace(S[n],function(t){return M[n][t]})}}),w.result=function(n,t){if(null==n)return null;var r=n[t];return w.isFunction(r)?r.call(n):r},w.mixin=function(n){A(w.functions(n),function(t){var r=w[t]=n[t];w.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),D.call(this,r.apply(w,n))}})};var N=0;w.uniqueId=function(n){var t=++N+"";return n?n+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(n,t,r){var e;r=w.defaults({},r,w.templateSettings);var u=RegExp([(r.escape||T).source,(r.interpolate||T).source,(r.evaluate||T).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(B,function(n){return"\\"+q[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,w);var c=function(n){return e.call(this,n,w)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},w.chain=function(n){return w(n).chain()};var D=function(n){return this._chain?w(n).chain():n};w.mixin(w),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];w.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],D.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];w.prototype[n]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);(function(a,b,c){"use strict";var d=b.event,e=b.event.handle?"handle":"dispatch",f;d.special.smartresize={setup:function(){b(this).bind("resize",d.special.smartresize.handler)},teardown:function(){b(this).unbind("resize",d.special.smartresize.handler)},handler:function(a,b){var c=this,g=arguments;a.type="smartresize",f&&clearTimeout(f),f=setTimeout(function(){d[e].apply(c,g)},b==="execAsap"?0:100)}},b.fn.smartresize=function(a){return a?this.bind("smartresize",a):this.trigger("smartresize",["execAsap"])},b.Mason=function(a,c){this.element=b(c),this._create(a),this._init()},b.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1,containerStyle:{position:"relative"}},b.Mason.prototype={_filterFindBricks:function(a){var b=this.options.itemSelector;return b?a.filter(b).add(a.find(b)):a},_getBricks:function(a){var b=this._filterFindBricks(a).css({position:"absolute"}).addClass("masonry-brick");return b},_create:function(c){this.options=b.extend(!0,{},b.Mason.settings,c),this.styleQueue=[];var d=this.element[0].style;this.originalStyle={height:d.height||""};var e=this.options.containerStyle;for(var f in e)this.originalStyle[f]=d[f]||"";this.element.css(e),this.horizontalDirection=this.options.isRTL?"right":"left";var g=this.element.css("padding-"+this.horizontalDirection),h=this.element.css("padding-top");this.offset={x:g?parseInt(g,10):0,y:h?parseInt(h,10):0},this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth=="function";var i=this;setTimeout(function(){i.element.addClass("masonry")},0),this.options.isResizable&&b(a).bind("smartresize.masonry",function(){i.resize()}),this.reloadItems()},_init:function(a){this._getColumns(),this._reLayout(a)},option:function(a,c){b.isPlainObject(a)&&(this.options=b.extend(!0,this.options,a))},layout:function(a,b){for(var c=0,d=a.length;c<d;c++)this._placeBrick(a[c]);var e={};e.height=Math.max.apply(Math,this.colYs);if(this.options.isFitWidth){var f=0;c=this.cols;while(--c){if(this.colYs[c]!==0)break;f++}e.width=(this.cols-f)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:e});var g=this.isLaidOut?this.options.isAnimated?"animate":"css":"css",h=this.options.animationOptions,i;for(c=0,d=this.styleQueue.length;c<d;c++)i=this.styleQueue[c],i.$el[g](i.style,h);this.styleQueue=[],b&&b.call(a),this.isLaidOut=!0},_getColumns:function(){var a=this.options.isFitWidth?this.element.parent():this.element,b=a.width();this.columnWidth=this.isFluid?this.options.columnWidth(b):this.options.columnWidth||this.$bricks.outerWidth(!0)||b,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((b+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(a){var c=b(a),d,e,f,g,h;d=Math.ceil(c.outerWidth(!0)/this.columnWidth),d=Math.min(d,this.cols);if(d===1)f=this.colYs;else{e=this.cols+1-d,f=[];for(h=0;h<e;h++)g=this.colYs.slice(h,h+d),f[h]=Math.max.apply(Math,g)}var i=Math.min.apply(Math,f),j=0;for(var k=0,l=f.length;k<l;k++)if(f[k]===i){j=k;break}var m={top:i+this.offset.y};m[this.horizontalDirection]=this.columnWidth*j+this.offset.x,this.styleQueue.push({$el:c,style:m});var n=i+c.outerHeight(!0),o=this.cols+1-l;for(k=0;k<o;k++)this.colYs[j+k]=n},resize:function(){var a=this.cols;this._getColumns(),(this.isFluid||this.cols!==a)&&this._reLayout()},_reLayout:function(a){var b=this.cols;this.colYs=[];while(b--)this.colYs.push(0);this.layout(this.$bricks,a)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(a){this.reloadItems(),this._init(a)},appended:function(a,b,c){if(b){this._filterFindBricks(a).css({top:this.element.height()});var d=this;setTimeout(function(){d._appended(a,c)},1)}else this._appended(a,c)},_appended:function(a,b){var c=this._getBricks(a);this.$bricks=this.$bricks.add(c),this.layout(c,b)},remove:function(a){this.$bricks=this.$bricks.not(a),a.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="",this.style.top="",this.style.left=""});var c=this.element[0].style;for(var d in this.originalStyle)c[d]=this.originalStyle[d];this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),b(a).unbind(".masonry")}},b.fn.imagesLoaded=function(a){function h(){a.call(c,d)}function i(a){var c=a.target;c.src!==f&&b.inArray(c,g)===-1&&(g.push(c),--e<=0&&(setTimeout(h),d.unbind(".imagesLoaded",i)))}var c=this,d=c.find("img").add(c.filter("img")),e=d.length,f="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",g=[];return e||h(),d.bind("load.imagesLoaded error.imagesLoaded",i).each(function(){var a=this.src;this.src=f,this.src=a}),c};var g=function(b){a.console&&a.console.error(b)};b.fn.masonry=function(a){if(typeof a=="string"){var c=Array.prototype.slice.call(arguments,1);this.each(function(){var d=b.data(this,"masonry");if(!d){g("cannot call methods on masonry prior to initialization; attempted to call method '"+a+"'");return}if(!b.isFunction(d[a])||a.charAt(0)==="_"){g("no such method '"+a+"' for masonry instance");return}d[a].apply(d,c)})}else this.each(function(){var c=b.data(this,"masonry");c?(c.option(a||{}),c._init()):b.data(this,"masonry",new b.Mason(a,this))});return this}})(window,jQuery);